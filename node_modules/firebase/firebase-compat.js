!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";!function(e){var t,n,o,r,i,s,a,c,l,u;function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return e="string"!=typeof e?String(e):e}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function v(e){var t=new FileReader,n=m(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(o&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i&&o&&a(e))this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=y(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var e,t,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=m(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var n,r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(e=t.method||this.method||"GET",n=e.toUpperCase(),-1<l.indexOf(n)?n:e),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function b(e){var r=new FormData;return e.trim().split("&").forEach(function(e){var t,n;e&&(t=(n=e.split("=")).shift().replace(/\+/g," "),n=n.join("=").replace(/\+/g," "),r.append(decodeURIComponent(t),decodeURIComponent(n)))}),r}function I(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}e.fetch||(t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,(i="ArrayBuffer"in e)&&(s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&-1<s.indexOf(Object.prototype.toString.call(e))}),f.prototype.append=function(e,t){e=h(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},f.prototype.delete=function(e){delete this.map[h(e)]},f.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},f.prototype.set=function(e,t){this.map[h(e)]=d(t)},f.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},f.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),p(n)},f.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},f.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),p(n)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries),l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e},u=[301,302,303,307,308],I.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})},e.Headers=f,e.Request=w,e.Response=I,e.fetch=function(n,r){return new Promise(function(i,e){var t=new w(n,r),s=new XMLHttpRequest;s.onload=function(){var e,r,t={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",r=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),n=t.shift().trim();n&&(t=t.join(":").trim(),r.append(n,t))}),r)};t.url="responseURL"in s?s.responseURL:t.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;i(new I(n,t))},s.onerror=function(){e(new TypeError("Network request failed"))},s.ontimeout=function(){e(new TypeError("Network request failed"))},s.open(t.method,t.url,!0),"include"===t.credentials?s.withCredentials=!0:"omit"===t.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),t.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===t._bodyInit?null:t._bodyInit)})},e.fetch.polyfill=!0)}("undefined"!=typeof self?self:void 0);function e(e){try{return!!e()}catch(e){return!0}}function t(e){if(!g(e))throw TypeError(String(e)+" is not an object");return e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n&&n)||Function("return this")(),s={exports:{}},o=!e(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),a={},c=function(e){return"object"==typeof e?null!==e:"function"==typeof e},l=c,u=i.document,h=l(u)&&l(u.createElement),d=function(e){return h?u.createElement(e):{}},p=d,f=!o&&!e(function(){return 7!=Object.defineProperty(p("div"),"a",{get:function(){return 7}}).a}),g=c,m=c,v=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},y=f,_=t,w=v,b=Object.defineProperty;a.f=o?b:function(e,t,n){if(_(e),t=w(t,!0),_(n),y)try{return b(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var I=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},T=a,E=I,k=o?function(e,t,n){return T.f(e,t,E(1,n))}:function(e,t,n){return e[t]=n,e},S=i,C=k,A=function(t,n){try{C(S,t,n)}catch(e){S[t]=n}return n},N=A,x="__core-js_shared__",R=i[x]||N(x,{}),P=R;(s.exports=function(e,t){return P[e]||(P[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"});function O(e,t){return M.call(e,t)}function D(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++L+F).toString(36)}var M={}.hasOwnProperty,L=0,F=Math.random(),U=e,q=!!Object.getOwnPropertySymbols&&!U(function(){return!String(Symbol())}),j=q&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,V=i,B=s.exports,K=O,$=D,z=q,W=j,G=B("wks"),H=V.Symbol,Q=W?H:H&&H.withoutSetter||$,Y=function(e){return K(G,e)||(z&&K(H,e)?G[e]=H[e]:G[e]=Q("Symbol."+e)),G[e]},J={};J[Y("toStringTag")]="z";var X="[object z]"===String(J),Z={exports:{}},ee=R,te=Function.toString;"function"!=typeof ee.inspectSource&&(ee.inspectSource=function(e){return te.call(e)});var ne,re,ie,se,oe,ae,ce,le,ue=ee.inspectSource,he=ue,de=i.WeakMap,pe="function"==typeof de&&/native code/.test(he(de)),fe=s.exports,ge=D,me=fe("keys"),ve=function(e){return me[e]||(me[e]=ge(e))},ye={},_e=c,we=k,be=O,Ie=ve,Te=ye,Ee=i.WeakMap;ce=pe?(ne=new Ee,re=ne.get,ie=ne.has,se=ne.set,oe=function(e,t){return se.call(ne,e,t),t},ae=function(e){return re.call(ne,e)||{}},function(e){return ie.call(ne,e)}):(Te[le=Ie("state")]=!0,oe=function(e,t){return we(e,le,t),t},ae=function(e){return be(e,le)?e[le]:{}},function(e){return be(e,le)});var ke={set:oe,get:ae,has:ce,enforce:function(e){return ce(e)?ae(e):oe(e,{})},getterFor:function(n){return function(e){var t;if(!_e(e)||(t=ae(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},Se=i,Ce=k,Ae=O,Ne=A,xe=ue,Re=ke.get,Pe=ke.enforce,Oe=String(String).split("String");(Z.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,o=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Ae(n,"name")||Ce(n,"name",t),Pe(n).source=Oe.join("string"==typeof t?t:"")),e!==Se?(i?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=n:Ce(e,t,n)):s?e[t]=n:Ne(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&Re(this).source||xe(this)});var De={}.toString,Me=function(e){return De.call(e).slice(8,-1)},Le=X,Fe=Me,Ue=Y("toStringTag"),qe="Arguments"==Fe(function(){return arguments}()),je=Le?Fe:function(e){var t,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Ue))?n:qe?Fe(t):"Object"==(n=Fe(t))&&"function"==typeof t.callee?"Arguments":n},Ve=je,Be=Z.exports;X||Be(Object.prototype,"toString",X?{}.toString:function(){return"[object "+Ve(this)+"]"},{unsafe:!0});var Ke=Math.ceil,$e=Math.floor,ze=function(e){return isNaN(e=+e)?0:(0<e?$e:Ke)(e)},We=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Ge=ze,He=We,Qe=function(a){return function(e,t){var n,r,i=String(He(e)),s=Ge(t),o=i.length;return s<0||o<=s?a?"":void 0:(n=i.charCodeAt(s))<55296||56319<n||s+1===o||(r=i.charCodeAt(s+1))<56320||57343<r?a?i.charAt(s):n:a?i.slice(s,s+2):r-56320+(n-55296<<10)+65536}},Ye={codeAt:Qe(!1),charAt:Qe(!0)},Je={},Xe={},Ze={}.propertyIsEnumerable,et=Object.getOwnPropertyDescriptor,tt=et&&!Ze.call({1:2},1);Xe.f=tt?function(e){var t=et(this,e);return!!t&&t.enumerable}:Ze;function nt(e){return at(ct(e))}var rt=e,it=Me,st="".split,ot=rt(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==it(e)?st.call(e,""):Object(e)}:Object,at=ot,ct=We,lt=Xe,ut=I,ht=nt,dt=v,pt=O,ft=f,gt=Object.getOwnPropertyDescriptor;Je.f=o?gt:function(e,t){if(e=ht(e),t=dt(t,!0),ft)try{return gt(e,t)}catch(e){}if(pt(e,t))return ut(!lt.f.call(e,t),e[t])};function mt(e){return"function"==typeof e?e:void 0}function vt(e,t){return arguments.length<2?mt(_t[e])||mt(wt[e]):_t[e]&&_t[e][t]||wt[e]&&wt[e][t]}var yt=i,_t=yt,wt=i,bt={},It=ze,Tt=Math.min,Et=function(e){return 0<e?Tt(It(e),9007199254740991):0},kt=ze,St=Math.max,Ct=Math.min,At=nt,Nt=Et,xt=function(e,t){var n=kt(e);return n<0?St(n+t,0):Ct(n,t)},Rt=function(a){return function(e,t,n){var r,i=At(e),s=Nt(i.length),o=xt(n,s);if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}},r={includes:Rt(!0),indexOf:Rt(!1)},Pt=O,Ot=nt,Dt=r.indexOf,Mt=ye,n=function(e,t){var n,r=Ot(e),i=0,s=[];for(n in r)!Pt(Mt,n)&&Pt(r,n)&&s.push(n);for(;t.length>i;)Pt(r,n=t[i++])&&(~Dt(s,n)||s.push(n));return s},l=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=n,Ft=l.concat("length","prototype");bt.f=Object.getOwnPropertyNames||function(e){return Lt(e,Ft)};N={};N.f=Object.getOwnPropertySymbols;var Ut=bt,qt=N,jt=t,x=vt("Reflect","ownKeys")||function(e){var t=Ut.f(jt(e)),n=qt.f;return n?t.concat(n(e)):t},Vt=O,Bt=x,Kt=Je,$t=a,U=function(e,t){for(var n=Bt(t),r=$t.f,i=Kt.f,s=0;s<n.length;s++){var o=n[s];Vt(e,o)||r(e,o,i(t,o))}},zt=e,Wt=/#|\.prototype\./,B=function(e,t){var n=Ht[Gt(e)];return n==Yt||n!=Qt&&("function"==typeof t?zt(t):!!t)},Gt=B.normalize=function(e){return String(e).replace(Wt,".").toLowerCase()},Ht=B.data={},Qt=B.NATIVE="N",Yt=B.POLYFILL="P",V=B,Jt=i,Xt=Je.f,Zt=k,en=Z.exports,tn=A,nn=U,rn=V,W=function(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?Jt:a?Jt[s]||tn(s,{}):(Jt[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Xt(c,n))&&i.value:c[n],!rn(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;nn(r,i)}(e.sham||i&&i.sham)&&Zt(r,"sham",!0),en(c,n,r,e)}},sn=We,$=function(e){return Object(sn(e))},J=!e(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),on=O,an=$,R=J,cn=ve("IE_PROTO"),ln=Object.prototype,ee=R?Object.getPrototypeOf:function(e){return e=an(e),on(e,cn)?e[cn]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ln:null},he=ee,de=k,fe=O,pe=Y("iterator"),Ee=!1;[].keys&&("next"in(or=[].keys())?(ar=he(he(or)))!==Object.prototype&&(Er=ar):Ee=!0),fe(Er=null==Er?{}:Er,pe)||de(Er,pe,function(){return this});function un(){}var hn,Te={IteratorPrototype:Er,BUGGY_SAFARI_ITERATORS:Ee},dn=n,pn=l,Ie=Object.keys||function(e){return dn(e,pn)},fn=a,gn=t,mn=Ie,Le=o?Object.defineProperties:function(e,t){gn(e);for(var n,r=mn(t),i=r.length,s=0;s<i;)fn.f(e,n=r[s++],t[n]);return e},Be=vt("document","documentElement"),vn=t,yn=Le,_n=l,X=ye,wn=Be,bn=d,In="prototype",Tn="script",En=ve("IE_PROTO"),kn=function(e){return"<"+Tn+">"+e+"</"+Tn+">"},Sn=function(){try{hn=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Sn=hn?function(e){e.write(kn("")),e.close();var t=e.parentWindow.Object;return e=null,t}(hn):(e=bn("iframe"),t="java"+Tn+":",e.style.display="none",wn.appendChild(e),e.src=String(t),(e=e.contentWindow.document).open(),e.write(kn("document.F=Object")),e.close(),e.F);for(var n=_n.length;n--;)delete Sn[In][_n[n]];return Sn()};X[En]=!0;function Cn(){return this}function An(){return this}var Qe=Object.create||function(e,t){var n;return null!==e?(un[In]=vn(e),n=new un,un[In]=null,n[En]=e):n=Sn(),void 0===t?n:yn(n,t)},Nn=a.f,xn=O,Rn=Y("toStringTag"),tt=function(e,t,n){e&&!xn(e=n?e:e.prototype,Rn)&&Nn(e,Rn,{configurable:!0,value:t})},Ze={},Pn=Te.IteratorPrototype,On=Qe,Dn=I,Mn=tt,Ln=Ze,Fn=c,Un=t,qn=function(e){if(!Fn(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},rt=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Un(e),qn(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),jn=W,Vn=function(e,t,n){var r=t+" Iterator";return e.prototype=On(Pn,{next:Dn(1,n)}),Mn(e,r,!1),Ln[r]=Cn,e},Bn=ee,Kn=rt,$n=tt,zn=k,Wn=Z.exports,f=Y,Gn=Ze,Hn=Te.IteratorPrototype,Qn=Te.BUGGY_SAFARI_ITERATORS,Yn=f("iterator"),Jn="values",Xn="entries",Rt=function(e,t,n,r,i,s,o){Vn(n,t,r);function a(e){if(e===i&&f)return f;if(!Qn&&e in d)return d[e];switch(e){case"keys":case Jn:case Xn:return function(){return new n(this,e)}}return function(){return new n(this)}}var c,l,u=t+" Iterator",h=!1,d=e.prototype,p=d[Yn]||d["@@iterator"]||i&&d[i],f=!Qn&&p||a(i),g="Array"==t&&d.entries||p;if(g&&(g=Bn(g.call(new e)),Hn!==Object.prototype&&g.next&&(Bn(g)!==Hn&&(Kn?Kn(g,Hn):"function"!=typeof g[Yn]&&zn(g,Yn,An)),$n(g,u,!0))),i==Jn&&p&&p.name!==Jn&&(h=!0,f=function(){return p.call(this)}),d[Yn]!==f&&zn(d,Yn,f),Gn[t]=f,i)if(c={values:a(Jn),keys:s?f:a("keys"),entries:a(Xn)},o)for(l in c)!Qn&&!h&&l in d||Wn(d,l,c[l]);else jn({target:t,proto:!0,forced:Qn||h},c);return c},Zn=Ye.charAt,r=ke,x=Rt,er="String Iterator",tr=r.set,nr=r.getterFor(er);x(String,"String",function(e){tr(this,{type:er,string:String(e),index:0})},function(){var e=nr(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=Zn(t,n),e.index+=n.length,{value:n,done:!1})});var B=Qe,A=a,rr=Y("unscopables"),ir=Array.prototype;null==ir[rr]&&A.f(ir,rr,{configurable:!0,value:B(null)});var J=function(e){ir[rr][e]=!0},sr=nt,R=J,he=Ze,or=ke,ar=Rt,cr="Array Iterator",lr=or.set,ur=or.getterFor(cr),fe=ar(Array,"Array",function(e,t){lr(this,{type:cr,target:sr(e),index:0,kind:t})},function(){var e=ur(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");he.Arguments=he.Array,R("keys"),R("values"),R("entries");var hr,dr=i,pr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},fr=fe,gr=k,de=Y,mr=de("iterator"),vr=de("toStringTag"),yr=fr.values;for(hr in pr){var _r=dr[hr],wr=_r&&_r.prototype;if(wr){if(wr[mr]!==yr)try{gr(wr,mr,yr)}catch(fb){wr[mr]=yr}if(wr[vr]||gr(wr,vr,hr),pr[hr])for(var br in fr)if(wr[br]!==fr[br])try{gr(wr,br,fr[br])}catch(fb){wr[br]=fr[br]}}}function Ir(e,t){this.stopped=e,this.result=t}var pe=i.Promise,Tr=Z.exports,Er=function(e,t,n){for(var r in t)Tr(e,r,t[r],n);return e},kr=vt,Sr=a,Cr=o,Ar=Y("species"),Ee=function(e){var t=kr(e),n=Sr.f;Cr&&t&&!t[Ar]&&n(t,Ar,{configurable:!0,get:function(){return this}})},n=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Le=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},l={exports:{}},Nr=Ze,xr=Y("iterator"),Rr=Array.prototype,X=function(e){return void 0!==e&&(Nr.Array===e||Rr[xr]===e)},Pr=n,Te=function(r,i,e){if(Pr(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}},Or=je,Dr=Ze,Mr=Y("iterator"),f=function(e){if(null!=e)return e[Mr]||e["@@iterator"]||Dr[Or(e)]},Lr=t,Ye=function(t,e,n,r){try{return r?e(Lr(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&Lr(i.call(t)),e}},Fr=t,Ur=X,qr=Et,jr=Te,Vr=f,Br=Ye;(l.exports=function(e,t,n,r,i){var s,o,a,c,l,u,h,d=jr(t,n,r?2:1);if(i)s=e;else{if("function"!=typeof(o=Vr(e)))throw TypeError("Target is not iterable");if(Ur(o)){for(a=0,c=qr(e.length);a<c;a++)if((l=r?d(Fr(h=e[a])[0],h[1]):d(e[a]))&&l instanceof Ir)return l;return new Ir(!1)}s=o.call(e)}for(u=s.next;!(h=u.call(s)).done;)if("object"==typeof(l=Br(s,d,h.value,r))&&l&&l instanceof Ir)return l;return new Ir(!1)}).stop=function(e){return new Ir(!0,e)};var Kr=Y("iterator"),$r=!1;try{var zr=0,Wr={next:function(){return{done:!!zr++}},return:function(){$r=!0}};Wr[Kr]=function(){return this},Array.from(Wr,function(){throw 2})}catch(fb){}function Gr(e){return function(){ai(e)}}var Hr,r=function(e,t){if(!t&&!$r)return!1;var n=!1;try{var r={};r[Kr]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Qr=t,Yr=n,Jr=Y("species"),x=function(e,t){var n,r=Qr(e).constructor;return void 0===r||null==(n=Qr(r)[Jr])?t:Yr(n)},A=vt("navigator","userAgent")||"",B=/(iphone|ipod|ipad).*applewebkit/i.test(A),Xr=i,or=e,ar=Me,he=Te,Zr=Be,ei=d,R=B,ti=Xr.location,de=Xr.setImmediate,Ze=Xr.clearImmediate,ni=Xr.process,Wr=Xr.MessageChannel,ri=Xr.Dispatch,ii=0,si={},oi="onreadystatechange",ai=function(e){var t;si.hasOwnProperty(e)&&(t=si[e],delete si[e],t())},Be=function(e){ai(e.data)},d=function(e){Xr.postMessage(e+"",ti.protocol+"//"+ti.host)};de&&Ze||(de=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return si[++ii]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Hr(ii),ii},Ze=function(e){delete si[e]},"process"==ar(ni)?Hr=function(e){ni.nextTick(Gr(e))}:ri&&ri.now?Hr=function(e){ri.now(Gr(e))}:Wr&&!R?(wi=(yi=new Wr).port2,yi.port1.onmessage=Be,Hr=he(wi.postMessage,wi,1)):!Xr.addEventListener||"function"!=typeof postMessage||Xr.importScripts||or(d)||"file:"===ti.protocol?Hr=oi in ei("script")?function(e){Zr.appendChild(ei("script"))[oi]=function(){Zr.removeChild(this),ai(e)}}:function(e){setTimeout(Gr(e),0)}:(Hr=d,Xr.addEventListener("message",Be,!1)));var ci,li,ui,hi,di,pi,fi,gi,ar={set:de,clear:Ze},mi=i,R=Je.f,Wr=Me,vi=ar.set,yi=B,he=mi.MutationObserver||mi.WebKitMutationObserver,_i=mi.process,wi=mi.Promise,bi="process"==Wr(_i),or=R(mi,"queueMicrotask"),d=or&&or.value;d||(ci=function(){var e,t;for(bi&&(e=_i.domain)&&e.exit();li;){t=li.fn,li=li.next;try{t()}catch(e){throw li?hi():ui=void 0,e}}ui=void 0,e&&e.enter()},hi=bi?function(){_i.nextTick(ci)}:he&&!yi?(di=!0,pi=document.createTextNode(""),new he(ci).observe(pi,{characterData:!0}),function(){pi.data=di=!di}):wi&&wi.resolve?(fi=wi.resolve(void 0),gi=fi.then,function(){gi.call(fi,ci)}):function(){vi.call(mi,ci)});function Ii(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Ti(n),this.reject=Ti(r)}var Be=d||function(e){var t={fn:e,next:void 0};ui&&(ui.next=t),li||(li=t,hi()),ui=t},de={},Ti=n;de.f=function(e){return new Ii(e)};var Ei=t,ki=c,Si=de,Ze=function(e,t){if(Ei(e),ki(t)&&t.constructor===e)return t;var n=Si.f(e);return(0,n.resolve)(t),n.promise},Ci=i,B=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Wr=A,R=i.process,or=R&&R.versions,yi=or&&or.v8;yi?qi=(Li=yi.split("."))[0]+Li[1]:Wr&&(!(Li=Wr.match(/Edge\/(\d+)/))||74<=Li[1])&&(Li=Wr.match(/Chrome\/(\d+)/))&&(qi=Li[1]);var Ai,Ni,xi,Ri,he=qi&&+qi,wi=W,Pi=i,d=vt,A=pe,R=Z.exports,or=Er,yi=tt,Wr=Ee,Oi=c,Di=n,Mi=Le,Li=Me,Fi=ue,Ui=l.exports,qi=r,ji=x,Vi=ar.set,Bi=Be,Ki=Ze,$i=function(e,t){var n=Ci.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},ue=de,zi=B,ar=ke,Be=V,Wi=he,Gi=Y("species"),Hi="Promise",Qi=ar.get,Yi=ar.set,Ji=ar.getterFor(Hi),Xi=A,Zi=Pi.TypeError,es=Pi.document,ts=Pi.process,ns=d("fetch"),rs=ue.f,is=rs,ss="process"==Li(ts),os=!!(es&&es.createEvent&&Pi.dispatchEvent),as="unhandledrejection",cs="rejectionhandled",ls=1,us=2,hs=1,ds=2,Be=Be(Hi,function(){if(!(Fi(Xi)!==String(Xi))){if(66===Wi)return!0;if(!ss&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=Wi&&/native code/.test(Xi))return!1;function e(e){e(function(){},function(){})}var t=Xi.resolve(1);return(t.constructor={})[Gi]=e,!(t.then(function(){})instanceof e)}),qi=Be||!qi(function(e){Xi.all(e).catch(function(){})}),ps=function(e){var t;return!(!Oi(e)||"function"!=typeof(t=e.then))&&t},fs=function(p,f,g){var m;f.notified||(f.notified=!0,m=f.reactions,Bi(function(){for(var r,i,e=f.value,t=f.state==ls,n=0;m.length>n;){var s,o,a,c=m[n++],l=t?c.ok:c.fail,u=c.resolve,h=c.reject,d=c.domain;try{l?(t||(f.rejection===ds&&function(e,t){Vi.call(Pi,function(){if(ss)ts.emit("rejectionHandled",e);else gs(cs,e,t.value)})}(p,f),f.rejection=hs),!0===l?s=e:(d&&d.enter(),s=l(e),d&&(d.exit(),a=!0)),s===c.promise?h(Zi("Promise-chain cycle")):(o=ps(s))?o.call(s,u,h):u(s)):h(e)}catch(e){d&&!a&&d.exit(),h(e)}}f.reactions=[],f.notified=!1,g&&!f.rejection&&(r=p,i=f,Vi.call(Pi,function(){var e,t=i.value,n=ms(i);if(n&&(e=zi(function(){ss?ts.emit("unhandledRejection",t,r):gs(as,r,t)}),i.rejection=ss||ms(i)?ds:hs,e.error))throw e.value}))}))},gs=function(e,t,n){var r,i;os?((r=es.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Pi.dispatchEvent(r)):r={promise:t,reason:n},(i=Pi["on"+e])?i(r):e===as&&$i("Unhandled promise rejection",n)},ms=function(e){return e.rejection!==hs&&!e.parent},vs=function(t,n,r,i){return function(e){t(n,r,e,i)}},ys=function(e,t,n,r){t.done||(t.done=!0,(t=r?r:t).value=n,t.state=us,fs(e,t,!0))},_s=function(n,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(n===e)throw Zi("Promise can't be resolved itself");var i=ps(e);i?Bi(function(){var t={done:!1};try{i.call(e,vs(_s,n,t,r),vs(ys,n,t,r))}catch(e){ys(n,t,e,r)}}):(r.value=e,r.state=ls,fs(n,r,!1))}catch(e){ys(n,{done:!1},e,r)}}};Be&&(Xi=function(e){Mi(this,Xi,Hi),Di(e),Ai.call(this);var t=Qi(this);try{e(vs(_s,this,t),vs(ys,this,t))}catch(e){ys(this,t,e)}},(Ai=function(e){Yi(this,{type:Hi,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=or(Xi.prototype,{then:function(e,t){var n=Ji(this),r=rs(ji(this,Xi));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=ss?ts.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&fs(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Ni=function(){var e=new Ai,t=Qi(e);this.promise=e,this.resolve=vs(_s,e,t),this.reject=vs(ys,e,t)},ue.f=rs=function(e){return e===Xi||e===xi?new Ni:is(e)},"function"==typeof A&&(Ri=A.prototype.then,R(A.prototype,"then",function(e,t){var n=this;return new Xi(function(e,t){Ri.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof ns&&wi({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Ki(Xi,ns.apply(Pi,arguments))}}))),wi({global:!0,wrap:!0,forced:Be},{Promise:Xi}),yi(Xi,Hi,!1),Wr(Hi),xi=d(Hi),wi({target:Hi,stat:!0,forced:Be},{reject:function(e){var t=rs(this);return t.reject.call(void 0,e),t.promise}}),wi({target:Hi,stat:!0,forced:Be},{resolve:function(e){return Ki(this,e)}}),wi({target:Hi,stat:!0,forced:qi},{all:function(e){var a=this,t=rs(a),c=t.resolve,l=t.reject,n=zi(function(){var r=Di(a.resolve),i=[],s=0,o=1;Ui(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=rs(n),i=r.reject,t=zi(function(){var t=Di(n.resolve);Ui(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});var d=W,ws=n,bs=de,Is=B,Ts=l.exports;d({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=bs.f(a),c=t.resolve,n=t.reject,r=Is(function(){var r=ws(a.resolve),i=[],s=0,o=1;Ts(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});var Be=W,Es=pe,wi=e,ks=vt,Ss=x,Cs=Ze,qi=Z.exports;Be({target:"Promise",proto:!0,real:!0,forced:!!Es&&wi(function(){Es.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=Ss(this,ks("Promise")),e="function"==typeof t;return this.then(e?function(e){return Cs(n,t()).then(function(){return e})}:t,e?function(e){return Cs(n,t()).then(function(){throw e})}:t)}}),"function"!=typeof Es||Es.prototype.finally||qi(Es.prototype,"finally",ks("Promise").prototype.finally),yt.Promise;function As(e,t){var n=this;if(!(n instanceof As))return new As(e,t);Rs&&(n=Rs(new Error(t),xs(n)));var r=[];return Ps(e,r.push,r),Ns?Ds(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==t&&Os(n,"message",String(t)),n}var d=W,Ns=o,xs=ee,Rs=rt,pe=Qe,Ze=a,Be=I,Ps=l.exports,Os=k,wi=ke,Ds=wi.set,Ms=wi.getterFor("AggregateError");As.prototype=pe(Error.prototype,{constructor:Be(5,As),message:Be(5,""),name:Be(5,"AggregateError")}),Ns&&Ze.f(As.prototype,"errors",{get:function(){return Ms(this).errors},configurable:!0}),d({global:!0},{AggregateError:As});var Ls=de,Fs=B;W({target:"Promise",stat:!0},{try:function(e){var t=Ls.f(this),n=Fs(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var qi=W,Us=n,qs=vt,js=de,Vs=B,Bs=l.exports,Ks="No one promise resolved";qi({target:"Promise",stat:!0},{any:function(e){var c=this,t=js.f(c),l=t.resolve,u=t.reject,n=Vs(function(){var r=Us(c.resolve),i=[],s=0,o=1,a=!1;Bs(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(qs("AggregateError"))(i,Ks)))})}),--o||u(new(qs("AggregateError"))(i,Ks))});return n.error&&u(n.value),t.promise}});function $s(e){throw e}var zs=Me,wi=Array.isArray||function(e){return"Array"==zs(e)},Ws=c,Gs=wi,Hs=Y("species"),pe=function(e,t){var n;return new(void 0===(n=Gs(e)&&("function"==typeof(n=e.constructor)&&(n===Array||Gs(n.prototype))||Ws(n)&&null===(n=n[Hs]))?void 0:n)?Array:n)(0===t?0:t)},Qs=Te,Ys=ot,Js=$,Xs=Et,Zs=pe,eo=[].push,Be=function(p){var f=1==p,g=2==p,m=3==p,v=4==p,y=6==p,_=5==p||y;return function(e,t,n,r){for(var i,s,o=Js(e),a=Ys(o),c=Qs(t,n,3),l=Xs(a.length),u=0,h=r||Zs,d=f?h(e,l):g?h(e,0):void 0;u<l;u++)if((_||u in a)&&(s=c(i=a[u],u,o),p))if(f)d[u]=s;else if(s)switch(p){case 3:return!0;case 5:return i;case 6:return u;case 2:eo.call(d,i)}else if(v)return!1;return y?-1:m||v?v:d}},Ze={forEach:Be(0),map:Be(1),filter:Be(2),some:Be(3),every:Be(4),find:Be(5),findIndex:Be(6)},to=o,no=e,ro=O,io=Object.defineProperty,so={},d=function(e,t){if(ro(so,e))return so[e];var n=[][e],r=!!ro(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=ro(t,0)?t[0]:$s,s=ro(t,1)?t[1]:void 0;return so[e]=!!n&&!no(function(){if(r&&!to)return!0;var e={length:-1};r?io(e,1,{enumerable:!0,get:$s}):e[1]=1,n.call(e,i,s)})},de=W,oo=Ze.find,B=J,qi="find",ao=!0,Be=d(qi);qi in[]&&Array(1)[qi](function(){ao=!1}),de({target:"Array",proto:!0,forced:ao||!Be},{find:function(e){return oo(this,e,1<arguments.length?arguments[1]:void 0)}}),B(qi);var co=i,lo=Te,uo=Function.call,de=function(e,t,n){return lo(uo,co[e].prototype[t],n)};de("Array","find");var Be=W,ho=Ze.findIndex,B=J,qi="findIndex",po=!0,J=d(qi);qi in[]&&Array(1)[qi](function(){po=!1}),Be({target:"Array",proto:!0,forced:po||!J},{findIndex:function(e){return ho(this,e,1<arguments.length?arguments[1]:void 0)}}),B(qi),de("Array","findIndex");var fo=v,go=a,mo=I,J=function(e,t,n){var r=fo(t);r in e?go.f(e,r,mo(0,n)):e[r]=n},vo=Te,yo=$,_o=Ye,wo=X,bo=Et,Io=J,To=f,B=function(e){var t,n,r,i,s,o,a=yo(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,d=To(a),p=0;if(h&&(u=vo(u,2<l?arguments[2]:void 0,2)),null==d||c==Array&&wo(d))for(n=new c(t=bo(a.length));p<t;p++)o=h?u(a[p],p):a[p],Io(n,p,o);else for(s=(i=d.call(a)).next,n=new c;!(r=s.call(i)).done;p++)o=h?_o(i,u,[r.value,p],!0):r.value,Io(n,p,o);return n.length=p,n};W({target:"Array",stat:!0,forced:!r(function(e){Array.from(e)})},{from:B}),yt.Array.from;var Eo=e,qi=W,ko=Ze.some,Ye=d,X=function(e,t){var n=[][e];return!!n&&Eo(function(){n.call(null,t||function(){throw 1},1)})}("some"),B=Ye("some");qi({target:"Array",proto:!0,forced:!X||!B},{some:function(e){return ko(this,e,1<arguments.length?arguments[1]:void 0)}}),de("Array","some");function So(e){return xo(e)&&Ro(Ko,Po(e))}var Co,d="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ao=o,No=i,xo=c,Ro=O,Po=je,Oo=k,Do=Z.exports,Ye=a.f,qi=ee,Mo=rt,X=Y,B=D,Lo=No.Int8Array,Fo=Lo&&Lo.prototype,je=No.Uint8ClampedArray,ee=je&&je.prototype,Uo=Lo&&qi(Lo),qo=Fo&&qi(Fo),je=Object.prototype,jo=je.isPrototypeOf,X=X("toStringTag"),Vo=B("TYPED_ARRAY_TAG"),Bo=d&&!!Mo&&"Opera"!==Po(No.opera),d=!1,Ko={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(Co in Ko)No[Co]||(Bo=!1);if((!Bo||"function"!=typeof Uo||Uo===Function.prototype)&&(Uo=function(){throw TypeError("Incorrect invocation")},Bo))for(Co in Ko)No[Co]&&Mo(No[Co],Uo);if((!Bo||!qo||qo===je)&&(qo=Uo.prototype,Bo))for(Co in Ko)No[Co]&&Mo(No[Co].prototype,qo);if(Bo&&qi(ee)!==qo&&Mo(ee,qo),Ao&&!Ro(qo,X))for(Co in d=!0,Ye(qo,X,{get:function(){return xo(this)?this[Vo]:void 0}}),Ko)No[Co]&&Oo(No[Co],Vo,Co);var Ye=i,X={NATIVE_ARRAY_BUFFER_VIEWS:Bo,TYPED_ARRAY_TAG:d&&Vo,aTypedArray:function(e){if(So(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Mo){if(jo.call(Uo,e))return e}else for(var t in Ko)if(Ro(Ko,Co)){t=No[t];if(t&&(e===t||jo.call(t,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(Ao){if(n)for(var r in Ko){r=No[r];r&&Ro(r.prototype,e)&&delete r.prototype[e]}qo[e]&&!n||Do(qo,e,!n&&Bo&&Fo[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Ao){if(Mo){if(n)for(r in Ko)(i=No[r])&&Ro(i,e)&&delete i[e];if(Uo[e]&&!n)return;try{return Do(Uo,e,!n&&Bo&&Lo[e]||t)}catch(e){}}for(r in Ko)!(i=No[r])||i[e]&&!n||Do(i,e,t)}},isView:function(e){var t=Po(e);return"DataView"===t||Ro(Ko,t)},isTypedArray:So,TypedArray:Uo,TypedArrayPrototype:qo},d=fe,fe=Y("iterator"),Ye=Ye.Uint8Array,$o=d.values,zo=d.keys,Wo=d.entries,Go=X.aTypedArray,d=X.exportTypedArrayMethod,X=Ye&&Ye.prototype[fe],Ye=!!X&&("values"==X.name||null==X.name),X=function(){return $o.call(Go(this))};d("entries",function(){return Wo.call(Go(this))}),d("keys",function(){return zo.call(Go(this))}),d("values",X,!Ye),d(fe,X,!Ye);var Ho=o,X=e,Qo=Ie,Yo=N,Jo=Xe,Xo=$,Zo=ot,ea=Object.assign,ta=Object.defineProperty,Ye=!ea||X(function(){if(Ho&&1!==ea({b:1},ea(ta({},"a",{enumerable:!0,get:function(){ta(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=ea({},e)[n]||Qo(ea({},t)).join("")!=r})?function(e,t){for(var n=Xo(e),r=arguments.length,i=1,s=Yo.f,o=Jo.f;i<r;)for(var a,c=Zo(arguments[i++]),l=s?Qo(c).concat(s(c)):Qo(c),u=l.length,h=0;h<u;)a=l[h++],Ho&&!o.call(c,a)||(n[a]=c[a]);return n}:ea;W({target:"Object",stat:!0,forced:Object.assign!==Ye},{assign:Ye}),yt.Object.assign;var na=o,ra=Ie,ia=nt,sa=Xe.f,ot=function(a){return function(e){for(var t,n=ia(e),r=ra(n),i=r.length,s=0,o=[];s<i;)t=r[s++],na&&!sa.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}},X={entries:ot(!0),values:ot(!1)},Ye=W,oa=X.entries;Ye({target:"Object",stat:!0},{entries:function(e){return oa(e)}}),yt.Object.entries;var ot=W,aa=X.values;ot({target:"Object",stat:!0},{values:function(e){return aa(e)}}),yt.Object.values;var ca=c,la=Me,ua=Y("match"),ha=function(e){var t;return ca(e)&&(void 0!==(t=e[ua])?!!t:"RegExp"==la(e))},Ye=function(e){if(ha(e))throw TypeError("The method doesn't accept regular expressions");return e},da=Y("match"),X=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[da]=!1,"/./"[t](n)}catch(e){}}return!1},pa=Ye,fa=We;W({target:"String",proto:!0,forced:!X("includes")},{includes:function(e){return!!~String(fa(this)).indexOf(pa(e),1<arguments.length?arguments[1]:void 0)}}),de("String","includes");var ot=W,Me=Je.f,ga=Et,ma=Ye,va=We,X=X,ya="".startsWith,_a=Math.min,X=X("startsWith");ot({target:"String",proto:!0,forced:!!(X||(!(Me=Me(String.prototype,"startsWith"))||Me.writable))&&!X},{startsWith:function(e){var t=String(va(this));ma(e);var n=ga(_a(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return ya?ya.call(t,r,n):t.slice(n,n+r.length)===r}}),de("String","startsWith");var wa=ze,ba=We;W({target:"String",proto:!0},{repeat:"".repeat||function(e){var t=String(ba(this)),n="",r=wa(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),de("String","repeat");var Ia=e,Ta=he,Ea=Y("species"),ze=W,We=e,ka=wi,Sa=c,Ca=$,Aa=Et,Na=J,xa=pe,de=function(t){return 51<=Ta||!Ia(function(){var e=[];return(e.constructor={})[Ea]=function(){return{foo:1}},1!==e[t](Boolean).foo})},Et=he,Ra=Y("isConcatSpreadable"),Pa=9007199254740991,Oa="Maximum allowed index exceeded",J=51<=Et||!We(function(){var e=[];return e[Ra]=!1,e.concat()[0]!==e}),pe=de("concat");ze({target:"Array",proto:!0,forced:!J||!pe},{concat:function(e){for(var t,n,r,i=Ca(this),s=xa(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(!Sa(e))return!1;var t=e[Ra];return void 0!==t?!!t:ka(e)}(r=-1===a?i:arguments[a])){if(n=Aa(r.length),Pa<o+n)throw TypeError(Oa);for(t=0;t<n;t++,o++)t in r&&Na(s,o,r[t])}else{if(Pa<=o)throw TypeError(Oa);Na(s,o++,r)}return s.length=o,s}});var he={},Da=nt,Ma=bt.f,La={}.toString,Fa="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];he.f=function(e){return Fa&&"[object Window]"==La.call(e)?function(e){try{return Ma(e)}catch(e){return Fa.slice()}}(e):Ma(Da(e))};Et={};Et.f=Y;function Ua(e,t){var n=_c[e]=Za(pc[lc]);return uc(n,{type:cc,tag:e,description:t}),$a||(n.description=t),n}function qa(t,e){Ha(t);var n=Ya(e),r=ec(n).concat(Ac(n));return oc(r,function(e){$a&&!Cc.call(n,e)||Sc(t,e,n[e])}),t}var ja=yt,Va=O,Ba=Et,Ka=a.f,We=function(e){var t=ja.Symbol||(ja.Symbol={});Va(t,e)||Ka(t,e,{value:Ba.f(e)})},de=W,ze=i,J=vt,$a=o,pe=q,q=j,j=e,za=O,Wa=wi,Ga=c,Ha=t,Qa=$,Ya=nt,Ja=v,Xa=I,Za=Qe,ec=Ie,v=bt,I=he,tc=N,Ie=Je,bt=a,he=Xe,N=k,Je=Z.exports,Xe=s.exports,k=ve,nc=ye,rc=D,ic=Y,s=Et,sc=We,ve=tt,Y=ke,oc=Ze.forEach,ac=k("hidden"),cc="Symbol",lc="prototype",k=ic("toPrimitive"),uc=Y.set,hc=Y.getterFor(cc),dc=Object[lc],pc=ze.Symbol,fc=J("JSON","stringify"),gc=Ie.f,mc=bt.f,vc=I.f,yc=he.f,_c=Xe("symbols"),wc=Xe("op-symbols"),bc=Xe("string-to-symbol-registry"),Ic=Xe("symbol-to-string-registry"),Xe=Xe("wks"),ze=ze.QObject,Tc=!ze||!ze[lc]||!ze[lc].findChild,Ec=$a&&j(function(){return 7!=Za(mc({},"a",{get:function(){return mc(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=gc(dc,t);r&&delete dc[t],mc(e,t,n),r&&e!==dc&&mc(dc,t,r)}:mc,kc=q?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof pc},Sc=function(e,t,n){e===dc&&Sc(wc,t,n),Ha(e);var r=Ja(t,!0);return Ha(n),za(_c,r)?(n.enumerable?(za(e,ac)&&e[ac][r]&&(e[ac][r]=!1),n=Za(n,{enumerable:Xa(0,!1)})):(za(e,ac)||mc(e,ac,Xa(1,{})),e[ac][r]=!0),Ec(e,r,n)):mc(e,r,n)},Cc=function(e){var t=Ja(e,!0),n=yc.call(this,t);return!(this===dc&&za(_c,t)&&!za(wc,t))&&(!(n||!za(this,t)||!za(_c,t)||za(this,ac)&&this[ac][t])||n)},ze=function(e,t){var n=Ya(e),r=Ja(t,!0);if(n!==dc||!za(_c,r)||za(wc,r)){var i=gc(n,r);return!i||!za(_c,r)||za(n,ac)&&n[ac][r]||(i.enumerable=!0),i}},q=function(e){var t=vc(Ya(e)),n=[];return oc(t,function(e){za(_c,e)||za(nc,e)||n.push(e)}),n},Ac=function(e){var t=e===dc,n=vc(t?wc:Ya(e)),r=[];return oc(n,function(e){!za(_c,e)||t&&!za(dc,e)||r.push(_c[e])}),r};pe||(Je((pc=function(){if(this instanceof pc)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=rc(e),n=function(e){this===dc&&n.call(wc,e),za(this,ac)&&za(this[ac],t)&&(this[ac][t]=!1),Ec(this,t,Xa(1,e))};return $a&&Tc&&Ec(dc,t,{configurable:!0,set:n}),Ua(t,e)})[lc],"toString",function(){return hc(this).tag}),Je(pc,"withoutSetter",function(e){return Ua(rc(e),e)}),he.f=Cc,bt.f=Sc,Ie.f=ze,v.f=I.f=q,tc.f=Ac,s.f=function(e){return Ua(ic(e),e)},$a&&(mc(pc[lc],"description",{configurable:!0,get:function(){return hc(this).description}}),Je(dc,"propertyIsEnumerable",Cc,{unsafe:!0}))),de({global:!0,wrap:!0,forced:!pe,sham:!pe},{Symbol:pc}),oc(ec(Xe),function(e){sc(e)}),de({target:cc,stat:!0,forced:!pe},{for:function(e){var t=String(e);if(za(bc,t))return bc[t];var n=pc(t);return bc[t]=n,Ic[n]=t,n},keyFor:function(e){if(!kc(e))throw TypeError(e+" is not a symbol");if(za(Ic,e))return Ic[e]},useSetter:function(){Tc=!0},useSimple:function(){Tc=!1}}),de({target:"Object",stat:!0,forced:!pe,sham:!$a},{create:function(e,t){return void 0===t?Za(e):qa(Za(e),t)},defineProperty:Sc,defineProperties:qa,getOwnPropertyDescriptor:ze}),de({target:"Object",stat:!0,forced:!pe},{getOwnPropertyNames:q,getOwnPropertySymbols:Ac}),de({target:"Object",stat:!0,forced:j(function(){tc.f(1)})},{getOwnPropertySymbols:function(e){return tc.f(Qa(e))}}),fc&&de({target:"JSON",stat:!0,forced:!pe||j(function(){var e=pc();return"[null]"!=fc([e])||"{}"!=fc({a:e})||"{}"!=fc(Object(e))})},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((Ga(r=t)||void 0!==e)&&!kc(e))return Wa(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!kc(t))return t}),i[1]=t,fc.apply(null,i)}}),pc[lc][k]||N(pc[lc],k,pc[lc].valueOf),ve(pc,cc),nc[ac]=!0,We("asyncIterator");var Nc,xc,Rc,Pc,Oc,k=W,Dc=O,Mc=c,ve=a.f,U=U,Lc=i.Symbol;!o||"function"!=typeof Lc||"description"in Lc.prototype&&void 0===Lc().description||(Nc={},U(xc=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof xc?new Lc(e):void 0===e?Lc():Lc(e);return""===e&&(Nc[t]=!0),t},Lc),(U=xc.prototype=Lc.prototype).constructor=xc,Rc=U.toString,Pc="Symbol(test)"==String(Lc("test")),Oc=/^Symbol\((.*)\)[^)]+$/,ve(U,"description",{configurable:!0,get:function(){var e=Mc(this)?this.valueOf():this,t=Rc.call(e);if(Dc(Nc,e))return"";t=Pc?t.slice(7,-1):t.replace(Oc,"$1");return""===t?void 0:t}}),k({global:!0,forced:!0},{Symbol:xc})),We("hasInstance"),We("isConcatSpreadable"),We("iterator"),We("match"),We("matchAll"),We("replace"),We("search"),We("species"),We("split"),We("toPrimitive"),We("toStringTag"),We("unscopables"),tt(Math,"Math",!0),tt(i.JSON,"JSON",!0),yt.Symbol,We("asyncDispose"),We("dispose"),We("observable"),We("patternMatch"),We("replaceAll"),Et.f("iterator");function Fc(e){jc(e,Bc,{value:{objectID:"O"+ ++Kc,weakData:{}}})}var We={exports:{}},Et=!e(function(){return Object.isExtensible(Object.preventExtensions({}))}),ye=ye,Uc=c,qc=O,jc=a.f,Vc=Et,Bc=D("meta"),Kc=0,$c=Object.isExtensible||function(){return!0},zc=We.exports={REQUIRED:!1,fastKey:function(e,t){if(!Uc(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!qc(e,Bc)){if(!$c(e))return"F";if(!t)return"E";Fc(e)}return e[Bc].objectID},getWeakData:function(e,t){if(!qc(e,Bc)){if(!$c(e))return!0;if(!t)return!1;Fc(e)}return e[Bc].weakData},onFreeze:function(e){return Vc&&zc.REQUIRED&&$c(e)&&!qc(e,Bc)&&Fc(e),e}};ye[Bc]=!0;var Wc=c,Gc=rt,Hc=W,Qc=i,Yc=V,Jc=Z.exports,Xc=We.exports,Zc=l.exports,el=Le,tl=c,nl=e,rl=r,il=tt,sl=function(e,t,n){var r,i;return Gc&&"function"==typeof(r=t.constructor)&&r!==n&&Wc(i=r.prototype)&&i!==n.prototype&&Gc(e,i),e},tt=function(r,e,t){function n(e){var n=p[e];Jc(p,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!tl(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!tl(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!tl(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var i,s,o,a,c,l=-1!==r.indexOf("Map"),u=-1!==r.indexOf("Weak"),h=l?"set":"add",d=Qc[r],p=d&&d.prototype,f=d,g={};return Yc(r,"function"!=typeof d||!(u||p.forEach&&!nl(function(){(new d).entries().next()})))?(f=t.getConstructor(e,r,l,h),Xc.REQUIRED=!0):Yc(r,!0)&&(s=(i=new f)[h](u?{}:-0,1)!=i,o=nl(function(){i.has(1)}),a=rl(function(e){new d(e)}),c=!u&&nl(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),a||(((f=e(function(e,t){el(e,f,r);var n=sl(new d,e,f);return null!=t&&Zc(t,n[h],n,l),n})).prototype=p).constructor=f),(o||c)&&(n("delete"),n("has"),l&&n("get")),(c||s)&&n(h),u&&p.clear&&delete p.clear),g[r]=f,Hc({global:!0,forced:f!=d},g),il(f,r),u||t.setStrong(f,r,l),f},ol=a.f,al=Qe,cl=Er,ll=Te,ul=Le,hl=l.exports,dl=Rt,pl=Ee,fl=o,gl=We.exports.fastKey,ml=ke.set,vl=ke.getterFor,Rt={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i,s=c(e),o=a(e,t);return o?o.value=n:(s.last=o={index:i=gl(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=o),r&&(r.next=o),fl?s.size++:e.size++,"F"!==i&&(s.index[i]=o)),e}function a(e,t){var n,r=c(e),i=gl(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n}var o=e(function(e,t){ul(e,o,n),ml(e,{type:n,index:al(null),first:void 0,last:void 0,size:0}),fl||(e.size=0),null!=t&&hl(t,e[i],e,r)}),c=vl(n);return cl(o.prototype,{clear:function(){for(var e=c(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,fl?e.size=0:this.size=0},delete:function(e){var t,n,r=c(this),i=a(this,e);return i&&(t=i.next,n=i.previous,delete r.index[i.index],i.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==i&&(r.first=t),r.last==i&&(r.last=n),fl?r.size--:this.size--),!!i},forEach:function(e){for(var t,n=c(this),r=ll(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),cl(o.prototype,r?{get:function(e){var t=a(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),fl&&ol(o.prototype,"size",{get:function(){return c(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",i=vl(t),s=vl(r);dl(e,t,function(e,t){ml(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),pl(t)}};tt("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Rt),yt.Map;var yl=n,_l=Te,wl=l.exports,Ee=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return yl(this),(t=void 0!==o)&&yl(o),null==e?new this:(n=[],t?(r=0,i=_l(o,2<s?arguments[2]:void 0,2),wl(e,function(e){n.push(i(e,r++))})):wl(e,n.push,n),new this(n))};W({target:"Map",stat:!0},{from:Ee});o=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};W({target:"Map",stat:!0},{of:o});var bl=t,Il=n,We=function(){for(var e,t=bl(this),n=Il(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r},Tl=We;W({target:"Map",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Tl.apply(this,arguments)}});var El=t,kl=f,ke=function(e){return Map.prototype.entries.call(e)},f=W,Sl=t,Cl=Te,Al=ke,Nl=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{every:function(e){var n=Sl(this),t=Al(n),r=Cl(e,1<arguments.length?arguments[1]:void 0,3);return!Nl(t,function(e,t){if(!r(t,e,n))return Nl.stop()},void 0,!0,!0).stopped}});var f=W,xl=vt,Rl=t,Pl=n,Ol=Te,Dl=x,Ml=ke,Ll=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{filter:function(e){var n=Rl(this),t=Ml(n),r=Ol(e,1<arguments.length?arguments[1]:void 0,3),i=new(Dl(n,xl("Map"))),s=Pl(i.set);return Ll(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},void 0,!0,!0),i}});var f=W,Fl=t,Ul=Te,ql=ke,jl=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{find:function(e){var n=Fl(this),t=ql(n),r=Ul(e,1<arguments.length?arguments[1]:void 0,3);return jl(t,function(e,t){if(r(t,e,n))return jl.stop(t)},void 0,!0,!0).result}});var f=W,Vl=t,Bl=Te,Kl=ke,$l=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{findKey:function(e){var n=Vl(this),t=Kl(n),r=Bl(e,1<arguments.length?arguments[1]:void 0,3);return $l(t,function(e,t){if(r(t,e,n))return $l.stop(e)},void 0,!0,!0).result}});var f=W,zl=l.exports,Wl=n;f({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;Wl(n);var i=Wl(r.has),s=Wl(r.get),o=Wl(r.set);return zl(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});var f=W,Gl=t,Hl=ke,Ql=function(e,t){return e===t||e!=e&&t!=t},Yl=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{includes:function(n){return Yl(Hl(Gl(this)),function(e,t){if(Ql(t,n))return Yl.stop()},void 0,!0,!0).stopped}});var f=W,Jl=l.exports,Xl=n;f({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;Xl(t);var r=Xl(n.set);return Jl(e,function(e){r.call(n,t(e),e)}),n}});var f=W,Zl=t,eu=ke,tu=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{keyOf:function(n){return tu(eu(Zl(this)),function(e,t){if(t===n)return tu.stop(e)},void 0,!0,!0).result}});var f=W,nu=vt,ru=t,iu=n,su=Te,ou=x,au=ke,cu=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{mapKeys:function(e){var n=ru(this),t=au(n),r=su(e,1<arguments.length?arguments[1]:void 0,3),i=new(ou(n,nu("Map"))),s=iu(i.set);return cu(t,function(e,t){s.call(i,r(t,e,n),t)},void 0,!0,!0),i}});var f=W,lu=vt,uu=t,hu=n,du=Te,pu=x,fu=ke,gu=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{mapValues:function(e){var n=uu(this),t=fu(n),r=du(e,1<arguments.length?arguments[1]:void 0,3),i=new(pu(n,lu("Map"))),s=hu(i.set);return gu(t,function(e,t){s.call(i,e,r(t,e,n))},void 0,!0,!0),i}});var f=W,mu=t,vu=n,yu=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{merge:function(e){for(var t=mu(this),n=vu(t.set),r=0;r<arguments.length;)yu(arguments[r++],n,t,!0);return t}});var f=W,_u=t,wu=n,bu=ke,Iu=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{reduce:function(n){var r=_u(this),e=bu(r),i=arguments.length<2,s=i?void 0:arguments[1];if(wu(n),Iu(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return s}});var f=W,Tu=t,Eu=Te,ku=ke,Su=l.exports;f({target:"Map",proto:!0,real:!0,forced:!1},{some:function(e){var n=Tu(this),t=ku(n),r=Eu(e,1<arguments.length?arguments[1]:void 0,3);return Su(t,function(e,t){if(r(t,e,n))return Su.stop()},void 0,!0,!0).stopped}});var Cu=t,Au=n;W({target:"Map",proto:!0,real:!0,forced:!1},{update:function(e,t){var n=Cu(this),r=arguments.length;Au(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");r=i?n.get(e):Au(2<r?arguments[2]:void 0)(e,n);return n.set(e,t(r,e,n)),n}});var Nu=t,f=function(e,t){var n,r=Nu(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n};W({target:"Map",proto:!0,real:!0,forced:!1},{upsert:f});W({target:"Map",proto:!0,real:!0,forced:!1},{updateOrInsert:f}),tt("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Rt),yt.Set,W({target:"Set",stat:!0},{from:Ee}),W({target:"Set",stat:!0},{of:o});var xu=t,Ru=n,Pu=function(){for(var e=xu(this),t=Ru(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};W({target:"Set",proto:!0,real:!0,forced:!1},{addAll:function(){return Pu.apply(this,arguments)}});var Ou=We;W({target:"Set",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Ou.apply(this,arguments)}});var o=function(e){return Set.prototype.values.call(e)},We=W,Du=t,Mu=Te,Lu=o,Fu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{every:function(e){var t=Du(this),n=Lu(t),r=Mu(e,1<arguments.length?arguments[1]:void 0,3);return!Fu(n,function(e){if(!r(e,e,t))return Fu.stop()},void 0,!1,!0).stopped}});var We=W,Uu=vt,qu=t,ju=n,Vu=x,Bu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{difference:function(e){var t=qu(this),n=new(Vu(t,Uu("Set")))(t),r=ju(n.delete);return Bu(e,function(e){r.call(n,e)}),n}});var We=W,Ku=vt,$u=t,zu=n,Wu=Te,Gu=x,Hu=o,Qu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{filter:function(e){var t=$u(this),n=Hu(t),r=Wu(e,1<arguments.length?arguments[1]:void 0,3),i=new(Gu(t,Ku("Set"))),s=zu(i.add);return Qu(n,function(e){r(e,e,t)&&s.call(i,e)},void 0,!1,!0),i}});var We=W,Yu=t,Ju=Te,Xu=o,Zu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{find:function(e){var t=Yu(this),n=Xu(t),r=Ju(e,1<arguments.length?arguments[1]:void 0,3);return Zu(n,function(e){if(r(e,e,t))return Zu.stop(e)},void 0,!1,!0).result}});var We=W,eh=vt,th=t,nh=n,rh=x,ih=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{intersection:function(e){var t=th(this),n=new(rh(t,eh("Set"))),r=nh(t.has),i=nh(n.add);return ih(e,function(e){r.call(t,e)&&i.call(n,e)}),n}});var We=W,sh=t,oh=n,ah=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isDisjointFrom:function(e){var t=sh(this),n=oh(t.has);return!ah(e,function(e){if(!0===n.call(t,e))return ah.stop()}).stopped}});var We=W,ch=vt,lh=t,uh=n,hh=function(e){var t=kl(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return El(t.call(e))},dh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isSubsetOf:function(e){var t=hh(this),n=lh(e),r=n.has;return"function"!=typeof r&&(n=new(ch("Set"))(e),r=uh(n.has)),!dh(t,function(e){if(!1===r.call(n,e))return dh.stop()},void 0,!1,!0).stopped}});var We=W,ph=t,fh=n,gh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isSupersetOf:function(e){var t=ph(this),n=fh(t.has);return!gh(e,function(e){if(!1===n.call(t,e))return gh.stop()}).stopped}});var We=W,mh=t,vh=o,yh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{join:function(e){var t=mh(this),n=vh(t),r=void 0===e?",":String(e),t=[];return yh(n,t.push,t,!1,!0),t.join(r)}});var We=W,_h=vt,wh=t,bh=n,Ih=Te,Th=x,Eh=o,kh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{map:function(e){var t=wh(this),n=Eh(t),r=Ih(e,1<arguments.length?arguments[1]:void 0,3),i=new(Th(t,_h("Set"))),s=bh(i.add);return kh(n,function(e){s.call(i,r(e,e,t))},void 0,!1,!0),i}});var We=W,Sh=t,Ch=n,Ah=o,Nh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{reduce:function(t){var n=Sh(this),e=Ah(n),r=arguments.length<2,i=r?void 0:arguments[1];if(Ch(t),Nh(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},void 0,!1,!0),r)throw TypeError("Reduce of empty set with no initial value");return i}});var We=W,xh=t,Rh=Te,Ph=o,Oh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{some:function(e){var t=xh(this),n=Ph(t),r=Rh(e,1<arguments.length?arguments[1]:void 0,3);return Oh(n,function(e){if(r(e,e,t))return Oh.stop()},void 0,!1,!0).stopped}});var We=W,Dh=vt,Mh=t,Lh=n,Fh=x,Uh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{symmetricDifference:function(e){var t=Mh(this),n=new(Fh(t,Dh("Set")))(t),r=Lh(n.delete),i=Lh(n.add);return Uh(e,function(e){r.call(n,e)||i.call(n,e)}),n}});var We=W,qh=vt,jh=t,Vh=n,Bh=x,Kh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{union:function(e){var t=jh(this),t=new(Bh(t,qh("Set")))(t);return Kh(e,Vh(t.add),t),t}});var $h,zh,Wh=c,Gh=Math.floor;W({target:"Number",stat:!0},{isInteger:function(e){return!Wh(e)&&isFinite(e)&&Gh(e)===e}}),yt.Number.isInteger;function Hh(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}function Qh(e){var t=Hh(e);return Zh.encodeByteArray(t,!0)}const Yh={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Jh=function(e,t){if(!e)throw Xh(t)},Xh=function(e){return new Error("Firebase Database ("+Yh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},Zh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],o=u+1<n.length,a=o?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&a)<<2|l>>6,t=63&l;c||(t=64,o||(e=64)),i.push(r[s>>2],r[(3&s)<<4|a>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Hh(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(i=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&i)):239<o&&o<365?(s=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var o=c<e.length?n[e.charAt(c)]:64;++c;var a=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==o||null==a)throw Error();r.push(i<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},ed=function(e){return Qh(e).replace(/\./g,"")},td=function(e){try{return Zh.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function nd(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=nd(e[r],t[r]));return e}class rd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function id(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[ed(JSON.stringify({alg:"none",type:"JWT"})),ed(JSON.stringify(i)),""].join(".")}function sd(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function od(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(sd())}function ad(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function cd(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ld(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ud(){const e=sd();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function hd(){return!0===Yh.NODE_ADMIN}function dd(){return"object"==typeof indexedDB}function pd(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function fd(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class gd extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,gd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,md.prototype.create)}}class md{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(vd,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new gd(i,s,n)}}const vd=/\{\$([^}]+)}/g;function yd(e){return JSON.parse(e)}function _d(e){return JSON.stringify(e)}function wd(e){let t={},n={},r={},i="";try{var s=e.split(".");t=yd(td(s[0])||""),n=yd(td(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function bd(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Id(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Td(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ed(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function kd(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const o of n){if(!r.includes(o))return;var i=e[o],s=t[o];if(Sd(i)&&Sd(s)){if(!kd(i,s))return}else if(i!==s)return}for(const a of r)if(!n.includes(a))return;return 1}function Sd(e){return null!==e&&"object"==typeof e}function Cd(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Ad(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function Nd(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class xd{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let p=0;p<80;p++){u=p<40?p<20?(l=a^s&(o^a),1518500249):(l=s^o^a,1859775393):p<60?(l=s&o|a&(s|o),2400959708):(l=s^o^a,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[p]&4294967295;c=a,a=o,o=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function Rd(e,t){const n=new Pd(e,t);return n.subscribe.bind(n)}class Pd{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Od),void 0===r.error&&(r.error=Od),void 0===r.complete&&(r.complete=Od);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Od(){}function Dd(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function Md(e,t){return`${e} failed: ${t} argument `}function Ld(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Md(e,t)+"must be a valid function.")}function Fd(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Md(e,t)+"must be a valid context object.")}const Ud=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},qd=1e3,jd=2,Vd=144e5,Bd=.5;function Kd(e,t=qd,n=jd){var r=t*Math.pow(n,e),i=Math.round(Bd*r*(Math.random()-.5)*2);return Math.min(Vd,r+i)}function $d(e){return e&&e._delegate?e._delegate:e}class zd{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Wd="[DEFAULT]";class Gd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new rd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Wd})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=Wd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Wd){return this.instances.has(e)}getOptions(e=Wd){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===Wd?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Wd){return!this.component||this.component.multipleInstances?e:Wd}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Hd{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new Gd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Qd=[];(zh=$h=$h||{})[zh.DEBUG=0]="DEBUG",zh[zh.VERBOSE=1]="VERBOSE",zh[zh.INFO=2]="INFO",zh[zh.WARN=3]="WARN",zh[zh.ERROR=4]="ERROR",zh[zh.SILENT=5]="SILENT";const Yd={debug:$h.DEBUG,verbose:$h.VERBOSE,info:$h.INFO,warn:$h.WARN,error:$h.ERROR,silent:$h.SILENT},Jd=$h.INFO,Xd={[$h.DEBUG]:"log",[$h.VERBOSE]:"log",[$h.INFO]:"info",[$h.WARN]:"warn",[$h.ERROR]:"error"},Zd=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=Xd[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class ep{constructor(e){this.name=e,this._logLevel=Jd,this._logHandler=Zd,this._userLogHandler=null,Qd.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $h))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Yd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$h.DEBUG,...e),this._logHandler(this,$h.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$h.VERBOSE,...e),this._logHandler(this,$h.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$h.INFO,...e),this._logHandler(this,$h.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$h.WARN,...e),this._logHandler(this,$h.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$h.ERROR,...e),this._logHandler(this,$h.ERROR,...e)}}class tp{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const np="@firebase/app",rp=new ep("@firebase/app");var ip;const sp="[DEFAULT]",op={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ap=new Map,cp=new Map;function lp(t,n){try{t.container.addComponent(n)}catch(e){rp.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function up(e,t){e.container.addOrOverwriteComponent(t)}function hp(e){var t=e.name;if(cp.has(t))return rp.debug(`There were multiple attempts to register component ${t}.`),!1;cp.set(t,e);for(const n of ap.values())lp(n,e);return!0}function dp(e,t){return e.container.getProvider(t)}const pp=new md("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class fp{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new zd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pp.create("app-deleted",{appName:this._name})}}const gp="9.6.7";function mp(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:sp,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw pp.create("bad-app-name",{appName:String(r)});var i=ap.get(r);if(i){if(kd(e,i.options)&&kd(n,i.config))return i;throw pp.create("duplicate-app",{appName:r})}const s=new Hd(r);for(const o of cp.values())s.addComponent(o);n=new fp(e,n,s);return ap.set(r,n),n}function vp(e=sp){var t=ap.get(e);if(!t)throw pp.create("no-app",{appName:e});return t}async function yp(e){var t=e.name;ap.has(t)&&(ap.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function _p(e,t,n){let r=null!==(s=op[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${t}":`];return i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void rp.warn(o.join(" "))}hp(new zd(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function wp(e,t){if(null!==e&&"function"!=typeof e)throw pp.create("invalid-log-argument");!function(s,e){for(const t of Qd){let i=null;e&&e.level&&(i=Yd[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:$h[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function bp(e){var t;t=e,Qd.forEach(e=>{e.setLogLevel(t)})}ip="",hp(new zd("platform-logger",e=>new tp(e),"PRIVATE")),_p(np,"0.7.17",ip),_p(np,"0.7.17","esm2017"),_p("fire-js","");var Ip=Object.freeze({__proto__:null,SDK_VERSION:gp,_DEFAULT_ENTRY_NAME:sp,_addComponent:lp,_addOrOverwriteComponent:up,_apps:ap,_clearComponents:function(){cp.clear()},_components:cp,_getProvider:dp,_registerComponent:hp,_removeServiceInstance:function(e,t,n=sp){dp(e,t).clearInstance(n)},deleteApp:yp,getApp:vp,getApps:function(){return Array.from(ap.values())},initializeApp:mp,onLog:wp,registerVersion:_p,setLogLevel:bp,FirebaseError:gd});class Tp{constructor(e,t){this._delegate=e,this.firebase=t,lp(e,new zd("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),yp(this._delegate)))}_getService(e,t=sp){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=sp){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){lp(this._delegate,e)}_addOrOverwriteComponent(e){up(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Ep=new md("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function kp(i){const s={},o={__esModule:!0,initializeApp:function(e,t={}){var n=mp(e,t);if(bd(s,n.name))return s[n.name];var r=new i(n,o);return s[n.name]=r},app:a,registerVersion:_p,setLogLevel:bp,onLog:wp,apps:null,SDK_VERSION:gp,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;hp(n)&&"PUBLIC"===n.type&&(e=(e=a())=>{if("function"!=typeof e[t])throw Ep.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&nd(e,n.serviceProps),o[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?o[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:Ip}};function a(e){if(e=e||sp,!bd(s,e))throw Ep.create("no-app",{appName:e});return s[e]}return o.default=o,Object.defineProperty(o,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),a.App=i,o}l=function e(){const t=kp(Tp);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){nd(t,e)},createSubscribe:Rd,ErrorFactory:md,deepExtend:nd}),t}();const Sp=new ep("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Sp.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const EK=self.firebase.SDK_VERSION;EK&&0<=EK.indexOf("LITE")&&Sp.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Cp=l;_p("@firebase/app-compat","0.1.18",void 0);Cp.registerVersion("firebase","9.6.7","app-compat");function Ap(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Np(n,r,i){var s,e=new Promise(function(e,t){Ap(s=n[r].apply(n,i)).then(e,t)});return e.request=s,e}function xp(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function Rp(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return Np(this[n],e,arguments)})})}function Pp(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function Op(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=Np(e,n,arguments)).then(function(e){if(e)return new Mp(e,t.request)});var e,t})})}function Dp(e){this._index=e}function Mp(e,t){this._cursor=e,this._request=t}function Lp(e){this._store=e}function Fp(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function Up(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new Fp(n)}function qp(e){this._db=e}function jp(e,t,n){var r=Np(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){n&&n(new Up(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new qp(e)})}function Vp(e){return Np(indexedDB,"deleteDatabase",[e])}xp(Dp,"_index",["name","keyPath","multiEntry","unique"]),Rp(Dp,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),Op(Dp,"_index",IDBIndex,["openCursor","openKeyCursor"]),xp(Mp,"_cursor",["direction","key","primaryKey","value"]),Rp(Mp,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(Mp.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),Ap(t._request).then(function(e){if(e)return new Mp(e,t._request)})})})}),Lp.prototype.createIndex=function(){return new Dp(this._store.createIndex.apply(this._store,arguments))},Lp.prototype.index=function(){return new Dp(this._store.index.apply(this._store,arguments))},xp(Lp,"_store",["name","keyPath","indexNames","autoIncrement"]),Rp(Lp,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),Op(Lp,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Pp(Lp,"_store",IDBObjectStore,["deleteIndex"]),Fp.prototype.objectStore=function(){return new Lp(this._tx.objectStore.apply(this._tx,arguments))},xp(Fp,"_tx",["objectStoreNames","mode"]),Pp(Fp,"_tx",IDBTransaction,["abort"]),Up.prototype.createObjectStore=function(){return new Lp(this._db.createObjectStore.apply(this._db,arguments))},xp(Up,"_db",["name","version","objectStoreNames"]),Pp(Up,"_db",IDBDatabase,["deleteObjectStore","close"]),qp.prototype.transaction=function(){return new Fp(this._db.transaction.apply(this._db,arguments))},xp(qp,"_db",["name","version","objectStoreNames"]),Pp(qp,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(s){[Lp,Dp].forEach(function(e){s in e.prototype&&(e.prototype[s.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[s].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[Dp,Lp].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});We="@firebase/installations",c="0.5.5";const Bp=1e4,Kp="w:0.5.5",$p="FIS_v2",zp="https://firebaseinstallations.googleapis.com/v1",Wp=36e5;const Gp=new md("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Hp(e){return e instanceof gd&&e.code.includes("request-failed")}function Qp({projectId:e}){return`${zp}/projects/${e}/installations`}function Yp(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function Jp(e,t){var n=(await t.json()).error;return Gp.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Xp({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Zp(e,{refreshToken:t}){const n=Xp(e);return n.append("Authorization",(t=t,`${$p} ${t}`)),n}async function ef(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function tf(t){return new Promise(e=>{setTimeout(e,t)})}const nf=/^[cdef][\w-]{21}$/,rf="";function sf(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return nf.test(e)?e:rf}catch(e){return rf}}function of(e){return`${e.appName}!${e.appId}`}const af=new Map;function cf(e,t){var n=of(e);lf(n,t),function(e,t){const n=function(){!uf&&"BroadcastChannel"in self&&(uf=new BroadcastChannel("[Firebase] FID Change"),uf.onmessage=e=>{lf(e.data.key,e.data.fid)});return uf}();n&&n.postMessage({key:e,fid:t});0===af.size&&uf&&(uf.close(),uf=null)}(n,t)}function lf(e,t){var n=af.get(e);if(n)for(const r of n)r(t)}let uf=null;const hf="firebase-installations-store";let df=null;function pf(){return df=df||jp("firebase-installations-database",1,e=>{0===e.oldVersion&&e.createObjectStore(hf)}),df}async function ff(e,t){var n=of(e);const r=await pf(),i=r.transaction(hf,"readwrite"),s=i.objectStore(hf);var o=await s.get(n);return await s.put(t,n),await i.complete,o&&o.fid===t.fid||cf(e,t.fid),t}async function gf(e){var t=of(e);const n=await pf(),r=n.transaction(hf,"readwrite");await r.objectStore(hf).delete(t),await r.complete}async function mf(e,t){var n=of(e);const r=await pf(),i=r.transaction(hf,"readwrite"),s=i.objectStore(hf);var o=await s.get(n),a=t(o);return void 0===a?await s.delete(n):await s.put(a,n),await i.complete,!a||o&&o.fid===a.fid||cf(e,a.fid),a}async function vf(n){let r;var e=await mf(n,e=>{var t=_f(e||{fid:sf(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await yf(e);for(;1===t.registrationStatus;)await tf(100),t=await yf(e);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await vf(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(Gp.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function(e,{fid:t}){const n=Qp(e);var r=Xp(e),i={fid:t,authVersion:$p,appId:e.appId,sdkVersion:Kp};const s={method:"POST",headers:r,body:JSON.stringify(i)},o=await ef(()=>fetch(n,s));if(o.ok){i=await o.json();return{fid:i.fid||t,registrationStatus:2,refreshToken:i.refreshToken,authToken:Yp(i.authToken)}}throw await Jp("Create Installation",o)}(t,n);return ff(t,e)}catch(e){throw Hp(e)&&409===e.customData.serverCode?await gf(t):await ff(t,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===rf?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function yf(e){return mf(e,e=>{if(!e)throw Gp.create("installation-not-found");return _f(e)})}function _f(e){return 1===(t=e).registrationStatus&&t.registrationTime+Bp<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function wf({appConfig:e,platformLoggerProvider:t},n){const r=([i,s]=[e,n["fid"]],`${Qp(i)}/${s}/authTokens:generate`);var i,s;const o=Zp(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString());var c={installation:{sdkVersion:Kp}};const l={method:"POST",headers:o,body:JSON.stringify(c)},u=await ef(()=>fetch(r,l));if(u.ok)return Yp(await u.json());throw await Jp("Generate Auth Token",u)}async function bf(r,i=!1){let s;var e=await mf(r.appConfig,e=>{if(!Tf(e))throw Gp.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Wp}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await If(e.appConfig);for(;1===n.authToken.requestStatus;)await tf(100),n=await If(e.appConfig);var r=n.authToken;return 0===r.requestStatus?bf(e,t):r}(r,i),e;if(!navigator.onLine)throw Gp.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await wf(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await ff(t.appConfig,e),r}catch(e){throw!Hp(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await ff(t.appConfig,r)):await gf(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function If(e){return mf(e,e=>{if(!Tf(e))throw Gp.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+Bp<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Tf(e){return void 0!==e&&2===e.registrationStatus}async function Ef(e,t=!1){var n,r=e;return e=r.appConfig,await((n=(await vf(e)).registrationPromise)&&await n),(await bf(r,t)).token}function kf(e){return Gp.create("missing-app-config-values",{valueName:e})}const Sf="installations",Cf=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw kf("App Configuration");if(!e.name)throw kf("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw kf(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:dp(t,"platform-logger"),_delete:()=>Promise.resolve()}},Af=e=>{const t=dp(e.getProvider("app").getImmediate(),Sf).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await vf(t.appConfig);return(r||bf(t)).catch(console.error),n.fid}(t),getToken:e=>Ef(t,e)}};hp(new zd(Sf,Cf,"PUBLIC")),hp(new zd("installations-internal",Af,"PRIVATE")),_p(We,c),_p(We,c,"esm2017");const Nf="analytics",xf="firebase_id",Rf="origin",Pf="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Of="https://www.googletagmanager.com/gtag/js",Df=new ep("@firebase/analytics");function Mf(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Lf(r,i,s,o){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await Mf(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){Df.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){var o=r[i];try{if(o)await t[o];else{const c=await Mf(n);var a=c.find(e=>e.measurementId===i);a&&await t[a.appId]}}catch(e){Df.error(e)}e("config",i,s)}(r,i,s,o,t,n):r("set",t)}catch(e){Df.error(e)}}}const Ff=new md("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Uf=30;const qf=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function jf(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=Pf.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw Ff.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function Vf(e,t=qf,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw Ff.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Ff.create("no-api-key")}var o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const a=new $f;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=qf){const{appId:o,measurementId:a}=n;try{await Bf(i,e)}catch(e){if(a)return Df.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}try{const c=await jf(n);return s.deleteThrottleMetadata(o),c}catch(e){if(!Kf(e)){if(s.deleteThrottleMetadata(o),a)return Df.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(e.customData.httpStatus)?Kd(r,s.intervalMillis,Uf):Kd(r,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(o,u),Df.debug(`Calling attemptFetch again in ${l} millis`),t(n,u,i,s)}}({appId:r,apiKey:i,measurementId:s},o,a,t)}function Bf(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(Ff.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function Kf(e){if(!(e instanceof gd&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class $f{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function zf(t,e,n,r,i,s,o){const a=Vf(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Df.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Df.error(e)),e.push(a);var c=async function(){if(!dd())return Df.warn(Ff.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await pd()}catch(e){return Df.warn(Ff.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Of))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${Of}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,l.measurementId),i("js",new Date);const h=null!==(c=null==o?void 0:o.config)&&void 0!==c?c:{};return h[Rf]="firebase",h.update=!0,null!=u&&(h[xf]=u),i("config",l.measurementId,h),l.measurementId}class Wf{constructor(e){this.app=e}_delete(){return delete Gf[this.app.options.appId],Promise.resolve()}}let Gf={},Hf=[];const Qf={};let Yf="dataLayer",Jf="gtag",Xf,Zf,eg=!1;function tg(e){if(eg)throw Ff.create("already-initialized");e.dataLayerName&&(Yf=e.dataLayerName),e.gtagName&&(Jf=e.gtagName)}function ng(e,t,n){!function(){const e=[];var t;cd()&&e.push("This is a browser extension environment."),fd()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=Ff.create("invalid-analytics-context",{errorInfo:t}),Df.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw Ff.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Ff.create("no-api-key");Df.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Gf[s])throw Ff.create("already-exists",{id:s});return eg||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(Yf),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=Lf(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Gf,Hf,Qf,Yf,Jf),Zf=r,Xf=i,eg=!0),Gf[s]=zf(e,Hf,Qf,t,Xf,Yf,n),new Wf(e)}async function rg(){if(cd())return!1;if(!fd())return!1;if(!dd())return!1;try{return await pd()}catch(e){return!1}}function ig(e,t,n){e=$d(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(Zf,Gf[e.app.options.appId],t,n).catch(e=>Df.error(e))}function sg(e,t,n){e=$d(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(Zf,Gf[e.app.options.appId],t,n).catch(e=>Df.error(e))}function og(e,t,n){e=$d(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Zf,Gf[e.app.options.appId],t,n).catch(e=>Df.error(e))}function ag(e,t){e=$d(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(Gf[e.app.options.appId],t).catch(e=>Df.error(e))}function cg(e,t,n,r){e=$d(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(Zf,Gf[e.app.options.appId],t,n,r).catch(e=>Df.error(e))}const lg="@firebase/analytics";hp(new zd(Nf,(e,{options:t})=>{return ng(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),hp(new zd("analytics-internal",function(e){try{const r=e.getProvider(Nf).getImmediate();return{logEvent:(e,t,n)=>cg(r,e,t,n)}}catch(e){throw Ff.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),_p(lg,"0.7.5"),_p(lg,"0.7.5","esm2017");var ug,hg;class dg{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){cg(this._delegate,e,t,n)}setCurrentScreen(e,t){ig(this._delegate,e,t)}setUserId(e,t){sg(this._delegate,e,t)}setUserProperties(e,t){og(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){ag(this._delegate,e)}}(W=ug=ug||{}).ADD_SHIPPING_INFO="add_shipping_info",W.ADD_PAYMENT_INFO="add_payment_info",W.ADD_TO_CART="add_to_cart",W.ADD_TO_WISHLIST="add_to_wishlist",W.BEGIN_CHECKOUT="begin_checkout",W.CHECKOUT_PROGRESS="checkout_progress",W.EXCEPTION="exception",W.GENERATE_LEAD="generate_lead",W.LOGIN="login",W.PAGE_VIEW="page_view",W.PURCHASE="purchase",W.REFUND="refund",W.REMOVE_FROM_CART="remove_from_cart",W.SCREEN_VIEW="screen_view",W.SEARCH="search",W.SELECT_CONTENT="select_content",W.SELECT_ITEM="select_item",W.SELECT_PROMOTION="select_promotion",W.SET_CHECKOUT_OPTION="set_checkout_option",W.SHARE="share",W.SIGN_UP="sign_up",W.TIMING_COMPLETE="timing_complete",W.VIEW_CART="view_cart",W.VIEW_ITEM="view_item",W.VIEW_ITEM_LIST="view_item_list",W.VIEW_PROMOTION="view_promotion",W.VIEW_SEARCH_RESULTS="view_search_results";const pg=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new dg(t,n)};hg={Analytics:dg,settings:tg,isSupported:rg,EventName:ug},Cp.INTERNAL.registerComponent(new zd("analytics-compat",pg,"PUBLIC").setServiceProps(hg).setMultipleInstances(!0)),Cp.registerVersion("@firebase/analytics-compat","0.1.6");const fg=new Map,gg={activated:!1,tokenObservers:[]},mg={initialized:!1,enabled:!1};function vg(e){return fg.get(e)||gg}function yg(e,t){fg.set(e,t)}const _g="https://content-firebaseappcheck.googleapis.com/v1beta",wg="exchangeDebugToken",bg={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Ig{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new rd,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new rd,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const Tg=new md("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Eg(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function kg(e){if(!vg(e).activated)throw Tg.create("use-before-activation",{appName:e.name})}function Sg(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=Cg(n)+"d:"),r&&(s+=Cg(r)+"h:"),s+=Cg(i)+"m:"+Cg(t)+"s",s}function Cg(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function Ag({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());var s={method:"POST",body:JSON.stringify(t),headers:r};let o;try{o=await fetch(e,s)}catch(e){throw Tg.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==o.status)throw Tg.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(e){throw Tg.create("fetch-parse-error",{originalErrorMessage:e.message})}var c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Tg.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${a.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:a.attestationToken,expireTimeMillis:c+s,issuedAtTimeMillis:c}}const Ng="firebase-app-check-database",xg=1,Rg="firebase-app-check-store",Pg="debug-token";let Og=null;function Dg(){return Og||(Og=new Promise((t,n)=>{try{const e=indexedDB.open(Ng,xg);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(Tg.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Rg,{keyPath:"compositeKey"})}}catch(e){n(Tg.create("storage-open",{originalErrorMessage:e.message}))}}),Og)}async function Mg(e,t){const n=await Dg(),r=n.transaction(Rg,"readwrite"),i=r.objectStore(Rg),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(Tg.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function Lg(e){const t=await Dg(),i=t.transaction(Rg,"readonly"),n=i.objectStore(Rg),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(Tg.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function Fg(e){return`${e.options.appId}-${e.name}`}const Ug=new ep("@firebase/app-check");async function qg(t){if(dd()){let e=void 0;try{e=await Lg(Fg(t))}catch(e){Ug.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function jg(e,t){return dd()?Mg(Fg(e),t).catch(e=>{Ug.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function Vg(){let e=void 0;try{e=await Lg(Pg)}catch(e){}if(e)return e;var t,n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return t=n,Mg(Pg,t).catch(e=>Ug.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function Bg(){return mg.enabled}async function Kg(){var e=mg;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function $g(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();const t=mg;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new rd;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Vg())}}const zg={error:"UNKNOWN_ERROR"};async function Wg(e,t=!1){var n=e.app;kg(n);const r=vg(n);let i=r.token,s=void 0;if(i||(a=await r.cachedTokenPromise)&&Jg(a)&&(i=a),!t&&i&&Jg(i))return{token:i.token};let o=!1;if(Bg()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Ag(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${_g}/projects/${n}/apps/${r}:${wg}?key=${i}`,body:{debug_token:t}}}(n,await Kg()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),o=!0);var a=await r.exchangeTokenPromise;return await jg(n,a),yg(n,Object.assign(Object.assign({},r),{token:a})),{token:a.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),o=!0),i=await r.exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?Ug.warn(e.message):Ug.error(e),s=e}let c;return i?(c={token:i.token},yg(n,Object.assign(Object.assign({},r),{token:i})),await jg(n,i)):c=(e=s,{token:function(e){return Zh.encodeString(JSON.stringify(e),!1)}(zg),error:e}),o&&Yg(n,c),c}function Gg(e,t,n,r){var i=e["app"];const s=vg(i);var o={next:n,error:r,type:t};if(yg(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&Jg(s.token)){const a=s.token;Promise.resolve().then(()=>{n({token:a.token}),Qg(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Qg(e))}function Hg(e,t){const n=vg(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),yg(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function Qg(e){var t=e["app"],n=vg(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new Ig(async()=>{var e=vg(r);let t;if(t=e.token?await Wg(n,!0):await Wg(n),t.error)throw t.error},()=>!0,()=>{var e=vg(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},bg.RETRIAL_MIN_WAIT,bg.RETRIAL_MAX_WAIT)}(e),yg(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function Yg(e,t){for(const n of vg(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Jg(e){return 0<e.expireTimeMillis-Date.now()}class Xg{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){var e=vg(this.app)["tokenObservers"];for(const t of e)Hg(this.app,t.next);return Promise.resolve()}}const Zg="https://www.google.com/recaptcha/api.js",em="https://www.google.com/recaptcha/enterprise.js";function tm(t,n){var e=vg(t);const r=new rd;yg(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=im(t);e=Eg(!1);return e?rm(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=Zg,t.onload=e,document.head.appendChild(t)}(()=>{var e=Eg(!1);if(!e)throw new Error("no recaptcha");rm(t,n,e,i,r)}),r.promise}function nm(t,n){var e=vg(t);const r=new rd;yg(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=im(t);e=Eg(!0);return e?rm(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=em,t.onload=e,document.head.appendChild(t)}(()=>{var e=Eg(!0);if(!e)throw new Error("no recaptcha");rm(t,n,e,i,r)}),r.promise}function rm(r,i,s,o,a){s.ready(()=>{var e,t,n;e=r,t=s.render(o,{sitekey:i,size:"invisible"}),n=vg(e),yg(e,Object.assign(Object.assign({},n),{reCAPTCHAState:Object.assign(Object.assign({},n.reCAPTCHAState),{widgetId:t})})),a.resolve(s)})}function im(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function sm(r){kg(r);const i=await vg(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=vg(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class om{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){um(this._throttleData);var t=await sm(this._app).catch(e=>{throw Tg.create("recaptcha-error")});let e;try{e=await Ag(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${_g}/projects/${n}/apps/${r}:exchangeRecaptchaToken?key=${i}`,body:{recaptcha_token:t}}}(this._app,t),this._platformLoggerProvider)}catch(e){throw"fetch-status-error"===e.code?(this._throttleData=lm(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),Tg.create("throttled",{time:Sg(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._platformLoggerProvider=dp(e,"platform-logger"),tm(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof om&&this._siteKey===e._siteKey}}class am{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){um(this._throttleData);var t=await sm(this._app).catch(e=>{throw Tg.create("recaptcha-error")});let e;try{e=await Ag(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${_g}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._platformLoggerProvider)}catch(e){throw"fetch-status-error"===e.code?(this._throttleData=lm(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),Tg.create("throttled",{time:Sg(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._platformLoggerProvider=dp(e,"platform-logger"),nm(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof am&&this._siteKey===e._siteKey}}class cm{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=wd(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof cm&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function lm(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=Kd(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function um(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Tg.create("throttled",{time:Sg(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function hm(e=vp(),t){const n=dp(e=$d(e),"app-check");if(mg.initialized||$g(),Bg()&&Kg().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Tg.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=vg(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=qg(t).then(e=>(e&&Jg(e)&&(yg(t,Object.assign(Object.assign({},vg(t)),{token:e})),Yg(t,{token:e.token})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,yg(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),vg(e).isTokenAutoRefreshEnabled&&Gg(r,"INTERNAL",()=>{}),r}const dm="app-check-internal";hp(new zd("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("platform-logger");return t=n,e=r,new Xg(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(dm).initialize()})),hp(new zd(dm,e=>{var t,n=e.getProvider("app-check").getImmediate();return t=n,{getToken:e=>Wg(t,e),addTokenListener:e=>Gg(t,"INTERNAL",e),removeTokenListener:e=>Hg(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),_p("@firebase/app-check","0.5.3");const pm=new md("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class fm{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new om(e):e instanceof am||e instanceof om||e instanceof cm?e:new cm({getToken:e.getToken}),this._delegate=hm(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw pm.create("use-before-activation",{appName:this.app.name});!function(e,t){var n=e.app;const r=vg(n);r.tokenRefresher&&(!0===t?r.tokenRefresher.start():r.tokenRefresher.stop()),yg(n,Object.assign(Object.assign({},r),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw pm.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await Wg(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw pm.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Gg(e,"EXTERNAL",r,i),()=>Hg(e.app,r)}(this._delegate,e,t)}}const gm=e=>{var t=e.getProvider("app-compat").getImmediate();return new fm(t)};function mm(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}Cp.INTERNAL.registerComponent(new zd("appCheck-compat",gm,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:am,ReCaptchaV3Provider:om,CustomProvider:cm})),Cp.registerVersion("@firebase/app-check-compat","0.2.3");const vm={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ym={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function _m(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function wm(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const bm=_m,Im=new md("auth","Firebase",_m()),Tm=new ep("@firebase/auth");function Em(e,...t){Tm.logLevel<=$h.ERROR&&Tm.error(`Auth (${gp}): ${e}`,...t)}function km(e,...t){throw Nm(e,...t)}function Sm(e,...t){return Nm(e,...t)}function Cm(e,t,n){var r=Object.assign(Object.assign({},bm()),{[t]:n});const i=new md("auth","Firebase",r);return i.create(t,{appName:e.name})}function Am(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&km(e,"argument-error"),Cm(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function Nm(e,...t){if("string"==typeof e)return Im.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function xm(e,t,...n){if(!e)throw Nm(t,...n)}function Rm(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Em(t),new Error(t)}function Pm(e,t){e||Rm(t)}const Om=new Map;function Dm(e){Pm(e instanceof Function,"Expected a class definition");let t=Om.get(e);return t?Pm(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Om.set(e,t)),t}function Mm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Lm(){return"http:"===Fm()||"https:"===Fm()}function Fm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Um{constructor(e,t){Pm((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=od()||ld()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Lm()||cd()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function qm(e,t){Pm(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class jm{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void Rm("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void Rm("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void Rm("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const Vm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Bm=new Um(3e4,6e4);function Km(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function $m(i,s,o,a,e={}){return zm(i,e,async()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=Cd(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),jm.fetch()(Gm(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function zm(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},Vm),e);try{const o=new Hm(t),a=await Promise.race([n(),o.promise]);o.clearNetworkTimeout();var i=await a.json();if("needConfirmation"in i)throw Qm(t,"account-exists-with-different-credential",i);if(a.ok&&!("errorMessage"in i))return i;{const c=a.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw Qm(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw Qm(t,"email-already-in-use",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Cm(t,s,u);km(t,s)}}catch(e){if(e instanceof gd)throw e;km(t,"network-request-failed")}}async function Wm(e,t,n,r,i={}){var s=await $m(e,t,n,r,i);return"mfaPendingCredential"in s&&km(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Gm(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?qm(e.config,i):`${e.config.apiScheme}://${i}`}class Hm{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Sm(this.auth,"network-request-failed")),Bm.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Qm(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Sm(e,t,r);return i.customData._tokenResponse=n,i}function Ym(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Jm(e){return 1e3*Number(e)}function Xm(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Em("JWT malformed, contained fewer than 3 sections"),null;try{var i=td(n);return i?JSON.parse(i):(Em("Failed to decode base64 JWT payload"),null)}catch(e){return Em("Caught error parsing JWT payload as JSON",e),null}}async function Zm(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof gd&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class ev{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class tv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ym(this.lastLoginAt),this.creationTime=Ym(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nv(e){var t=e.auth,n=await e.getIdToken(),r=await Zm(e,async function(e,t){return $m(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));xm(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,o,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=mm(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,o=t,[...s.filter(t=>!o.some(e=>e.providerId===t.providerId)),...o]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new tv(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class rv{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){xm(e.idToken,"internal-error"),xm(void 0!==e.idToken,"internal-error"),xm(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,xm(n=Xm(t),"internal-error"),xm(void 0!==n.exp,"internal-error"),xm(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return xm(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:o}=(s=t,await{accessToken:(o=await zm(i=e,{},async()=>{var e=Cd({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Gm(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",jm.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token});this.updateTokensAndExpiration(n,r,Number(o))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new rv;return n&&(xm("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(xm("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(xm("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rv,this.toJSON())}_performRefresh(){return Rm("not implemented")}}function iv(e,t){xm("string"==typeof e||void 0===e,"internal-error",{appName:t})}class sv{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=mm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ev(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tv(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Zm(this,this.stsTokenManager.getToken(this.auth,e));return xm(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=$d(e);var r=await n.getIdToken(t),i=Xm(r);xm(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Ym(Jm(i.auth_time)),issuedAtTime:Ym(Jm(i.iat)),expirationTime:Ym(Jm(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=$d(e);await nv(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(xm(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new sv(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){xm(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await nv(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Zm(this,async function(e,t){return $m(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(o=t.displayName)&&void 0!==o?o:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(a=t.phoneNumber)&&void 0!==a?a:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,o=null!==(c=t.tenantId)&&void 0!==c?c:void 0,a=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;xm(u&&f,e,"internal-error");var g=rv.fromJSON(this.name,f);xm("string"==typeof u,e,"internal-error"),iv(n,e.name),iv(r,e.name),xm("boolean"==typeof h,e,"internal-error"),xm("boolean"==typeof d,e,"internal-error"),iv(i,e.name),iv(s,e.name),iv(o,e.name),iv(a,e.name),iv(c,e.name),iv(l,e.name);const m=new sv({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),a&&(m._redirectEventId=a),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new rv;r.updateFromServerResponse(t);var i=new sv({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await nv(i),i}}class ov{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ov.type="NONE";const av=ov;function cv(e,t,n){return`firebase:${e}:${t}:${n}`}class lv{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=cv(this.userKey,r.apiKey,i),this.fullPersistenceKey=cv("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?sv._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new lv(Dm(av),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Dm(av);const s=cv(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=sv._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new lv(i,e,n)}}function uv(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fv(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(hv(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(mv(t))return"Blackberry";if(vv(t))return"Webos";if(dv(t))return"Safari";if((t.includes("chrome/")||pv(t))&&!t.includes("edge/"))return"Chrome";if(gv(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function hv(e=sd()){return/firefox\//i.test(e)}function dv(e=sd()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function pv(e=sd()){return/crios\//i.test(e)}function fv(e=sd()){return/iemobile/i.test(e)}function gv(e=sd()){return/android/i.test(e)}function mv(e=sd()){return/blackberry/i.test(e)}function vv(e=sd()){return/webos/i.test(e)}function yv(e=sd()){return/iphone|ipad|ipod/i.test(e)}function _v(e=sd()){return yv(e)||gv(e)||vv(e)||mv(e)||/windows phone/i.test(e)||fv(e)}function wv(e,t=[]){let n;switch(e){case"Browser":n=uv(sd());break;case"Worker":n=`${uv(sd())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${gp}/${r}`}class bv{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tv(this),this.idTokenSubscription=new Tv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Im,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Dm(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await lv.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t,n,r;let i=await this.assertedPersistence.getCurrentUser();return e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===i||void 0===i?void 0:i._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(i=r.user)),i?i._redirectEventId?(xm(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)):this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nv(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?$d(e):null;return t&&xm(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&xm(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Dm(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new md("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(xm(t=e&&Dm(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await lv.create(this,[Dm(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return xm(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return xm(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function Iv(e){return $d(e)}class Tv{constructor(e){this.auth=e,this.observer=null,this.addObserver=Rd(e=>this.observer=e)}get next(){return xm(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ev(e,t,n){const r=Iv(e);xm(r._canInitEmulator,r,"emulator-config-failed"),xm(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=kv(t);var{host:o,port:a}=function(e){const t=kv(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:Sv(r.substr(s.length+1))}}var[o,s]=r.split(":");return{host:o,port:Sv(s)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function kv(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Sv(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class Cv{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rm("not implemented")}_getIdTokenResponse(e){return Rm("not implemented")}_linkToIdToken(e,t){return Rm("not implemented")}_getReauthenticationResolver(e){return Rm("not implemented")}}async function Av(e,t){return $m(e,"POST","/v1/accounts:resetPassword",Km(e,t))}async function Nv(e,t){return $m(e,"POST","/v1/accounts:update",t)}async function xv(e,t){return $m(e,"POST","/v1/accounts:sendOobCode",Km(e,t))}class Rv extends Cv{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Rv(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Rv(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Wm(e,"POST","/v1/accounts:signInWithPassword",Km(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Wm(e,"POST","/v1/accounts:signInWithEmailLink",Km(e,t))}(e,{email:this._email,oobCode:this._password});default:km(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Nv(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Wm(e,"POST","/v1/accounts:signInWithEmailLink",Km(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:km(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Pv(e,t){return Wm(e,"POST","/v1/accounts:signInWithIdp",Km(e,t))}class Ov extends Cv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ov(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):km("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=mm(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Ov(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return Pv(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Pv(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pv(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Cd(t)}return e}}const Dv={USER_NOT_FOUND:"user-not-found"};class Mv extends Cv{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Mv({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Mv({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Wm(e,"POST","/v1/accounts:signInWithPhoneNumber",Km(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await Wm(e,"POST","/v1/accounts:signInWithPhoneNumber",Km(e,t));if(n.temporaryProof)throw Qm(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Wm(e,"POST","/v1/accounts:signInWithPhoneNumber",Km(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Dv)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new Mv({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Lv{constructor(e){var t=Ad(Nd(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);xm(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=Ad(Nd(e=e)).link,n=t?Ad(Nd(t)).deep_link_id:null,((r=Ad(Nd(e)).deep_link_id)?Ad(Nd(r)).link:null)||r||n||t||e);try{return new Lv(t)}catch(e){return null}}}class Fv{constructor(){this.providerId=Fv.PROVIDER_ID}static credential(e,t){return Rv._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=Lv.parseLink(t);return xm(n,"argument-error"),Rv._fromEmailAndCode(e,n.code,n.tenantId)}}Fv.PROVIDER_ID="password",Fv.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Fv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Uv{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qv extends Uv{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class jv extends qv{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return xm("providerId"in t&&"signInMethod"in t,"argument-error"),Ov._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return xm(e.idToken||e.accessToken,"argument-error"),Ov._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return jv.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return jv.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new jv(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Vv extends qv{constructor(){super("facebook.com")}static credential(e){return Ov._fromParams({providerId:Vv.PROVIDER_ID,signInMethod:Vv.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vv.credentialFromTaggedObject(e)}static credentialFromError(e){return Vv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Vv.credential(e.oauthAccessToken)}catch(e){return null}}}Vv.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vv.PROVIDER_ID="facebook.com";class Bv extends qv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ov._fromParams({providerId:Bv.PROVIDER_ID,signInMethod:Bv.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bv.credentialFromTaggedObject(e)}static credentialFromError(e){return Bv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Bv.credential(t,n)}catch(e){return null}}}Bv.GOOGLE_SIGN_IN_METHOD="google.com",Bv.PROVIDER_ID="google.com";class Kv extends qv{constructor(){super("github.com")}static credential(e){return Ov._fromParams({providerId:Kv.PROVIDER_ID,signInMethod:Kv.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Kv.credentialFromTaggedObject(e)}static credentialFromError(e){return Kv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Kv.credential(e.oauthAccessToken)}catch(e){return null}}}Kv.GITHUB_SIGN_IN_METHOD="github.com",Kv.PROVIDER_ID="github.com";class $v extends Cv{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Pv(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Pv(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pv(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new $v(t,r):null}static _create(e,t){return new $v(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class zv extends Uv{constructor(e){xm(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return zv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return zv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=$v.fromJSON(e);return xm(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return $v._create(n,t)}catch(e){return null}}}class Wv extends qv{constructor(){super("twitter.com")}static credential(e,t){return Ov._fromParams({providerId:Wv.PROVIDER_ID,signInMethod:Wv.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Wv.credentialFromTaggedObject(e)}static credentialFromError(e){return Wv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Wv.credential(t,n)}catch(e){return null}}}async function Gv(e,t){return Wm(e,"POST","/v1/accounts:signUp",Km(e,t))}Wv.TWITTER_SIGN_IN_METHOD="twitter.com",Wv.PROVIDER_ID="twitter.com";class Hv{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await sv._fromIdTokenResponse(e,n,r),s=Qv(n);return new Hv({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Qv(n);return new Hv({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Qv(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Yv extends gd{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Yv.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Yv(e,t,n,r)}}function Jv(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Yv._fromErrorAndOperation(t,e,n,r);throw e})}function Xv(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Zv(e,t){const n=$d(e);await ty(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await $m(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=Xv(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function ey(e,t,n=!1){var r=await Zm(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Hv._forOperation(e,"link",r)}async function ty(e,t,n){await nv(t);const r=Xv(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";xm(r.has(n)===e,t.auth,i)}async function ny(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await Zm(e,Jv(r,i,t,e),n);xm(s.idToken,r,"internal-error");var o=Xm(s.idToken);xm(o,r,"internal-error");var a=o["sub"];return xm(e.uid===a,r,"user-mismatch"),Hv._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&km(r,"user-mismatch"),e}}async function ry(e,t,n=!1){var r=await Jv(e,"signIn",t),r=await Hv._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function iy(e,t){return ry(Iv(e),t)}async function sy(e,t){var n=$d(e);return await ty(!1,n,t.providerId),ey(n,t)}async function oy(e,t){return ny($d(e),t)}async function ay(e,t){const n=Iv(e);var r=await Wm(n,"POST","/v1/accounts:signInWithCustomToken",Km(n,{token:t,returnSecureToken:!0})),r=await Hv._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class cy{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ly._fromServerResponse(e,t):km(e,"internal-error")}}class ly extends cy{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ly(t)}}function uy(e,t,n){var r;xm(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),xm(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(xm(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(xm(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function hy(e,t,n){var r=$d(e),i={requestType:"PASSWORD_RESET",email:t};n&&uy(r,i,n),await xv(r,i)}async function dy(e,t){await $m(e=$d(e),"POST","/v1/accounts:update",Km(e,{oobCode:t}))}async function py(e,t){var n=$d(e),r=await Av(n,{oobCode:t}),i=r.requestType;switch(xm(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":xm(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":xm(r.mfaInfo,n,"internal-error");default:xm(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=cy._fromServerResponse(Iv(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function fy(e,t,n){var r=$d(e),i={requestType:"EMAIL_SIGNIN",email:t};xm(n.handleCodeInApp,r,"argument-error"),n&&uy(r,i,n),await xv(r,i)}async function gy(e,t){var n=Lm()?Mm():"http://localhost",n=(await $m(e=$d(e),"POST","/v1/accounts:createAuthUri",Km(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function my(e,t){var n=$d(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&uy(n.auth,r,t);var r=(await xv(n.auth,r))["email"];r!==e.email&&await e.reload()}async function vy(e,t,n){var r=$d(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&uy(r.auth,i,n);var i=(await xv(r.auth,i))["email"];i!==e.email&&await e.reload()}async function yy(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=$d(e);var r=await i.getIdToken(),r=await Zm(i,async function(e,t){return $m(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function _y(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Zm(e,Nv(r,i));await e._updateTokensIfNecessary(r,!0)}class wy{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class by extends wy{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Iy extends wy{constructor(e,t){super(e,"facebook.com",t)}}class Ty extends by{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Ey extends wy{constructor(e,t){super(e,"google.com",t)}}class ky extends by{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Sy(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Xm(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new wy(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new Iy(r,n);case"github.com":return new Ty(r,n);case"google.com":return new Ey(r,n);case"twitter.com":return new ky(r,n,e.screenName||null);case"custom":case"anonymous":return new wy(r,null);default:return new wy(r,t,n)}}(n)}class Cy{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Cy("enroll",e)}static _fromMfaPendingCredential(e){return new Cy("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Cy._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Cy._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Ay{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=Iv(e),o=i.customData._serverResponse;var t=(o.mfaInfo||[]).map(e=>cy._fromServerResponse(s,e));xm(o.mfaPendingCredential,s,"internal-error");const a=Cy._fromMfaPendingCredential(o.mfaPendingCredential);return new Ay(a,t,async e=>{var t=await e._process(s,a);delete o.mfaInfo,delete o.mfaPendingCredential;var n=Object.assign(Object.assign({},o),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await Hv._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return xm(i.user,s,"internal-error"),Hv._forOperation(i.user,i.operationType,n);default:km(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Ny{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>cy._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Ny(e)}async getSession(){return Cy._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;var r=await this.getSession(),r=await Zm(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r=await this.user.getIdToken(),r=await Zm(this.user,(n=this.user.auth,e={idToken:r,mfaEnrollmentId:t},$m(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Km(n,e))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const xy=new WeakMap;const Ry="__sak";class Py{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ry,"1"),this.storage.removeItem(Ry),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Oy extends Py{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(dv(e=sd())||yv(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=_v(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);ud()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Oy.type="LOCAL";const Dy=Oy;class My extends Py{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}My.type="SESSION";const Ly=My;class Fy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Fy(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Uy(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Fy.receivers=[];class qy{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=Uy("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function jy(){return window}function Vy(){return void 0!==jy().WorkerGlobalScope&&"function"==typeof jy().importScripts}const By="firebaseLocalStorageDb",Ky="firebaseLocalStorage",$y="fbase_key";class zy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Wy(e,t){return e.transaction([Ky],t?"readwrite":"readonly").objectStore(Ky)}function Gy(){const r=indexedDB.open(By,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(Ky,{keyPath:$y})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(Ky)?n(e):(e.close(),t=indexedDB.deleteDatabase(By),await new zy(t).toPromise(),n(await Gy()))})})}async function Hy(e,t,n){var r=Wy(e,!0).put({fbase_key:t,value:n});return new zy(r).toPromise()}function Qy(e,t){var n=Wy(e,!0).delete(t);return new zy(n).toPromise()}class Yy{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Gy(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vy()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fy._getInstance(Vy()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new qy(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Gy();return await Hy(e,Ry,"1"),await Qy(e,Ry),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Hy(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=Wy(e,!1).get(t);return void 0===(n=await new zy(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Qy(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=Wy(e,!1).getAll();return new zy(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Yy.type="LOCAL";const Jy=Yy;function Xy(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=Sm("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function Zy(e){return`__${e}${Math.floor(1e6*Math.random())}`}class e_{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new t_(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class t_{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;xm(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const n_=Zy("rcb"),r_=new Um(3e4,6e4);class i_{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!jy().grecaptcha}load(s,o=""){var e;return xm((e=o).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(jy().grecaptcha):new Promise((t,n)=>{const i=jy().setTimeout(()=>{n(Sm(s,"network-request-failed"))},r_.get());jy()[n_]=()=>{jy().clearTimeout(i),delete jy()[n_];const e=jy().grecaptcha;if(e){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=o,t(e)}else n(Sm(s,"internal-error"))},Xy(`https://www.google.com/recaptcha/api.js??${Cd({onload:n_,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),n(Sm(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!jy().grecaptcha&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class s_{async load(e){return new e_(e)}clearedOneInstance(){}}const o_="recaptcha",a_={theme:"light",type:"image"};class c_{constructor(e,t=Object.assign({},a_),n){this.parameters=t,this.type=o_,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Iv(n),this.isInvisible="invisible"===this.parameters.size,xm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;xm(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?s_:i_),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){xm(!this.parameters.sitekey,this.auth,"argument-error"),xm(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),xm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=jy()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){xm(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){xm(Lm()&&!Vy(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await $m(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");xm(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return xm(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class l_{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=Mv._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function u_(t,n,r){var i,s,o,a,c,l,u=await r.verify();try{xm("string"==typeof u,t,"argument-error"),xm(r.type===o_,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return xm("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await $m(c,"POST","/v2/accounts/mfaEnrollment:start",Km(c,l))).phoneSessionInfo.sessionInfo;xm("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return xm(d,t,"missing-multi-factor-info"),(a={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await $m(t,"POST","/v2/accounts/mfaSignIn:start",Km(t,a))).phoneResponseInfo.sessionInfo}var p=(s=t,o={phoneNumber:e.phoneNumber,recaptchaToken:u},await $m(s,"POST","/v1/accounts:sendVerificationCode",Km(s,o)))["sessionInfo"];return p}finally{r._reset()}}class h_{constructor(e){this.providerId=h_.PROVIDER_ID,this.auth=Iv(e)}verifyPhoneNumber(e,t){return u_(this.auth,e,$d(t))}static credential(e,t){return Mv._fromVerification(e,t)}static credentialFromResult(e){var t=e;return h_.credentialFromTaggedObject(t)}static credentialFromError(e){return h_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?Mv._fromTokenResponse(t,n):null}}function d_(e,t){return t?Dm(t):(xm(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}h_.PROVIDER_ID="phone",h_.PHONE_SIGN_IN_METHOD="phone";class p_ extends Cv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pv(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pv(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pv(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function f_(e){return ry(e.auth,new p_(e),e.bypassAuthState)}function g_(e){var{auth:t,user:n}=e;return xm(n,t,"internal-error"),ny(n,new p_(e),e.bypassAuthState)}async function m_(e){var{auth:t,user:n}=e;return xm(n,t,"internal-error"),ey(n,new p_(e),e.bypassAuthState)}class v_{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return f_;case"linkViaPopup":case"linkViaRedirect":return m_;case"reauthViaPopup":case"reauthViaRedirect":return g_;default:km(this.auth,"internal-error")}}resolve(e){Pm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Pm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const y_=new Um(2e3,1e4);class __ extends v_{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,__.currentPopupAction&&__.currentPopupAction.cancel(),__.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return xm(e,this.auth,"internal-error"),e}async onExecution(){Pm(1===this.filter.length,"Popup operations only handle one event");var e=Uy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Sm(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Sm(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,__.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Sm(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,y_.get())};t()}}__.currentPopupAction=null;const w_="pendingRedirect",b_=new Map;class I_ extends v_{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=b_.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=k_(t),r=E_(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}b_.set(this.auth._key(),t)}return this.bypassAuthState||b_.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function T_(e,t){return E_(e)._set(k_(t),"true")}function E_(e){return Dm(e._redirectPersistence)}function k_(e){return cv(w_,e.config.apiKey,e.name)}function S_(e,t,n){return async function(e,t,n){var r=Iv(e);Am(e,t,Uv);const i=d_(r,n);return await T_(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function C_(e,t,n){return async function(e,t,n){var r=$d(e);Am(r.auth,t,Uv);const i=d_(r.auth,n);await T_(i,r.auth);var s=await x_(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function A_(e,t,n){return async function(e,t,n){var r=$d(e);Am(r.auth,t,Uv);const i=d_(r.auth,n);await ty(!1,r,t.providerId),await T_(i,r.auth);var s=await x_(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function N_(e,t,n=!1){const r=Iv(e);var i=d_(r,t);const s=new I_(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function x_(e){var t=Uy(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class R_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return O_(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!O_(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(Sm(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(P_(e))}saveEventToCache(e){this.cachedEventUids.add(P_(e)),this.lastProcessedEventTime=Date.now()}}function P_(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function O_({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function D_(e,t={}){return $m(e,"GET","/v1/projects",t)}const M_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,L_=/^https?/;async function F_(e){if(!e.config.emulator){var t=(await D_(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=Mm(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!L_.test(n))return!1;if(M_.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}(n))return}catch(e){}km(e,"unauthorized-domain")}}const U_=new Um(3e4,6e4);function q_(){const t=jy().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let j_=null;function V_(e){var i;return j_=j_||(i=e,new Promise((e,t)=>{function n(){q_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{q_(),t(Sm(i,"network-request-failed"))},timeout:U_.get()})}if(null!==(r=null===(r=jy().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=jy().gapi)||void 0===r||!r.load){var r=Zy("iframefcb");return jy()[r]=()=>{gapi.load?n():t(Sm(i,"network-request-failed"))},Xy(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw j_=null,e})),j_}const B_=new Um(5e3,15e3),K_="__/auth/iframe",$_="emulator/auth/iframe",z_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},W_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function G_(o){const e=await V_(o);var t=jy().gapi;return xm(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;xm(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?qm(t,$_):`https://${e.config.authDomain}/${K_}`;const r={apiKey:t.apiKey,appName:e.name,v:gp};(t=W_.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Cd(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:z_,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=Sm(o,"network-request-failed"),r=jy().setTimeout(()=>{t(n)},B_.get());function i(){jy().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const H_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Q_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Y_(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},H_),{width:r.toString(),height:i.toString(),top:s,left:o});s=sd().toLowerCase();n&&(a=pv(s)?"_blank":n),hv(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,o=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=sd()]=[s],yv(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Q_(null);const u=window.open(t||"",a,o);xm(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Q_(u)}const J_="__/auth/handler",X_="emulator/auth/handler";function Z_(e,t,n,r,i,s){xm(e.config.authDomain,e,"auth-domain-config-required"),xm(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:gp,eventId:i};if(t instanceof Uv){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Td(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof qv){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=[e["config"]][0],e.emulator?qm(e,X_):`https://${e.authDomain}/${J_}`}?${Cd(l).slice(1)}`}const ew="webStorageSupport";const tw=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ly,this._completeRedirectFn=N_}async _openPopup(e,t,n,r){var i;return Pm(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Y_(e,Z_(e,t,n,Mm(),r),Uy())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=Z_(e,t,n,Mm(),r),jy().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(Pm(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await G_(t),n=new R_(t);return e.register("authEvent",e=>{return xm(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(ew,{type:ew},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[ew];void 0!==t&&r(!!t),km(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=F_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _v()||dv()||yv()}};class nw extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rm("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new nw(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},$m(e,"POST","/v2/accounts/mfaEnrollment:finalize",Km(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},$m(e,"POST","/v2/accounts/mfaSignIn:finalize",Km(e,t))}}class rw{constructor(){}static assertion(e){return nw._fromCredential(e)}}rw.FACTOR_ID="phone";var iw,sw="@firebase/auth";class ow{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){xm(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function aw(){return window}iw="Browser",hp(new zd("auth",(e,{options:n})=>{var t=e.getProvider("app").getImmediate();const{apiKey:r,authDomain:i}=t.options;return(e=>{xm(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),xm(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:e.name});var t={apiKey:r,authDomain:i,clientPlatform:iw,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wv(iw)},t=new bv(e,t);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Dm);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(t,n),t})(t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),hp(new zd("auth-internal",e=>{var t=Iv(e.getProvider("auth").getImmediate());return e=t,new ow(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),_p(sw,"0.19.9",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(iw)),_p(sw,"0.19.9","esm2017");async function cw(e,t,n){var r=aw()["BuildInfo"];Pm(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(Pm(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return yv()?s.ibi=r.packageName:gv()?s.apn=r.packageName:km(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Z_(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function lw(r){const i=aw()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=sd(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const uw=20;class hw extends R_{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function dw(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<uw;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:Sm(e,"no-auth-event")}}async function pw(e){var t=await gw()._get(mw(e));return t&&await gw()._remove(mw(e)),t}function fw(e,t){var n,r,i;const s=(n=vw(t=t),o=n.link?decodeURIComponent(n.link):void 0,r=vw(o).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=vw(i).link)||i||r||o||t);if(s.includes("/__/auth/callback")){var o=vw(s),o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null,o=null===(o=null===(o=null==o?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1],o=o?Sm(o):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function gw(){return Dm(Dy)}function mw(e){return cv("authEvent",e.config.apiKey,e.name)}function vw(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return Ad(t.join("?"))}const yw=class{constructor(){this._redirectPersistence=Ly,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=N_}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new hw(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){km(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,a=aw(),xm("function"==typeof(null===(s=null==a?void 0:a.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),xm(void 0!==(null===(s=null==a?void 0:a.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),xm("function"==typeof(null===(s=null===(s=null===(s=null==a?void 0:a.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),xm("function"==typeof(null===(s=null===(s=null===(s=null==a?void 0:a.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),xm("function"==typeof(null===(a=null===(a=null==a?void 0:a.cordova)||void 0===a?void 0:a.InAppBrowser)||void 0===a?void 0:a.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),b_.clear(),await this._originValidation(e);var a=dw(e,n,r);n=e,r=a,await gw()._set(mw(n),r);a=await lw(await cw(e,a,t));return async function(o,a,c){const l=aw()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(Sm(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),gv()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,a)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=aw()["BuildInfo"];const n={};yv()?n.iosBundleId=t.packageName:gv()?n.androidPackageName=t.packageName:km(e,"operation-not-supported-in-this-environment"),await D_(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=aw(),s=setTimeout(async()=>{await pw(r),i.onEvent(_w())},500),o=async e=>{clearTimeout(s);var t=await pw(r);let n=null;t&&null!=e&&e.url&&(n=fw(t,e.url)),i.onEvent(n||_w())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;aw().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function _w(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Sm("no-auth-event")}}var ww;function bw(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Iw(e=sd()){return!("file:"!==bw()&&"ionic:"!==bw()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Tw(e=sd()){return ud()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=sd()]=[e],/Edge\/\d+/.test(e))}function Ew(){try{const t=self.localStorage;var e=Uy();if(t)return t.setItem(e,"1"),t.removeItem(e),!Tw()||dd()}catch(e){return kw()&&dd()}return!1}function kw(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Sw(){return("http:"===bw()||"https:"===bw()||cd()||Iw())&&!(ld()||ad())&&Ew()&&!kw()}function Cw(){return Iw()&&"undefined"!=typeof document}const Aw={LOCAL:"local",NONE:"none",SESSION:"session"},Nw=xm,xw="persistence";async function Rw(e){await e._initializationPromise;const t=Pw();var n=cv(xw,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Pw(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Ow=xm;class Dw{constructor(){this.browserResolver=Dm(tw),this.cordovaResolver=Dm(yw),this.underlyingResolver=null,this._redirectPersistence=Ly,this._completeRedirectFn=N_}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Cw()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ow(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Cw()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Mw(e){return e.unwrap()}function Lw(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===t.code){const a=t;a.resolver=new jw(e,(n=t,i=$d(e),xm((o=n).customData.operationType,i,"argument-error"),xm(null===(r=o.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),Ay._fromError(i,o)))}else if(s){var o=Fw(t);const c=t;o&&(c.credential=o,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function Fw(e){var t=(e instanceof gd?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof gd)&&"temporaryProof"in t&&"phoneNumber"in t)return h_.credentialFromResult(e);const n=t.providerId;if(!n||n===vm.PASSWORD)return null;let r;switch(n){case vm.GOOGLE:r=Bv;break;case vm.FACEBOOK:r=Vv;break;case vm.GITHUB:r=Kv;break;case vm.TWITTER:r=Wv;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?$v._create(n,a):Ov._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new jv(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof gd?r.credentialFromError(e):r.credentialFromResult(e)}function Uw(t,e){return e.catch(e=>{throw e instanceof gd&&Lw(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Fw(e),additionalUserInfo:Sy(e),user:Vw.getOrCreate(n)}})}async function qw(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Uw(t,n.confirm(e))}}class jw{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Uw(Mw(this.auth),this.resolver.resolveSignIn(e))}}class Vw{constructor(e){var t;this._delegate=e,this.multiFactor=(t=$d(e),xy.has(t)||xy.set(t,Ny._fromUser(t)),xy.get(t))}static getOrCreate(e){return Vw.USER_MAP.has(e)||Vw.USER_MAP.set(e,new Vw(e)),Vw.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Uw(this.auth,sy(this._delegate,e))}async linkWithPhoneNumber(e,t){return qw(this.auth,async function(e,t,n){const r=$d(e);await ty(!1,r,"phone");var i=await u_(r.auth,t,$d(n));return new l_(i,e=>sy(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Uw(this.auth,async function(e,t,n){var r=$d(e);Am(r.auth,t,Uv);var i=d_(r.auth,n);const s=new __(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Dw))}async linkWithRedirect(e){return await Rw(Iv(this.auth)),A_(this._delegate,e,Dw)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Uw(this.auth,oy(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return qw(this.auth,async function(e,t,n){const r=$d(e);var i=await u_(r.auth,t,$d(n));return new l_(i,e=>oy(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Uw(this.auth,async function(e,t,n){var r=$d(e);Am(r.auth,t,Uv);var i=d_(r.auth,n);const s=new __(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Dw))}async reauthenticateWithRedirect(e){return await Rw(Iv(this.auth)),C_(this._delegate,e,Dw)}sendEmailVerification(e){return my(this._delegate,e)}async unlink(e){return await Zv(this._delegate,e),this}updateEmail(e){return _y($d(this._delegate),e,null)}updatePassword(e){return _y($d(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await ey($d(e),t)}(this._delegate,e)}updateProfile(e){return yy(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return vy(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Vw.USER_MAP=new WeakMap;const Bw=xm;class Kw{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];Bw(n,"invalid-api-key",{appName:e.name}),Bw(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?Dw:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=Pw();if(!n)return[];var r=cv(xw,e,t);switch(n.getItem(r)){case Aw.NONE:return[av];case Aw.LOCAL:return[Jy,Ly];case Aw.SESSION:return[Ly];default:return[]}}(e,t);"undefined"==typeof self||n.includes(Jy)||n.push(Jy);if("undefined"!=typeof window)for(const r of[Dy,Ly])n.includes(r)||n.push(r);n.includes(av)||n.push(av);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(wm),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Vw.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Ev(this._delegate,e,t)}applyActionCode(e){return dy(this._delegate,e)}checkActionCode(e){return py(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Av($d(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Uw(this._delegate,async function(e,t,n){const r=Iv(e);var i=await Gv(r,{returnSecureToken:!0,email:t,password:n}),i=await Hv._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(i.user),i}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return gy(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=Lv.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){Bw(Sw(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=Dw,await Iv(e)._initializationPromise,await N_(e,t,!1));return n?Uw(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){Iv(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=$w(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=$w(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return fy(this._delegate,e,t)}sendPasswordResetEmail(e,t){return hy(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Nw(Object.values(Aw).includes(n),t,"invalid-persistence-type"),ld()?Nw(n!==Aw.SESSION,t,"unsupported-persistence-type"):ad()?Nw(n===Aw.NONE,t,"unsupported-persistence-type"):kw()?Nw(n===Aw.NONE||n===Aw.LOCAL&&dd(),t,"unsupported-persistence-type"):Nw(n===Aw.NONE||Ew(),t,"unsupported-persistence-type");let r;switch(e){case Aw.SESSION:r=Ly;break;case Aw.LOCAL:var i=await Dm(Jy)._isAvailable();r=i?Jy:Dy;break;case Aw.NONE:r=av;break;default:return km("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Uw(this._delegate,async function(e){const t=Iv(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new Hv({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await Gv(t,{returnSecureToken:!0}),n=await Hv._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return Uw(this._delegate,iy(this._delegate,e))}signInWithCustomToken(e){return Uw(this._delegate,ay(this._delegate,e))}signInWithEmailAndPassword(e,t){return Uw(this._delegate,(n=this._delegate,e=e,t=t,iy($d(n),Fv.credential(e,t))));var n}signInWithEmailLink(e,t){return Uw(this._delegate,async function(e,t,n){var r=$d(e),i=Fv.credentialWithLink(t,n||Mm());return xm(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),iy(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return qw(this._delegate,async function(e,t,n){const r=Iv(e);var i=await u_(r,t,$d(n));return new l_(i,e=>iy(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return Bw(Sw(),this._delegate,"operation-not-supported-in-this-environment"),Uw(this._delegate,async function(e,t,n){var r=Iv(e);Am(e,t,Uv);var i=d_(r,n);const s=new __(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,Dw))}async signInWithRedirect(e){return Bw(Sw(),this._delegate,"operation-not-supported-in-this-environment"),await Rw(this._delegate),S_(this._delegate,e,Dw)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await py($d(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function $w(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Vw.getOrCreate(e)),error:t,complete:n}}Kw.Persistence=Aw;class zw{constructor(){this.providerId="phone",this._delegate=new h_(Mw(Cp.auth()))}static credential(e,t){return h_.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}zw.PHONE_SIGN_IN_METHOD=h_.PHONE_SIGN_IN_METHOD,zw.PROVIDER_ID=h_.PROVIDER_ID;const Ww=xm;class Gw{constructor(e,t,n=Cp.app()){var r;Ww(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new c_(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(ww=Cp).INTERNAL.registerComponent(new zd("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Kw(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:ym.EMAIL_SIGNIN,PASSWORD_RESET:ym.PASSWORD_RESET,RECOVER_EMAIL:ym.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:ym.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:ym.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:ym.VERIFY_EMAIL}},EmailAuthProvider:Fv,FacebookAuthProvider:Vv,GithubAuthProvider:Kv,GoogleAuthProvider:Bv,OAuthProvider:jv,SAMLAuthProvider:zv,PhoneAuthProvider:zw,PhoneMultiFactorGenerator:rw,RecaptchaVerifier:Gw,TwitterAuthProvider:Wv,Auth:Kw,AuthCredential:Cv,Error:gd}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ww.registerVersion("@firebase/auth-compat","0.2.9");const Hw="@firebase/database";let Qw="";function Yw(e){Qw=e}class Jw{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),_d(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:yd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Xw{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return bd(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var Zw,eb,tb,nb,rb,ib,yt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Jw(t)}}catch(e){}return new Xw};function sb(e){var t=function(t){const n=[];let r=0;for(let o=0;o<t.length;o++){let e=t.charCodeAt(o);var i,s;55296<=e&&e<=56319&&(i=e-55296,o++,Jh(o<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(o)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new xd;return n.update(t),t=n.digest(),Zh.encodeByteArray(t)}const ob=yt("localStorage"),ab=yt("sessionStorage"),cb=new ep("@firebase/database"),lb=function(){let e=1;return function(){return e++}}(),ub=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=ub.apply(null,n):t+="object"==typeof n?_d(n):n,t+=" "}return t};let hb=null,db=!0;function pb(t){return function(...e){wb(t,...e)}}function fb(...e){var t="FIREBASE INTERNAL ERROR: "+ub(...e);cb.error(t)}function gb(e,t){return e===t?0:e<t?-1:1}function mb(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+_d(t))}function vb(e){if("object"!=typeof e||null===e)return _d(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=_d(t[i]),n+=":",n+=vb(e[t[i]]);return n+="}",n}function yb(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const _b=function(e,t){Jh(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(cb.logLevel=$h.VERBOSE,hb=cb.log.bind(cb),t&&ab.set("logging_enabled",!0)):"function"==typeof e?hb=e:(hb=null,ab.remove("logging_enabled"))},wb=function(...e){var t;!0===db&&(db=!1,null===hb&&!0===ab.get("logging_enabled")&&_b(!0)),hb&&(t=ub.apply(null,e),hb(t))},bb=function(...e){var t=`FIREBASE FATAL ERROR: ${ub(...e)}`;throw cb.error(t),new Error(t)},Ib=function(...e){var t="FIREBASE WARNING: "+ub(...e);cb.warn(t)},Tb=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ib("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Eb=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},kb="[MIN_NAME]",Sb="[MAX_NAME]",Cb=function(e,t){if(e===t)return 0;if(e===kb||t===Sb)return-1;if(t===kb||e===Sb)return 1;var n=Db(e),r=Db(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function Ab(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Nb(e){Jh(!Eb(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function xb(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n}const Rb=new RegExp("^-?(0*)\\d{1,10}$"),Pb=-2147483648,Ob=2147483647,Db=function(e){if(Rb.test(e)){var t=Number(e);if(t>=Pb&&t<=Ob)return t}return null},Mb=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw Ib("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Lb{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Ib(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Fb{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(wb("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ib(e)}}class Ub{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ub.OWNER="owner";const qb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,jb="websocket",Vb="long_polling";class Bb{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ob.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ob.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Kb(e,t,n){Jh("string"==typeof t,"typeof type must == string"),Jh("object"==typeof n,"typeof params must == object");let r;if(t===jb)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Vb)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Ab(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class $b{constructor(){this.counters_={}}incrementCounter(e,t=1){bd(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return nd(void 0,this.counters_)}}const zb={},Wb={};function Gb(e){var t=e.toString();return zb[t]||(zb[t]=new $b),zb[t]}class Hb{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Mb(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Qb{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=pb(e),this.stats_=Gb(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Kb(t,Vb,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Hb(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Yb((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&qb.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Qb.forceAllow_=!0}static forceDisallow(){Qb.forceDisallow_=!0}static isAvailable(){return!!Qb.forceAllow_||!(Qb.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=_d(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=Qh(t),n=yb(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=_d(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Yb{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=lb(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Yb.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){wb("frame writing exception"),e.stack&&wb(e.stack),wb(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||wb("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{wb("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Jb=null;"undefined"!=typeof MozWebSocket?Jb=MozWebSocket:"undefined"!=typeof WebSocket&&(Jb=WebSocket);class Xb{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=pb(this.connId),this.stats_=Gb(t),this.connURL=Xb.connectionURL_(t,s,o,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&qb.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Kb(e,jb,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ob.set("previous_websocket_failure",!0);try{hd()||(n={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new Jb(this.connURL,[],n))}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Xb.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Jb&&!Xb.forceDisallow_}static previouslyFailed(){return ob.isInMemoryStorage||!0===ob.get("previous_websocket_failure")}markConnectionHealthy(){ob.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=yd(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Jh(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=_d(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=yb(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xb.responsesRequiredToBeHealthy=2,Xb.healthyTimeout=3e4;class Zb{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Qb,Xb]}initTransports_(e){var t=Xb&&Xb.isAvailable();let n=t&&!Xb.previouslyFailed();if(e.webSocketOnly&&(t||Ib("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Xb];else{const r=this.transports_=[];for(const i of Zb.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i)}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}class eI{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=pb("c:"+this.id+":"),this.transportManager_=new Zb(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=xb(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=mb("t",e),n=mb("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=mb("t",e),n=mb("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=mb("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?fb("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fb("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Ib("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),xb(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xb(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ob.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class tI{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nI{constructor(e){this.allowedEvents_=e,this.listeners_={},Jh(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){Jh(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class rI extends nI{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||od()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new rI}getInitialEvent(e){return Jh("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class iI{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function sI(){return new iI("")}function oI(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function aI(e){return e.pieces_.length-e.pieceNum_}function cI(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new iI(e.pieces_,t)}function lI(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function uI(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function hI(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new iI(t,0)}function dI(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof iI)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new iI(n,0)}function pI(e){return e.pieceNum_>=e.pieces_.length}function fI(e,t){var n=oI(e),r=oI(t);if(null===n)return t;if(n===r)return fI(cI(e),cI(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function gI(e,t){var n=uI(e,0),r=uI(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=Cb(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function mI(e,t){if(aI(e)!==aI(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function vI(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(aI(e)>aI(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class yI{constructor(e,t){this.errorPrefix_=t,this.parts_=uI(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Ud(this.parts_[n]);_I(this)}}function _I(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+wI(e))}function wI(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class bI extends nI{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new bI}getInitialEvent(e){return Jh("visible"===e,"Unknown event type: "+e),[this.visible_]}}class II extends tI{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=II.nextPersistentConnectionId_++,this.log_=pb("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!hd())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bI.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&rI.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(_d(i)),Jh(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new rd,r={p:e._path.toString(),q:e._queryObject},t={action:"g",request:r,onComplete:e=>{var t=e.d;"ok"===e.s?(this.onDataUpdate_(r.p,t,!1,null),n.resolve(t)):n.reject(t)}};this.outstandingGets_.push(t),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{var e=this.outstandingGets_[i];void 0!==e&&t===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),Jh(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Jh(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;II.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&bd(e,"w")){const i=Id(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),Ib("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=wd(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=wd(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Jh(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+_d(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fb("Unrecognized action received from server: "+_d(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Jh(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+II.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,u())};this.realtime_={close:o,sendRequest:function(e){Jh(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?wb("getToken() completed but was canceled"):(wb("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new eI(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{Ib(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&Ib(e),o())}}}interrupt(e){wb("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){wb("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Td(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>vb(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new iI(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){wb("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){wb("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+Qw.replace(/\./g,"-")]=1,od()?e["framework.cordova"]=1:ld()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=rI.getInstance().currentlyOnline();return Td(this.interruptReasons_)&&e}}II.nextPersistentConnectionId_=0,II.nextConnectionId_=0;class TI{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new TI(e,t)}}class EI{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new TI(kb,e),r=new TI(kb,t);return 0!==this.compare(n,r)}minPost(){return TI.MIN}}let kI;class SI extends EI{static get __EMPTY_NODE(){return kI}static set __EMPTY_NODE(e){kI=e}compare(e,t){return Cb(e.name,t.name)}isDefinedOn(e){throw Xh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return TI.MIN}maxPost(){return new TI(Sb,kI)}makePost(e,t){return Jh("string"==typeof e,"KeyIndex indexValue must always be a string."),new TI(e,kI)}toString(){return".key"}}const CI=new SI;class AI{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class NI{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:NI.RED,this.left=null!=r?r:xI.EMPTY_NODE,this.right=null!=i?i:xI.EMPTY_NODE}copy(e,t,n,r,i){return new NI(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return xI.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return xI.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,NI.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,NI.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}NI.RED=!0,NI.BLACK=!1;class xI{constructor(e,t=xI.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new xI(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,NI.BLACK,null,null))}remove(e){return new xI(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,NI.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new AI(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new AI(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new AI(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new AI(this.root_,null,this.comparator_,!0,e)}}function RI(e,t){return Cb(e.name,t.name)}function PI(e,t){return Cb(e,t)}xI.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new NI(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let OI;function DI(e){return"number"==typeof e?"number:"+Nb(e):"string:"+e}function MI(e){var t;e.isLeafNode()?(t=e.val(),Jh("string"==typeof t||"number"==typeof t||"object"==typeof t&&bd(t,".sv"),"Priority must be a string or number.")):Jh(e===OI||e.isEmpty(),"priority of unexpected type."),Jh(e===OI||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let LI;class FI{constructor(e,t=FI.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Jh(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),MI(this.priorityNode_)}static set __childrenNodeConstructor(e){LI=e}static get __childrenNodeConstructor(){return LI}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new FI(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:FI.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pI(e)?this:".priority"===oI(e)?this.priorityNode_:FI.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:FI.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=oI(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Jh(".priority"!==n||1===aI(e),".priority must be the last token in a path"),this.updateImmediateChild(n,FI.__childrenNodeConstructor.EMPTY_NODE.updateChild(cI(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+DI(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Nb(this.value_):this.value_,this.lazyHash_=sb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===FI.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof FI.__childrenNodeConstructor?-1:(Jh(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=FI.VALUE_TYPE_ORDER.indexOf(t),i=FI.VALUE_TYPE_ORDER.indexOf(n);return Jh(0<=r,"Unknown leaf type: "+t),Jh(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}FI.VALUE_TYPE_ORDER=["object","boolean","number","string"];let UI,qI;const jI=new class extends EI{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?Cb(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return TI.MIN}maxPost(){return new TI(Sb,new FI("[PRIORITY-POST]",qI))}makePost(e,t){var n=UI(e);return new TI(t,new FI("[PRIORITY-POST]",n))}toString(){return".priority"}},VI=Math.log(2);class BI{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/VI,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function KI(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new NI(i,r.node,NI.BLACK,null,null);var s=parseInt(n/2,10)+e,o=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new NI(i,r.node,NI.BLACK,o,n)};var n=function(e){let s=null,o=null,a=c.length;function t(e,t){var n=a-e,r=a;a-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{o=e;s=e}}(new NI(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,NI.BLACK):(t(r,NI.BLACK),t(r,NI.RED))}return o}(new BI(c.length));return new xI(t||e,n)}let $I;const zI={};class WI{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Jh((zI,jI),"ChildrenNode.ts has not been loaded"),$I=$I||new WI({".priority":zI},{".priority":jI}),$I}get(e){var t=Id(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof xI?t:null}hasIndex(e){return bd(this.indexSet_,e.toString())}addIndex(e,t){Jh(e!==CI,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(TI.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?KI(n,e.getCompare()):zI;var a=e.toString();const c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=o,new WI(l,c)}addToIndexes(o,a){var e=Ed(this.indexes_,(t,e)=>{const n=Id(this.indexSet_,e);if(Jh(n,"Missing index implementation for "+e),t===zI){if(n.isDefinedOn(o.node)){const i=[],s=a.getIterator(TI.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),KI(i,n.getCompare())}return zI}{var r=a.get(o.name);let e=t;return r&&(e=e.remove(new TI(o.name,r))),e.insert(o,o.node)}});return new WI(e,this.indexSet_)}removeFromIndexes(n,r){var e=Ed(this.indexes_,e=>{if(e===zI)return e;var t=r.get(n.name);return t?e.remove(new TI(n.name,t)):e});return new WI(e,this.indexSet_)}}let GI;class HI{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&MI(this.priorityNode_),this.children_.isEmpty()&&Jh(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return GI=GI||new HI(new xI(PI),null,WI.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||GI}updatePriority(e){return this.children_.isEmpty()?this:new HI(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?GI:t}getChild(e){var t=oI(e);return null===t?this:this.getImmediateChild(t).getChild(cI(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(Jh(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new TI(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?GI:this.priorityNode_;return new HI(e,i,t)}}updateChild(e,t){var n=oI(e);if(null===n)return t;Jh(".priority"!==oI(e)||1===aI(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(cI(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(jI,(e,t)=>{r[e]=t.val(n),i++,o&&HI.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+DI(this.getPriority().val())+":"),this.forEachChild(jI,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":sb(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new TI(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new TI(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new TI(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,TI.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,TI.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===YI?-1:0}withIndex(e){if(e===CI||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new HI(this.children_,this.priorityNode_,t)}isIndexed(e){return e===CI||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(jI),i=n.getIterator(jI);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===CI?null:this.indexMap_.get(e.toString())}}HI.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class QI extends HI{constructor(){super(new xI(PI),HI.EMPTY_NODE,WI.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return HI.EMPTY_NODE}isEmpty(){return!1}}const YI=new QI;Object.defineProperties(TI,{MIN:{value:new TI(kb,HI.EMPTY_NODE)},MAX:{value:new TI(Sb,YI)}}),SI.__EMPTY_NODE=HI.EMPTY_NODE,FI.__childrenNodeConstructor=HI,Zw=YI,OI=Zw,eb=YI,qI=eb;const JI=!0;function XI(i,e=null){if(null===i)return HI.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),Jh(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new FI(t,XI(e))}if(i instanceof Array||!JI){let r=HI.EMPTY_NODE;return Ab(i,(e,t)=>{if(bd(i,e)&&"."!==e.substring(0,1)){const n=XI(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(XI(e))}{const s=[];let r=!1;if(Ab(i,(e,t)=>{if("."!==e.substring(0,1)){const n=XI(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new TI(e,n)))}}),0===s.length)return HI.EMPTY_NODE;var n=KI(s,RI,e=>e.name,PI);if(r){t=KI(s,jI.getCompare());return new HI(n,XI(e),new WI({".priority":t},{".priority":jI}))}return new HI(n,XI(e),WI.Default)}}UI=XI;class ZI extends EI{constructor(e){super(),this.indexPath_=e,Jh(!pI(e)&&".priority"!==oI(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?Cb(e.name,t.name):r}makePost(e,t){var n=XI(e),n=HI.EMPTY_NODE.updateChild(this.indexPath_,n);return new TI(t,n)}maxPost(){var e=HI.EMPTY_NODE.updateChild(this.indexPath_,YI);return new TI(Sb,e)}toString(){return uI(this.indexPath_,0).join("/")}}function eT(e){if(e===""+Ob)return iT;var t=Db(e);if(null!=t)return""+(t+1);const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e.charAt(i);if(n.length<oT)return n.push(iT),n.join("");let r=n.length-1;for(;0<=r&&n[r]===sT;)r--;return-1===r?Sb:(t=n[r],t=rT.charAt(rT.indexOf(t)+1),n[r]=t,n.slice(0,r+1).join(""))}function tT(e){if(e===""+Pb)return kb;var t=Db(e);if(null!=t)return""+(t-1);const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===iT?1===n.length?""+Ob:(delete n[n.length-1],n.join("")):(n[n.length-1]=rT.charAt(rT.indexOf(n[n.length-1])-1),n.join("")+sT.repeat(oT-n.length))}const nT=new class extends EI{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Cb(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return TI.MIN}maxPost(){return TI.MAX}makePost(e,t){var n=XI(e);return new TI(t,n)}toString(){return".value"}},rT="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",iT="-",sT="z",oT=786,aT=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=rT.charAt(e%64),e=Math.floor(e/64);Jh(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=rT.charAt(o[n]);return Jh(20===i.length,"nextPushId: Length should be 20."),i}}();function cT(e){return{type:"value",snapshotNode:e}}function lT(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function uT(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function hT(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class dT{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){Jh(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(uT(t,o)):Jh(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(lT(t,n)):s.trackChildChange(hT(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(jI,(e,t)=>{n.hasChild(e)||i.trackChildChange(uT(e,t))}),n.isLeafNode()||n.forEachChild(jI,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(hT(e,t,n))}else i.trackChildChange(lT(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?HI.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class pT{constructor(e){this.indexedFilter_=new dT(e.getIndex()),this.index_=e.getIndex(),this.startPost_=pT.getStartPost_(e),this.endPost_=pT.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new TI(t,n))||(n=HI.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?HI.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(HI.EMPTY_NODE);const i=this;return t.forEachChild(jI,(e,t)=>{i.matches(new TI(e,t))||(r=r.updateImmediateChild(e,HI.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class fT{constructor(e){this.rangedFilter_=new pT(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new TI(t,n))||(n=HI.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=HI.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=HI.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;a=a.updateImmediateChild(r.name,r.node),n++}}else{a=o.withIndex(this.index_),a=a.updatePriority(HI.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,HI.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;Jh(o.numChildren()===this.limit_,"");var a=new TI(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(hT(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(uT(t,u));const p=o.updateImmediateChild(t,HI.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(lT(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(uT(c.name,c.node)),i.trackChildChange(lT(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,HI.EMPTY_NODE)):e}}class gT{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=jI}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Jh(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Jh(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:kb}hasEnd(){return this.endSet_}getIndexEndValue(){return Jh(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Jh(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sb}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Jh(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===jI}copy(){const e=new gT;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function mT(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function vT(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function yT(e,t){const n=e.copy();return n.index_=t,n}function _T(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===jI?"$priority":e.index_===nT?"$value":e.index_===CI?"$key":(Jh(e.index_ instanceof ZI,"Unrecognized index type!"),e.index_.toString()),t.orderBy=_d(n),e.startSet_&&(t.startAt=_d(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+_d(e.indexStartName_))),e.endSet_&&(t.endAt=_d(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+_d(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function wT(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==jI&&(n.i=t.index_.toString()),n}class bT extends tI{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=pb("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Jh(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=bT.getListenId_(e,r),a={};this.listens_[o]=a;var n=_T(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),Id(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=bT.getListenId_(e,t);delete this.listens_[n]}get(e){var t=_T(e._queryParams);const r=e._path.toString(),i=new rd;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+Cd(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=yd(r.responseText)}catch(e){Ib("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&Ib("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class IT{constructor(){this.rootNode_=HI.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function TT(){return{value:null,children:new Map}}function ET(e,t,n){var r;pI(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=oI(t),e.children.has(r)||e.children.set(r,TT()),ET(e.children.get(r),t=cI(t),n))}function kT(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{kT(t,new iI(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class ST{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Ab(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class CT{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ST(e);var n=1e4+2e4*Math.random();xb(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Ab(e,(e,t)=>{0<t&&bd(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),xb(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function AT(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function NT(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function xT(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(W=tb=tb||{})[W.OVERWRITE=0]="OVERWRITE",W[W.MERGE=1]="MERGE",W[W.ACK_USER_WRITE=2]="ACK_USER_WRITE",W[W.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class RT{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=tb.ACK_USER_WRITE,this.source=AT()}operationForChild(e){if(pI(this.path)){if(null!=this.affectedTree.value)return Jh(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new iI(e));return new RT(sI(),t,this.revert)}return Jh(oI(this.path)===e,"operationForChild called for unrelated child."),new RT(cI(this.path),this.affectedTree,this.revert)}}class PT{constructor(e,t){this.source=e,this.path=t,this.type=tb.LISTEN_COMPLETE}operationForChild(e){return pI(this.path)?new PT(this.source,sI()):new PT(this.source,cI(this.path))}}class OT{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=tb.OVERWRITE}operationForChild(e){return pI(this.path)?new OT(this.source,sI(),this.snap.getImmediateChild(e)):new OT(this.source,cI(this.path),this.snap)}}class DT{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=tb.MERGE}operationForChild(e){if(pI(this.path)){const t=this.children.subtree(new iI(e));return t.isEmpty()?null:t.value?new OT(this.source,sI(),t.value):new DT(this.source,sI(),t)}return Jh(oI(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new DT(this.source,cI(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class MT{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pI(e))return this.isFullyInitialized()&&!this.filtered_;var t=oI(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class LT{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function FT(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),UT(n,i,"child_removed",e,r,t),UT(n,i,"child_added",e,r,t),UT(n,i,"child_moved",s,r,t),UT(n,i,"child_changed",e,r,t),UT(n,i,"value",e,r,t),i}function UT(s,o,t,e,a,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Xh("Should only compare child_ events.");var r=new TI(t.childName,t.snapshotNode),i=new TI(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function qT(e,t){return{eventCache:e,serverCache:t}}function jT(e,t,n,r){return qT(new MT(t,n,r),e.serverCache)}function VT(e,t,n,r){return qT(e.eventCache,new MT(t,n,r))}function BT(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function KT(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let $T;class zT{constructor(e,t=($T=$T||new xI(gb),$T)){this.value=e,this.children=t}static fromObject(e){let n=new zT(null);return Ab(e,(e,t)=>{n=n.set(new iI(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:sI(),value:this.value};if(pI(e))return null;{var n=oI(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(cI(e),t);return null==r?null:{path:dI(new iI(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pI(e))return this;{var t=oI(e);const n=this.children.get(t);return null!==n?n.subtree(cI(e)):new zT(null)}}set(e,t){if(pI(e))return new zT(t,this.children);{var n=oI(e);const i=this.children.get(n)||new zT(null);var r=i.set(cI(e),t),r=this.children.insert(n,r);return new zT(this.value,r)}}remove(t){if(pI(t))return this.children.isEmpty()?new zT(null):new zT(null,this.children);{var n=oI(t);const r=this.children.get(n);if(r){const i=r.remove(cI(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new zT(null):new zT(this.value,e)}return this}}get(e){if(pI(e))return this.value;{var t=oI(e);const n=this.children.get(t);return n?n.get(cI(e)):null}}setTree(t,n){if(pI(t))return n;{var r=oI(t);const i=this.children.get(r)||new zT(null),s=i.setTree(cI(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new zT(this.value,e)}}fold(e){return this.fold_(sI(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(dI(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,sI(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(pI(e))return null;{r=oI(e);const i=this.children.get(r);return i?i.findOnPath_(cI(e),dI(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,sI(),t)}foreachOnPath_(e,t,n){if(pI(e))return this;{this.value&&n(t,this.value);var r=oI(e);const i=this.children.get(r);return i?i.foreachOnPath_(cI(e),dI(t,r),n):new zT(null)}}foreach(e){this.foreach_(sI(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(dI(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class WT{constructor(e){this.writeTree_=e}static empty(){return new WT(new zT(null))}}function GT(t,n,r){if(pI(n))return new WT(new zT(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=fI(s,n);return e=e.updateChild(i,r),new WT(t.writeTree_.set(s,e))}s=new zT(r),s=t.writeTree_.setTree(n,s);return new WT(s)}function HT(e,n,t){let r=e;return Ab(t,(e,t)=>{r=GT(r,dI(n,e),t)}),r}function QT(e,t){if(pI(t))return WT.empty();var n=e.writeTree_.setTree(t,new zT(null));return new WT(n)}function YT(e,t){return null!=JT(e,t)}function JT(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(fI(n.path,t)):null}function XT(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(jI,(e,t)=>{n.push(new TI(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new TI(e,t.value))}),n}function ZT(e,t){if(pI(t))return e;var n=JT(e,t);return null!=n?new WT(new zT(n)):new WT(e.writeTree_.subtree(t))}function e0(e){return e.writeTree_.isEmpty()}function t0(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(Jh(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(dI(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(dI(i,".priority"),n):s}}}(sI(),e.writeTree_,t)}function n0(e,t){return f0(t,e)}function r0(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);Jh(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){{if(e.snap)return vI(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&vI(dI(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:vI(i.path,c.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=s0(e.allWrites,i0,sI()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=QT(t.visibleWrites,i.path):Ab(i.children,e=>{t.visibleWrites=QT(t.visibleWrites,dI(i.path,e))}),!0)}function i0(e){return e.visible}function s0(e,t,n){let r=WT.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){var i=o.path;let e;if(o.snap)vI(n,i)?(e=fI(n,i),r=GT(r,e,o.snap)):vI(i,n)&&(e=fI(i,n),r=GT(r,sI(),o.snap.getChild(e)));else{if(!o.children)throw Xh("WriteRecord should have .snap or .children");if(vI(n,i))e=fI(n,i),r=HT(r,e,o.children);else if(vI(i,n))if(e=fI(i,n),pI(e))r=HT(r,sI(),o.children);else{const a=Id(o.children,oI(e));a&&(i=a.getChild(cI(e)),r=GT(r,sI(),i))}}}}return r}function o0(e,t,n,r,i){if(r||i){var s=ZT(e.visibleWrites,t);if(!i&&e0(s))return n;if(i||null!=n||YT(s,sI()))return t0(s0(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(vI(e.path,t)||vI(t,e.path))},t),n||HI.EMPTY_NODE);return null}s=JT(e.visibleWrites,t);if(null!=s)return s;s=ZT(e.visibleWrites,t);return e0(s)?n:null!=n||YT(s,sI())?t0(s,n||HI.EMPTY_NODE):null}function a0(e,t,n,r){return o0(e.writeTree,e.treePath,t,n,r)}function c0(e,t){return function(e,t,n){let r=HI.EMPTY_NODE;const i=JT(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(jI,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=ZT(e.visibleWrites,t);return n.forEachChild(jI,(e,t)=>{var n=t0(ZT(s,new iI(e)),t);r=r.updateImmediateChild(e,n)}),XT(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return XT(ZT(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function l0(e,t,n,r){return function(e,t,n,r,i){Jh(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=dI(t,n);return YT(e.visibleWrites,s)?null:e0(s=ZT(e.visibleWrites,s))?i.getChild(n):t0(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function u0(e,t){return n=e.writeTree,t=dI(e.treePath,t),JT(n.visibleWrites,t);var n}function h0(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;var c=ZT(e.visibleWrites,t),l=JT(c,sI());if(null!=l)a=l;else{if(null==n)return[];a=t0(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function d0(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=dI(e,t=t),null!=(s=JT(r.visibleWrites,i))?s:n.isCompleteForChild(t)?t0(ZT(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function p0(e,t){return f0(dI(e.treePath,t),e.writeTree)}function f0(e,t){return{treePath:e,writeTree:t}}class g0{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;Jh("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Jh(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,hT(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,uT(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,lT(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Xh("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,hT(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const m0=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class v0{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new MT(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return d0(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:KT(this.viewCache_),r=h0(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function y0(e,t,n,r,i){const s=new g0;let o,a;if(n.type===tb.OVERWRITE){var c=n;o=c.source.fromUser?b0(e,t,c.path,c.snap,r,i,s):(Jh(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!pI(c.path),w0(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===tb.MERGE){c=n;o=c.source.fromUser?function(r,i,s,e,o,a,c){let l=i;return e.foreach((e,t)=>{var n=dI(s,e);I0(i,oI(n))&&(l=b0(r,l,n,t,o,a,c))}),e.foreach((e,t)=>{var n=dI(s,e);I0(i,oI(n))||(l=b0(r,l,n,t,o,a,c))}),l}(e,t,c.path,c.children,r,i,s):(Jh(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),E0(e,t,c.path,c.children,r,i,a,s))}else if(n.type===tb.ACK_USER_WRITE){var l=n;o=l.revert?function(n,r,i,s,e,o){let a;{if(null!=u0(s,i))return r;{var c=new v0(s,r,e);const u=r.eventCache.getNode();let t;if(pI(i)||".priority"===oI(i)){let e;e=r.serverCache.isFullyInitialized()?a0(s,KT(r)):(l=r.serverCache.getNode(),Jh(l instanceof HI,"serverChildren would be complete if leaf node"),c0(s,l)),e=e,t=n.filter.updateFullNode(u,e,o)}else{var l=oI(i);let e=d0(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,cI(i),c,o):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,HI.EMPTY_NODE,cI(i),c,o):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(a=a0(s,KT(r)),a.isLeafNode()&&(t=n.filter.updateFullNode(t,a,o)))}return a=r.serverCache.isFullyInitialized()||null!=u0(s,sI()),jT(r,t,a,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=u0(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(pI(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return w0(e,t,i,l.getNode().getChild(i),s,o,c,a);if(pI(i)){let n=new zT(null);return l.getNode().forEachChild(CI,(e,t)=>{n=n.set(new iI(e),t)}),E0(e,t,i,n,s,o,c,a)}return t}{let r=new zT(null);return n.foreach((e,t)=>{var n=dI(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),E0(e,t,i,r,s,o,c,a)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==tb.LISTEN_COMPLETE)throw Xh("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=VT(t,s.getNode(),s.isFullyInitialized()||pI(n),s.isFiltered());return _0(e,o,n,r,m0,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=BT(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(cT(BT(t)))}}(t,o,l),{viewCache:o,changes:l}}function _0(r,i,s,o,a,c){const l=i.eventCache;if(null!=u0(o,s))return i;{let t,n;if(pI(s)){var e;Jh(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=c0(o,(e=KT(i))instanceof HI?e:HI.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=a0(o,KT(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=oI(s);if(".priority"===u){Jh(1===aI(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=l0(o,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=cI(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=l0(o,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):d0(o,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,a,c):l.getNode()}}return jT(i,t,l.isFullyInitialized()||pI(s),r.filter.filtersNodes())}}function w0(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(pI(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=oI(n);if(!c.isCompleteForPath(n)&&1<aI(n))return t;var p=cI(n);const f=c.getNode().getImmediateChild(d);h=f.updateChild(p,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,p,m0,null)}p=VT(t,l,c.isFullyInitialized()||pI(n),u.filtersNodes());return _0(e,p,n,i,new v0(i,p,s),a)}function b0(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new v0(e,n,s);if(pI(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=jT(n,l,!0,t.filter.filtersNodes());else{var h=oI(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=jT(n,l,a.isFullyInitialized(),a.isFiltered());else{var d=cI(r);const p=a.getNode().getImmediateChild(h);let e;if(pI(d))e=i;else{const f=u.getCompleteChild(h);e=null!=f?".priority"===lI(d)&&f.getChild(hI(d)).isEmpty()?f:f.updateChild(d,i):HI.EMPTY_NODE}c=p.equals(e)?n:jT(n,t.filter.updateChild(a.getNode(),h,e,d,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return c}function I0(e,t){return e.eventCache.isCompleteForChild(t)}function T0(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function E0(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=pI(e)?t:new zT(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=T0(0,i.serverCache.getNode().getImmediateChild(e),t),l=w0(r,l,new iI(e),n,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(n=T0(0,i.serverCache.getNode().getImmediateChild(e),t),l=w0(r,l,new iI(e),n,s,o,a,c))}),l}class k0{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new dT(n.getIndex()),i=(e=n).loadsAllData()?new dT(e.getIndex()):new(e.hasLimit()?fT:pT)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;var a=r.updateFullNode(HI.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(HI.EMPTY_NODE,o.getNode(),null),a=new MT(a,s.isFullyInitialized(),r.filtersNodes()),c=new MT(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=qT(c,a),this.eventGenerator_=new LT(this.query_)}get query(){return this.query_}}function S0(e){return 0===e.eventRegistrations_.length}function C0(n,r,i){const s=[];if(i){Jh(null==r,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,o);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const a=n.eventRegistrations_[t];if(a.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(a)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function A0(e,t,n,r){t.type===tb.MERGE&&null!==t.source.queryId&&(Jh(KT(e.viewCache_),"We should always have a full cache before handling merges"),Jh(BT(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=y0(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,Jh(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Jh(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),Jh(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,N0(e,s.changes,s.viewCache.eventCache.getNode(),null)}function N0(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return FT(e.eventGenerator_,t,n,i)}let x0;class R0{constructor(){this.views=new Map}}function P0(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return Jh(null!=e,"SyncTree gave us an op for an invalid query."),A0(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(A0(s,n,r,i));return e}}function O0(e,n,r,i,s){var o=n._queryIdentifier,o=e.views.get(o);if(o)return o;{let e=a0(r,s?i:null),t=!1;t=!!e||(e=i instanceof HI?c0(r,i):HI.EMPTY_NODE,!1);o=qT(new MT(e,t,!1),new MT(i,s,!1));return new k0(n,o)}}function D0(e,t,n,r,i,s){var o=O0(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(jI,(e,t)=>{r.push(lT(e,t))})}return n.isFullyInitialized()&&r.push(cT(n.getNode())),N0(e,r,n.getNode(),t)}(o,n)}function M0(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=j0(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(C0(l,n,r)),S0(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(C0(u,n,r)),S0(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!j0(e)&&s.push((Jh(x0,"Reference.ts has not been loaded"),new x0(t._repo,t._path))),{removed:s,events:o}}function L0(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function F0(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=KT(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!pI(t)&&!n.getImmediateChild(oI(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function U0(e,t){const n=t._queryParams;if(n.loadsAllData())return V0(e);var r=t._queryIdentifier;return e.views.get(r)}function q0(e,t){return null!=U0(e,t)}function j0(e){return null!=V0(e)}function V0(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let B0;let K0=1;class $0{constructor(e){this.listenProvider_=e,this.syncPointTree_=new zT(null),this.pendingWriteTree_={visibleWrites:WT.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function z0(e,t,n,r,i){var s,o,a,c;return s=e.pendingWriteTree_,o=t,a=n,c=r,r=i,Jh(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=GT(s.visibleWrites,o,a)),s.lastWriteId=c,i?Z0(e,new OT(AT(),t,n)):[]}function W0(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,r=r,Jh(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=HT(i.visibleWrites,s,o),i.lastWriteId=r;var a=zT.fromObject(n);return Z0(e,new DT(AT(),t,a))}function G0(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(r0(e.pendingWriteTree_,t)){let t=new zT(null);return null!=r.snap?t=t.set(sI(),!0):Ab(r.children,e=>{t=t.set(new iI(e),!0)}),Z0(e,new RT(r.path,t,n))}return[]}function H0(e,t,n){return Z0(e,new OT(NT(),t,n))}function Q0(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||q0(s,e))){var a=M0(s,e,t,r);0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const h=a.removed;o=a.events;s=-1!==h.findIndex(e=>e._queryParams.loadsAllData()),a=n.syncPointTree_.findOnPath(i,(e,t)=>j0(t));if(s&&!a){const d=n.syncPointTree_.subtree(i);if(!d.isEmpty()){var c=d.fold((e,t,r)=>{if(t&&j0(t))return[V0(t)];{let n=[];return t&&(n=L0(t)),Ab(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e],u=l.query,l=tE(n,l);n.listenProvider_.startListening(aE(u),nE(n,u),l.hashFn,l.onComplete)}}}!a&&0<h.length&&!r&&(s?n.listenProvider_.stopListening(aE(e),null):h.forEach(e=>{var t=n.queryToTagMap.get(rE(e));n.listenProvider_.stopListening(aE(e),t)})),function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=rE(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,h)}return o}function Y0(e,t,n){const r=t._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=fI(e,r);i=i||F0(t,n),s=s||j0(t)});let o=e.syncPointTree_.get(r);o?(s=s||j0(o),i=i||F0(o,sI())):(o=new R0,e.syncPointTree_=e.syncPointTree_.set(r,o));let a;if(null!=i)a=!0;else{a=!1,i=HI.EMPTY_NODE;const d=e.syncPointTree_.subtree(r);d.foreachChild((e,t)=>{var n=F0(t,sI());n&&(i=i.updateImmediateChild(e,n))})}var c,l=q0(o,t);l||t._queryParams.loadsAllData()||(u=rE(t),Jh(!e.queryToTagMap.has(u),"View does not exist, but we have a tag"),c=K0++,e.queryToTagMap.set(u,c),e.tagToQueryMap.set(c,u));var u=n0(e.pendingWriteTree_,r);let h=D0(o,t,n,u,i,a);return l||s||(l=U0(o,t),h=h.concat(function(t,e,n){const r=e._path,i=nE(t,e),s=tE(t,n),o=t.listenProvider_.startListening(aE(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)Jh(!j0(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!pI(e)&&t&&j0(t))return[V0(t).query];{let n=[];return t&&(n=n.concat(L0(t).map(e=>e.query))),Ab(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(aE(l),nE(t,l))}}return o}(e,t,l))),h}function J0(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=F0(t,fI(e,r));if(n)return n});return o0(n,r,i,t,!0)}function X0(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=fI(e,r);i=i||F0(t,n)});let n=e.syncPointTree_.get(r);n?i=i||F0(n,sI()):(n=new R0,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const o=s?new MT(i,!0,!1):null;var a=n0(e.pendingWriteTree_,t._path);return BT(O0(n,t,a,s?o.getNode():HI.EMPTY_NODE,s).viewCache_)}function Z0(e,t){return function t(n,r,i,s){{if(pI(n.path))return eE(n,r,i,s);{const o=r.get(sI());null==i&&null!=o&&(i=F0(o,sI()));let e=[];const a=oI(n.path),c=n.operationForChild(a),l=r.children.get(a);if(l&&c){const u=i?i.getImmediateChild(a):null,h=p0(s,a);e=e.concat(t(c,l,u,h))}return o&&(e=e.concat(P0(o,n,s,i))),e}}}(t,e.syncPointTree_,null,n0(e.pendingWriteTree_,sI()))}function eE(s,e,o,a){var t=e.get(sI());null==o&&null!=t&&(o=F0(t,sI()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=o?o.getImmediateChild(e):null,r=p0(a,e),i=s.operationForChild(e);i&&(c=c.concat(eE(i,t,n,r)))}),t&&(c=c.concat(P0(t,s,a,o))),c}function tE(i,t){const s=t.query,o=nE(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||HI.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return o?function(e,t,n){if(s=iE(e,n)){var r=sE(s),i=r.path,s=r.queryId,r=fI(i,t);return oE(e,i,new PT(xT(s),r))}return[]}(i,s._path,o):(t=i,n=s._path,Z0(t,new PT(NT(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return Q0(i,s,null,r)}}}function nE(e,t){var n=rE(t);return e.queryToTagMap.get(n)}function rE(e){return e._path.toString()+"$"+e._queryIdentifier}function iE(e,t){return e.tagToQueryMap.get(t)}function sE(e){var t=e.indexOf("$");return Jh(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new iI(e.substr(0,t))}}function oE(e,t,n){var r=e.syncPointTree_.get(t);return Jh(r,"Missing sync point for query tag that we're tracking"),P0(r,n,n0(e.pendingWriteTree_,t),null)}function aE(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(Jh(B0,"Reference.ts has not been loaded"),new B0(e._repo,e._path)):e}class cE{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new cE(t)}node(){return this.node_}}class lE{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=dI(this.path_,e);return new lE(this.syncTree_,t)}node(){return J0(this.syncTree_,this.path_)}}function uE(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function hE(e,t,n){return e&&"object"==typeof e?(Jh(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?dE(e[".sv"],t,n):"object"==typeof e[".sv"]?pE(e[".sv"],t):void Jh(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const dE=function(e,t,n){if("timestamp"===e)return n.timestamp;Jh(!1,"Unexpected server value: "+e)},pE=function(e,t,n){e.hasOwnProperty("increment")||Jh(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&Jh(!1,"Unexpected increment value: "+r);const i=t.node();if(Jh(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var o=s.getValue();return"number"!=typeof o?r:o+r},fE=function(e,t,n,r){return mE(t,new lE(n,e),r)},gE=function(e,t,n){return mE(e,new cE(t),n)};function mE(e,r,i){var t=e.getPriority().val(),n=hE(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=hE(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new FI(t,XI(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new FI(n))),a.forEachChild(jI,(e,t)=>{var n=mE(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class vE{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function yE(e,t){let n=t instanceof iI?t:new iI(t),r=e,i=oI(n);for(;null!==i;){var s=Id(r.node.children,i)||{children:{},childCount:0};r=new vE(i,r,s),n=cI(n),i=oI(n)}return r}function _E(e){return e.node.value}function wE(e,t){e.node.value=t,EE(e)}function bE(e){return 0<e.node.childCount}function IE(n,r){Ab(n.node.children,(e,t)=>{r(new vE(e,n,t))})}function TE(e){return new iI(null===e.parent?e.name:TE(e.parent)+"/"+e.name)}function EE(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===_E(e)&&!bE(e)}(e=e),i=bd(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,EE(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,EE(t)))}function kE(e,t,n,r){r&&void 0===t||UE(Md(e,"value"),t,n)}function SE(e,t,r,n){if(!n||void 0!==t){const i=Md(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ab(t,(e,t)=>{const n=new iI(e);if(UE(i,t,dI(r,n)),".priority"===lI(n)&&!FE(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=uI(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!DE(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(gI);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&vI(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function CE(e,t,n){if(!n||void 0!==t){if(Eb(t))throw new Error(Md(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!FE(t))throw new Error(Md(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function AE(e,t,n,r){if(!(r&&void 0===n||DE(n)))throw new Error(Md(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function NE(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),qE(e,t,n,r)}function xE(e,t){if(".info"===oI(t))throw new Error(e+" failed = Can't modify data under /.info/")}const RE=/[\[\].#$\/\u0000-\u001F\u007F]/,PE=/[\[\].#$\u0000-\u001F\u007F]/,OE=10485760,DE=function(e){return"string"==typeof e&&0!==e.length&&!RE.test(e)},ME=function(e){return"string"==typeof e&&0!==e.length&&!PE.test(e)},LE=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),ME(e)},FE=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Eb(e)||e&&"object"==typeof e&&bd(e,".sv")},UE=function(o,e,t){const a=t instanceof iI?new yI(t,o):t;if(void 0===e)throw new Error(o+"contains undefined "+wI(a));if("function"==typeof e)throw new Error(o+"contains a function "+wI(a)+" with contents = "+e.toString());if(Eb(e))throw new Error(o+"contains "+e.toString()+" "+wI(a));if("string"==typeof e&&e.length>OE/3&&Ud(e)>OE)throw new Error(o+"contains a string greater than "+OE+" utf8 bytes "+wI(a)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(Ab(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!DE(e)))throw new Error(o+" contains an invalid key ("+e+") "+wI(a)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=a,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ud(e),_I(n),UE(o,t,a),t=a,r=t.parts_.pop(),t.byteLength_-=Ud(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(o+' contains ".value" child '+wI(a)+" in addition to actual children.")}},qE=function(e,t,n,r){if(!(r&&void 0===n||ME(n)))throw new Error(Md(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},jE=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!DE(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!LE(n))throw new Error(Md(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class VE{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function BE(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||mI(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function KE(e,t,n){BE(e,n),zE(e,e=>mI(e,t))}function $E(e,t,n){BE(e,n),zE(e,e=>vI(e,t)||vI(t,e))}function zE(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),hb&&wb("event: "+r.toString()),Mb(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const WE="repo_interrupt",GE=25;class HE{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new VE,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=TT(),this.transactionQueueTree_=new vE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function QE(o,e,t){if(o.stats_=Gb(o.repoInfo_),o.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())o.server_=new bT(o.repoInfo_,(e,t,n,r)=>{XE(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>ZE(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{_d(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new II(o.repoInfo_,e,(e,t,n,r)=>{XE(o,e,t,n,r)},e=>{ZE(o,e)},e=>{var n;n=o,Ab(e,(e,t)=>{ek(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}var n;o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new CT(o.stats_,o.server_),n=e.toString(),Wb[n]||(Wb[n]=t()),Wb[n]),o.infoData_=new IT,o.infoSyncTree_=new $0({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=H0(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),ek(o,"connected",!1),o.serverSyncTree_=new $0({startListening:(r,e,t,i)=>(o.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);$E(o.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function YE(e){const t=e.infoData_.getNode(new iI(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function JE(e){return uE({timestamp:YE(e)})}function XE(e,t,n,r,i){e.dataUpdateCount++;var s,o,a=new iI(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=Ed(n,e=>XI(e)),function(e,t,n,r){if(a=iE(e,r)){var i=sE(a),s=i.path,o=i.queryId,a=fI(s,t),i=zT.fromObject(n);return oE(e,s,new DT(xT(o),a,i))}return[]}(e.serverSyncTree_,a,s,i)):(s=XI(n),function(e,t,n,r){if(null==(s=iE(e,r)))return[];var i=(o=sE(s)).path,s=o.queryId,o=fI(i,t);return oE(e,i,new OT(xT(s),o,n))}(e.serverSyncTree_,a,s,i)):r?(o=Ed(n,e=>XI(e)),t=e.serverSyncTree_,i=a,r=o,o=zT.fromObject(r),Z0(t,new DT(NT(),i,o))):(o=XI(n),H0(e.serverSyncTree_,a,o));let l=a;0<c.length&&(l=hk(e,a)),$E(e.eventQueue_,l,c)}function ZE(e,t){ek(e,"connected",t),!1===t&&function(r){ak(r,"onDisconnectEvents");const i=JE(r),s=TT();kT(r.onDisconnect_,sI(),(e,t)=>{var n=fE(e,t,r.serverSyncTree_,i);ET(s,e,n)});let o=[];kT(s,sI(),(e,t)=>{o=o.concat(H0(r.serverSyncTree_,e,t));var n=gk(r,e);hk(r,n)}),r.onDisconnect_=TT(),$E(r.eventQueue_,sI(),o)}(e)}function ek(e,t,n){var r=new iI("/.info/"+t),i=XI(n);e.infoData_.updateSnapshot(r,i);i=H0(e.infoSyncTree_,r,i);$E(e.eventQueue_,r,i)}function tk(e){return e.nextWriteId_++}function nk(r,i,e,t,s){ak(r,"set",{path:i.toString(),value:e,priority:t});var n=JE(r);const o=XI(e,t);var a=J0(r.serverSyncTree_,i),n=gE(o,a,n);const c=tk(r);n=z0(r.serverSyncTree_,i,n,c,!0);BE(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||Ib("set at "+i+" failed: "+e);n=G0(r.serverSyncTree_,c,!n);$E(r.eventQueue_,i,n),ck(0,s,e,t)});n=gk(r,i);hk(r,n),$E(r.eventQueue_,n,[])}function rk(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(pI(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(jI,(e,t)=>{ET(n,new iI(e),t)}),e(n,t)}}if(0<n.children.size){var r=oI(t);return t=cI(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),ck(0,i,e,t)})}function ik(n,r,e,i){const s=XI(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&ET(n.onDisconnect_,r,s),ck(0,i,e,t)})}function sk(e,t,n){let r;r=".info"===oI(t._path)?Q0(e.infoSyncTree_,t,n):Q0(e.serverSyncTree_,t,n),KE(e.eventQueue_,t._path,r)}function ok(e){e.persistentConnection_&&e.persistentConnection_.interrupt(WE)}function ak(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),wb(n,...t)}function ck(e,r,i,s){r&&Mb(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function lk(e,t,n){return J0(e.serverSyncTree_,t,n)||HI.EMPTY_NODE}function uk(t,e=t.transactionQueueTree_){if(e||fk(t,e),_E(e)){const n=pk(t,e);Jh(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=lk(i,s,e);let n=t;var r=t.hash();for(let u=0;u<o.length;u++){const h=o[u];Jh(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var a=fI(s,h.path);n=n.updateChild(a,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{ak(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat(G0(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();fk(i,yE(i.transactionQueueTree_,s)),uk(i,i.transactionQueueTree_),$E(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)Mb(r[t])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{Ib("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}hk(i,s)}},r)}(t,TE(e),n)}else bE(e)&&IE(e,e=>{uk(t,e)})}function hk(e,t){var n=dk(e,t),r=TE(n);return function(i,s,o){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var a=fI(o,h.path);let e=!1,t;if(Jh(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(G0(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=GE)e=!0,t="maxretry",n=n.concat(G0(i.serverSyncTree_,h.currentWriteId,!0));else{const d=lk(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){UE("transaction failed: Data returned ",c,h.path);let e=XI(c);"object"==typeof c&&null!=c&&bd(c,".priority")||(e=e.updatePriority(d.getPriority()));a=h.currentWriteId,c=JE(i),c=gE(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=tk(i),u.splice(u.indexOf(a),1),n=n.concat(z0(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(G0(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",n=n.concat(G0(i.serverSyncTree_,h.currentWriteId,!0))}$E(i.eventQueue_,o,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}fk(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Mb(l[e]);uk(i,i.transactionQueueTree_)}}(e,pk(e,n),r),r}function dk(e,t){let n,r=e.transactionQueueTree_;for(n=oI(t);null!==n&&void 0===_E(r);)r=yE(r,n),t=cI(t),n=oI(t);return r}function pk(e,t){const n=[];return function t(n,e,r){const i=_E(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);IE(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function fk(t,n){const r=_E(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,wE(n,0<r.length?r:void 0)}IE(n,e=>{fk(t,e)})}function gk(t,e){var n=TE(dk(t,e)),r=yE(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{mk(t,e)}),mk(t,r),function t(e,n,r,i){r&&!i&&n(e),IE(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{mk(t,e)}),n}function mk(i,s){const o=_E(s);if(o){const a=[];let e=[],t=-1;for(let n=0;n<o.length;n++)3===o[n].status||(1===o[n].status?(Jh(t===n-1,"All SENT items should be at beginning of queue."),t=n,o[n].status=3,o[n].abortReason="set"):(Jh(0===o[n].status,"Unexpected transaction status in abort"),o[n].unwatcher(),e=e.concat(G0(i.serverSyncTree_,o[n].currentWriteId,!0)),o[n].onComplete&&a.push(o[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?wE(s,void 0):o.length=t+1,$E(i.eventQueue_,TE(s),e);for(let r=0;r<a.length;r++)Mb(a[r])}}const vk=function(e,t){var n=yk(e),r=n.namespace;"firebase.com"===n.domain&&bb(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||bb("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Tb();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Bb(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new iI(n.pathString)}},yk=function(r){let i="",s="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ib(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(d=i.indexOf("."),o=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=o),"ns"in p&&(c=p.ns)}return{host:i,port:h,domain:s,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class _k{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+_d(this.snapshot.exportVal())}}class wk{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class bk{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Jh(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ik{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new rd;return rk(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){xE("OnDisconnect.remove",this._path);const e=new rd;return ik(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){xE("OnDisconnect.set",this._path),kE("OnDisconnect.set",e,this._path,!1);const t=new rd;return ik(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){xE("OnDisconnect.setWithPriority",this._path),kE("OnDisconnect.setWithPriority",e,this._path,!1),CE("OnDisconnect.setWithPriority",t,!1);const n=new rd;return function(n,r,e,t,i){const s=XI(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&ET(n.onDisconnect_,r,s),ck(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){xE("OnDisconnect.update",this._path),SE("OnDisconnect.update",e,this._path,!1);const t=new rd;return function(r,i,n,s){if(Td(n))return wb("onDisconnect().update() called with empty data.  Don't do anything."),ck(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&Ab(n,(e,t)=>{var n=XI(t);ET(r.onDisconnect_,dI(i,e),n)}),ck(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class Tk{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return pI(this._path)?null:lI(this._path)}get ref(){return new Ck(this._repo,this._path)}get _queryIdentifier(){var e=wT(this._queryParams),e=vb(e);return"{}"===e?"default":e}get _queryObject(){return wT(this._queryParams)}isEqual(e){if(!((e=$d(e))instanceof Tk))return!1;var t=this._repo===e._repo,n=mI(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function Ek(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function kk(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===CI){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==kb)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Sb)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===jI){if(null!=t&&!FE(t)||null!=n&&!FE(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Jh(e.getIndex()instanceof ZI||e.getIndex()===nT,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Sk(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Ck extends Tk{constructor(e,t){super(e,t,new gT,!1)}get parent(){var e=hI(this._path);return null===e?null:new Ck(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Ak{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new iI(e),n=Rk(this.ref,e);return new Ak(this._node.getChild(t),n,jI)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new Ak(t,Rk(this.ref,e),jI)))}hasChild(e){var t=new iI(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Nk(e,t){return(e=$d(e))._checkNotDeleted("ref"),void 0!==t?Rk(e._root,t):e._root}function xk(e,t){(e=$d(e))._checkNotDeleted("refFromURL");const n=vk(t,e._repo.repoInfo_.nodeAdmin);jE("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||bb("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Nk(e,n.path.toString())}function Rk(e,t){return(null===oI((e=$d(e))._path)?NE:qE)("child","path",t,!1),new Ck(e._repo,dI(e._path,t))}function Pk(e,t){e=$d(e),xE("set",e._path),kE("set",t,e._path,!1);const n=new rd;return nk(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function Ok(e,t){SE("update",t,e._path,!1);const n=new rd;return function(i,s,e,o){ak(i,"update",{path:s.toString(),value:e});let n=!0;const r=JE(i),a={};if(Ab(e,(e,t)=>{n=!1,a[e]=fE(dI(s,e),XI(t),i.serverSyncTree_,r)}),n)wb("update() called with empty data.  Don't do anything."),ck(0,o,"ok",void 0);else{const c=tk(i);var t=W0(i.serverSyncTree_,s,a,c);BE(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||Ib("update at "+s+" failed: "+e);var r=G0(i.serverSyncTree_,c,!n),n=0<r.length?hk(i,s):s;$E(i.eventQueue_,n,r),ck(0,o,e,t)}),Ab(e,e=>{var t=gk(i,dI(s,e));hk(i,t)}),$E(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function Dk(t){return t=$d(t),r=t._repo,i=t,(null!=(e=X0(r.serverSyncTree_,i))?Promise.resolve(e):r.server_.get(i).then(e=>{var t=XI(e).withIndex(i._queryParams.getIndex()),n=H0(r.serverSyncTree_,i._path,t);return KE(r.eventQueue_,i._path,n),Promise.resolve(t)},e=>(ak(r,"get for query "+_d(i)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new Ak(e,new Ck(t._repo,t._path),t._queryParams.getIndex()));var r,i,e}class Mk{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new _k("value",this,new Ak(e.snapshotNode,new Ck(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wk(this,e,t):null}matches(e){return e instanceof Mk&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Lk{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wk(this,e,t):null}createEvent(e,t){Jh(null!=e.childName,"Child events should have a childName.");var n=Rk(new Ck(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new _k(e.type,this,new Ak(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Lk&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Fk(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var o=(e,t)=>{sk(n._repo,n,a),c(e,t)};o.userCallback=t.userCallback,o.context=t.context,t=o}o=new bk(t,s||void 0);const a="value"===e?new Mk(o):new Lk(e,o);return function(e,t,n){let r;r=".info"===oI(t._path)?Y0(e.infoSyncTree_,t,n):Y0(e.serverSyncTree_,t,n),KE(e.eventQueue_,t._path,r)}(n._repo,n,a),()=>sk(n._repo,n,a)}function Uk(e,t,n,r){return Fk(e,"value",t,n,r)}function qk(e,t,n,r){return Fk(e,"child_added",t,n,r)}function jk(e,t,n,r){return Fk(e,"child_changed",t,n,r)}function Vk(e,t,n,r){return Fk(e,"child_moved",t,n,r)}function Bk(e,t,n,r){return Fk(e,"child_removed",t,n,r)}function Kk(e,t,n){let r=null;var i=n?new bk(n):null;"value"===t?r=new Mk(i):t&&(r=new Lk(t,i)),sk(e._repo,e,r)}class $k{}class zk extends $k{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){kE("endAt",this._value,e._path,!0);var t=vT(e._queryParams,this._value,this._key);if(Sk(t),kk(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tk(e._repo,e._path,t,e._orderByCalled)}}class Wk extends $k{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){kE("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===CI?vT(e,t="string"==typeof t?tT(t):t,n):(r=null==n?kb:tT(n),vT(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(Sk(t),kk(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tk(e._repo,e._path,t,e._orderByCalled)}}class Gk extends $k{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){kE("startAt",this._value,e._path,!0);var t=mT(e._queryParams,this._value,this._key);if(Sk(t),kk(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Tk(e._repo,e._path,t,e._orderByCalled)}}class Hk extends $k{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){kE("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===CI)"string"==typeof n&&(n=eT(n)),i=mT(t,n,r);else{let e;e=null==r?Sb:eT(r),i=mT(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(Sk(t),kk(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Tk(e._repo,e._path,t,e._orderByCalled)}}class Qk extends $k{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tk(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class Yk extends $k{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tk(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Jk extends $k{constructor(e){super(),this._path=e}_apply(e){Ek(e,"orderByChild");var t=new iI(this._path);if(pI(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new ZI(t),t=yT(e._queryParams,t);return kk(t),new Tk(e._repo,e._path,t,!0)}}class Xk extends $k{_apply(e){Ek(e,"orderByKey");var t=yT(e._queryParams,CI);return kk(t),new Tk(e._repo,e._path,t,!0)}}class Zk extends $k{_apply(e){Ek(e,"orderByPriority");var t=yT(e._queryParams,jI);return kk(t),new Tk(e._repo,e._path,t,!0)}}class eS extends $k{_apply(e){Ek(e,"orderByValue");var t=yT(e._queryParams,nT);return kk(t),new Tk(e._repo,e._path,t,!0)}}class tS extends $k{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(kE("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new zk(this._value,this._key)._apply(new Gk(this._value,this._key)._apply(e))}}function nS(e,...t){let n=$d(e);for(const r of t)n=r._apply(n);return n}nb=Ck,Jh(!x0,"__referenceConstructor has already been defined"),x0=nb,rb=Ck,Jh(!B0,"__referenceConstructor has already been defined"),B0=rb;const rS="FIREBASE_DATABASE_EMULATOR_HOST",iS={};let sS=!1;function oS(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||bb("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),wb("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=vk(s,i),a=o.repoInfo,c,l=void 0;"undefined"!=typeof process&&(l=process.env[rS]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=vk(s,i),a=o.repoInfo):c=!o.repoInfo.secure;var u=i&&c?new Ub(Ub.OWNER):new Fb(e.name,e.options,t);jE("Invalid Firebase Database URL",o),pI(o.path)||bb("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=iS[t.name];i||(i={},iS[t.name]=i);var s=i[e.toURLString()];s&&bb("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new HE(e,sS,n,r),i[e.toURLString()]=s}(a,e,u,new Lb(e.name,n));return new aS(u,e)}class aS{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(QE(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ck(this._repo,sI())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=iS[t];n&&n[e.key]===e||bb(`Database ${t}(${e.repoInfo_}) has already been deleted.`),ok(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&bb("Cannot call "+e+" on a deleted database.")}}function cS(e,t,n,r={}){(e=$d(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&bb("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&bb('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ub(Ub.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:id(r.mockUserToken,e.app.options.projectId),o=new Ub(i)),r=s,e=t,t=n,n=o,r.repoInfo_=new Bb(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams),n&&(r.authTokenProvider_=n)}function lS(e){(e=$d(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(WE)}function uS(e,t){_b(e,t)}const hS={".sv":"timestamp"};class dS{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function pS(i,e,t){if(i=$d(i),xE("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new rd;var r=Uk(i,()=>{});return function(t,n,e,r,i,s){ak(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:lb(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=lk(t,n,void 0);o.currentInputSnapshot=a;var c=o.update(a.val());if(void 0===c)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{UE("transaction failed: Data returned ",c,o.path),o.status=0;var l=yE(t.transactionQueueTree_,n);const u=_E(l)||[];u.push(o),wE(l,u);let e;if("object"==typeof c&&null!==c&&bd(c,".priority"))e=Id(c,".priority"),Jh(FE(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=J0(t.serverSyncTree_,n)||HI.EMPTY_NODE;e=h.getPriority().val()}l=JE(t),c=XI(c,e),l=gE(c,a,l);o.currentOutputSnapshotRaw=c,o.currentOutputSnapshotResolved=l,o.currentWriteId=tk(t);l=z0(t.serverSyncTree_,n,l,o.currentWriteId,o.applyLocally);$E(t.eventQueue_,n,l),uk(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new Ak(n,new Ck(i._repo,i._path),jI),s.resolve(new dS(t,r)))},r,n),s.promise}II.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},II.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Yw(gp),hp(new zd("database",(e,{instanceIdentifier:t})=>{return oS(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),_p(Hw,"0.12.5",ib),_p(Hw,"0.12.5","esm2017");function fS(e){var t="FIREBASE WARNING: "+e;gS.warn(t)}const gS=new ep("@firebase/database-compat");class mS{constructor(e){this._delegate=e}cancel(t){Dd("OnDisconnect.cancel",0,1,arguments.length),Ld("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Dd("OnDisconnect.remove",0,1,arguments.length),Ld("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Dd("OnDisconnect.set",1,2,arguments.length),Ld("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Dd("OnDisconnect.setWithPriority",2,3,arguments.length),Ld("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Dd("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,fS("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ld("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class vS{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Dd("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class yS{constructor(e,t){this._database=e,this._delegate=t}val(){return Dd("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Dd("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Dd("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Dd("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Dd("DataSnapshot.child",0,1,arguments.length),e=String(e),qE("DataSnapshot.child","path",e,!1),new yS(this._database,this._delegate.child(e))}hasChild(e){return Dd("DataSnapshot.hasChild",1,1,arguments.length),qE("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Dd("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Dd("DataSnapshot.forEach",1,1,arguments.length),Ld("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new yS(this._database,e)))}hasChildren(){return Dd("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Dd("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Dd("DataSnapshot.ref",0,0,arguments.length),new wS(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class _S{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;Dd("Query.on",2,4,arguments.length),Ld("Query.on","callback",n,!1);const s=_S.getCancelAndContextArgs_("Query.on",t,r);var o=(e,t)=>{n.call(s.context,new yS(this.database,e),t)};o.userCallback=n,o.context=s.context;var a=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return Uk(this._delegate,o,a),n;case"child_added":return qk(this._delegate,o,a),n;case"child_removed":return Bk(this._delegate,o,a),n;case"child_changed":return jk(this._delegate,o,a),n;case"child_moved":return Vk(this._delegate,o,a),n;default:throw new Error(Md("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Dd("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Md(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Ld("Query.off","callback",t,!0),Fd("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,Kk(this._delegate,e,r)):Kk(this._delegate,e)}get(){return Dk(this._delegate).then(e=>new yS(this.database,e))}once(e,r,t,n){Dd("Query.once",1,4,arguments.length),Ld("Query.once","callback",r,!0);const i=_S.getCancelAndContextArgs_("Query.once",t,n),s=new rd;var o=(e,t)=>{var n=new yS(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};o.userCallback=r,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":Uk(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":qk(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":Bk(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":jk(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":Vk(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Md("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Dd("Query.limitToFirst",1,1,arguments.length),new _S(this.database,nS(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Qk(e)}(e)))}limitToLast(e){return Dd("Query.limitToLast",1,1,arguments.length),new _S(this.database,nS(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Yk(e)}(e)))}orderByChild(e){return Dd("Query.orderByChild",1,1,arguments.length),new _S(this.database,nS(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return qE("orderByChild","path",e,!1),new Jk(e)}(e)))}orderByKey(){return Dd("Query.orderByKey",0,0,arguments.length),new _S(this.database,nS(this._delegate,new Xk))}orderByPriority(){return Dd("Query.orderByPriority",0,0,arguments.length),new _S(this.database,nS(this._delegate,new Zk))}orderByValue(){return Dd("Query.orderByValue",0,0,arguments.length),new _S(this.database,nS(this._delegate,new eS))}startAt(e=null,t){return Dd("Query.startAt",0,2,arguments.length),new _S(this.database,nS(this._delegate,([e=null,t]=[e,t],AE("startAt","key",t,!0),new Gk(e,t))))}startAfter(e=null,t){return Dd("Query.startAfter",0,2,arguments.length),new _S(this.database,nS(this._delegate,(e=e,t=t,AE("startAfter","key",t,!0),new Hk(e,t))))}endAt(e=null,t){return Dd("Query.endAt",0,2,arguments.length),new _S(this.database,nS(this._delegate,(e=e,t=t,AE("endAt","key",t,!0),new zk(e,t))))}endBefore(e=null,t){return Dd("Query.endBefore",0,2,arguments.length),new _S(this.database,nS(this._delegate,(e=e,t=t,AE("endBefore","key",t,!0),new Wk(e,t))))}equalTo(e,t){return Dd("Query.equalTo",1,2,arguments.length),new _S(this.database,nS(this._delegate,(e=e,t=t,AE("equalTo","key",t,!0),new tS(e,t))))}toString(){return Dd("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Dd("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Dd("Query.isEqual",1,1,arguments.length),e instanceof _S)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Ld(e,"cancel",r.cancel,!0),r.context=n,Fd(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Md(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new wS(this.database,new Ck(this._delegate._repo,this._delegate._path))}}class wS extends _S{constructor(e,t){super(e,new Tk(t._repo,t._path,new gT,!1)),this.database=e,this._delegate=t}getKey(){return Dd("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Dd("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new wS(this.database,Rk(this._delegate,e))}getParent(){Dd("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new wS(this.database,e):null}getRoot(){return Dd("Reference.root",0,0,arguments.length),new wS(this.database,this._delegate.root)}set(e,t){Dd("Reference.set",1,2,arguments.length),Ld("Reference.set","onComplete",t,!0);const n=Pk(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Dd("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,fS("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}xE("Reference.update",this._delegate._path),Ld("Reference.update","onComplete",n,!0);const e=Ok(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Dd("Reference.setWithPriority",2,3,arguments.length),Ld("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(xE("setWithPriority",e._path),kE("setWithPriority",t,e._path,!1),CE("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new rd;return nk(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Dd("Reference.remove",0,1,arguments.length),Ld("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,xE("remove",n._path),Pk(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Dd("Reference.transaction",1,3,arguments.length),Ld("Reference.transaction","transactionUpdate",e,!1),Ld("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Md(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=pS(this._delegate,e,{applyLocally:n}).then(e=>new vS(e.committed,new yS(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Dd("Reference.setPriority",1,2,arguments.length),Ld("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=$d(e),xE("setPriority",e._path),CE("setPriority",t,!1);const n=new rd;return nk(e._repo,dI(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Dd("Reference.push",0,2,arguments.length),Ld("Reference.push","onComplete",t,!0);const n=function(e,t){e=$d(e),xE("push",e._path),kE("push",t,e._path,!0);var n=YE(e._repo),n=aT(n);const r=Rk(e,n),i=Rk(e,n);let s;return s=null!=t?Pk(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new wS(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new wS(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return xE("Reference.onDisconnect",this._delegate._path),new mS(new Ik(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class bS{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,n={}){cS(this._delegate,e,t,n)}ref(e){if(Dd("database.ref",0,1,arguments.length),e instanceof wS){var t=xk(this._delegate,e.toString());return new wS(this,t)}t=Nk(this._delegate,e);return new wS(this,t)}refFromURL(e){Dd("database.refFromURL",1,1,arguments.length);var t=xk(this._delegate,e);return new wS(this,t)}goOffline(){var e;Dd("database.goOffline",0,0,arguments.length),(e=$d(e=this._delegate))._checkNotDeleted("goOffline"),ok(e._repo)}goOnline(){return Dd("database.goOnline",0,0,arguments.length),lS(this._delegate)}}bS.ServerValue={TIMESTAMP:hS,increment:e=>({".sv":{increment:e}})};var IS,TS=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Yw(n);const o=new Gd("auth-internal",new Hd("database-standalone"));return o.setComponent(new zd("auth-internal",()=>r,"PRIVATE")),{instance:new bS(oS(e,o,void 0,t,s),e),namespace:i}}});const ES=bS.ServerValue;(IS=Cp).INTERNAL.registerComponent(new zd("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new bS(r,n)},"PUBLIC").setServiceProps({Reference:wS,Query:_S,Database:bS,DataSnapshot:yS,enableLogging:uS,INTERNAL:TS,ServerValue:ES}).setMultipleInstances(!0)),IS.registerVersion("@firebase/database-compat","0.1.5");var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},kS={},SS=l||self;function CS(){}function AS(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function NS(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var xS="closure_uid_"+(1e9*Math.random()>>>0),RS=0;function PS(e,t,n){return e.call.apply(e.bind,arguments)}function OS(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function DS(e,t,n){return(DS=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?PS:OS).apply(null,arguments)}function MS(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function LS(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function FS(){this.s=this.s,this.o=this.o}var US={};FS.prototype.s=!1,FS.prototype.na=function(){var e,t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,e=Object.prototype.hasOwnProperty.call(t,xS)&&t[xS]||(t[xS]=++RS),delete US[e])},FS.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const qS=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},jS=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){var r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function VS(){return Array.prototype.concat.apply([],arguments)}function BS(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function KS(e){return/^[\s\xa0]*$/.test(e)}var $S,zS=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function WS(e,t){return-1!=e.indexOf(t)}function GS(e,t){return e<t?-1:t<e?1:0}e:{var HS=SS.navigator;if(HS){HS=HS.userAgent;if(HS){$S=HS;break e}}$S=""}function QS(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function YS(e){const t={};for(const n in e)t[n]=e[n];return t}var JS="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function XS(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<JS.length;e++)n=JS[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ZS(e){return ZS[" "](e),e}ZS[" "]=CS;var eC,tC=WS($S,"Opera"),nC=WS($S,"Trident")||WS($S,"MSIE"),rC=WS($S,"Edge"),iC=rC||nC,sC=WS($S,"Gecko")&&!(WS($S.toLowerCase(),"webkit")&&!WS($S,"Edge"))&&!(WS($S,"Trident")||WS($S,"MSIE"))&&!WS($S,"Edge"),oC=WS($S.toLowerCase(),"webkit")&&!WS($S,"Edge");function aC(){var e=SS.document;return e?e.documentMode:void 0}e:{var cC="",lC=(lC=$S,sC?/rv:([^\);]+)(\)|;)/.exec(lC):rC?/Edge\/([\d\.]+)/.exec(lC):nC?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lC):oC?/WebKit\/(\S+)/.exec(lC):tC?/(?:Version)[ \/]?(\S+)/.exec(lC):void 0);if(lC&&(cC=lC?lC[1]:""),nC){lC=aC();if(null!=lC&&lC>parseFloat(cC)){eC=String(lC);break e}}eC=cC}var uC={};function hC(){return e=function(){let e=0;var t=zS(String(eC)).split("."),n=zS("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++)for(var i=t[o]||"",s=n[o]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=GS(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||GS(0==i[2].length,0==s[2].length)||GS(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e},t=uC,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var dC=SS.document&&nC&&(aC()||parseInt(eC,10))||void 0,pC=function(){if(!SS.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{SS.addEventListener("test",CS,t),SS.removeEventListener("test",CS,t)}catch(e){}return e}();function fC(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function gC(e,t){if(fC.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(sC){e:{try{ZS(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:mC[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&gC.Z.h.call(this)}}fC.prototype.h=function(){this.defaultPrevented=!0},LS(gC,fC);var mC={2:"touch",3:"pen",4:"mouse"};gC.prototype.h=function(){gC.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var vC="closure_listenable_"+(1e6*Math.random()|0),yC=0;function _C(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++yC,this.ca=this.fa=!1}function wC(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function bC(e){this.src=e,this.g={},this.h=0}function IC(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=qS(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(wC(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function TC(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}bC.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=TC(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new _C(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var EC="closure_lm_"+(1e6*Math.random()|0),kC={};function SC(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}r=OC(r);return t&&t[vC]?t.O(n,r,NS(i)?!!i.capture:!!i,s):CC(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)SC(e,t[s],n,r,i);return null}return n=OC(n),e&&e[vC]?e.N(t,n,NS(r)?!!r.capture:!!r,i):CC(e,t,n,!1,r,i)}function CC(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=NS(i)?!!i.capture:!!i,c=RC(e);if(c||(e[EC]=c=new bC(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=xC,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!pC?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(NC(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function AC(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[vC]?IC(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(NC(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=RC(t))?(IC(n,e),0==n.h&&(n.src=null,t[EC]=null)):wC(e)))}function NC(e){return e in kC?kC[e]:kC[e]="on"+e}function xC(e,t){var n,r;return e=!!e.ca||(t=new gC(t,this),n=e.listener,r=e.ia||e.src,e.fa&&AC(e),n.call(r,t))}function RC(e){return(e=e[EC])instanceof bC?e:null}var PC="__closure_events_fn_"+(1e9*Math.random()>>>0);function OC(t){return"function"==typeof t?t:(t[PC]||(t[PC]=function(e){return t.handleEvent(e)}),t[PC])}function DC(){FS.call(this),this.i=new bC(this),(this.P=this).I=null}function MC(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new fC(t,e):t instanceof fC?t.target=t.target||e:(o=t,XS(t=new fC(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=LC(s,r,!0,t)&&o;if(o=LC(s=t.g=e,r,!0,t)&&o,o=LC(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=LC(s=t.g=n[i],r,!1,t)&&o}function LC(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&IC(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}LS(DC,FS),DC.prototype[vC]=!0,DC.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=NS(i)?!!i.capture:!!i,r=OC(r),t&&t[vC]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=TC(o=t.g[n],r,i,s))&&(wC(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&RC(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?TC(n,r,i,s):t)?n[t]:null)&&AC(r))}(this,e,t,n,r)},DC.prototype.M=function(){if(DC.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)wC(n[r]);delete t.g[e],t.h--}}this.I=null},DC.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},DC.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var FC=SS.JSON.stringify;var UC,qC=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new jC,e=>e.reset());class jC{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function VC(e,t){var n;UC||(n=SS.Promise.resolve(void 0),UC=function(){n.then($C)}),BC||(UC(),BC=!0),KC.add(e,t)}var BC=!1,KC=new class{constructor(){this.h=this.g=null}add(e,t){const n=qC.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function $C(){for(var e;e=function(){var e=KC;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){SS.setTimeout(()=>{throw e},0)}(e)}var t=qC;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}BC=!1}function zC(e,t){DC.call(this),this.h=e||1,this.g=t||SS,this.j=DS(this.kb,this),this.l=Date.now()}function WC(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function GC(e,t,n){if("function"==typeof e)n&&(e=DS(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=DS(e.handleEvent,e)}return 2147483647<Number(t)?-1:SS.setTimeout(e,t||0)}LS(zC,DC),(We=zC.prototype).da=!1,We.S=null,We.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),MC(this,"tick"),this.da&&(WC(this),this.start())))},We.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},We.M=function(){zC.Z.M.call(this),WC(this),delete this.g};class HC extends FS{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=GC(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(SS.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function QC(e){FS.call(this),this.h=e,this.g={}}LS(QC,FS);var YC=[];function JC(e,t,n,r){Array.isArray(n)||(n&&(YC[0]=n.toString()),n=YC);for(var i=0;i<n.length;i++){var s=SC(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function XC(e){QS(e.g,function(e,t){this.g.hasOwnProperty(t)&&AC(e)},e),e.g={}}function ZC(){this.g=!0}function eA(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return FC(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}QC.prototype.M=function(){QC.Z.M.call(this),XC(this)},QC.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ZC.prototype.Aa=function(){this.g=!1},ZC.prototype.info=function(){};var tA={},nA=null;function rA(){return nA=nA||new DC}function iA(e){fC.call(this,tA.Ma,e)}function sA(){var e=rA();MC(e,new iA(e))}function oA(e,t){fC.call(this,tA.STAT_EVENT,e),this.stat=t}function aA(e){var t=rA();MC(t,new oA(t,e))}function cA(e,t){fC.call(this,tA.Na,e),this.size=t}function lA(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return SS.setTimeout(function(){e()},t)}tA.Ma="serverreachability",LS(iA,fC),tA.STAT_EVENT="statevent",LS(oA,fC),tA.Na="timingevent",LS(cA,fC);c={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},yt={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function uA(){}function hA(e){return e.h||(e.h=e.i())}function dA(){}uA.prototype.h=null;l={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function pA(){fC.call(this,"d")}function fA(){fC.call(this,"c")}function gA(){}function mA(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new QC(this),this.P=_A,this.W=new zC(e=iC?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new vA}function vA(){this.i=null,this.g="",this.h=!1}LS(pA,fC),LS(fA,fC),LS(gA,uA),gA.prototype.g=function(){return new XMLHttpRequest},gA.prototype.i=function(){return{}};var yA=new gA,_A=45e3,wA={},bA={};function IA(e,t,n){e.K=1,e.v=$A(UA(t)),e.s=n,e.U=!0,TA(e,null)}function TA(e,t){e.F=Date.now(),SA(e),e.A=UA(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),rN(n.h,"t",r),e.C=0,n=e.l.H,e.h=new vA,e.g=rx(e.l,n?t:null,!e.s),0<e.O&&(e.L=new HC(DS(e.Ia,e,e.g),e.O)),JC(e.V,e.g,"readystatechange",e.gb),t=e.H?YS(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),sA(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function EA(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function kA(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(o=n,c=a=void 0,a=(s=e).C,-1==(c=o.indexOf("\n",a))?bA:(a=Number(o.substring(a,c)),isNaN(a)?wA:(c+=1)+a>o.length?bA:(o=o.substr(c,a),s.C=c+a,o))),i==bA){4==t&&(e.o=4,aA(14),r=!1),eA(e.j,e.m,null,"[Incomplete Response]");break}if(i==wA){e.o=4,aA(15),eA(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}eA(e.j,e.m,i,null),RA(e,i)}var s,o,a,c;EA(e)&&i!=bA&&i!=wA&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,aA(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),QN(t),t.L=!0,aA(11))):(eA(e.j,e.m,n,"[Invalid Chunked Response]"),xA(e),NA(e))}function SA(e){e.Y=Date.now()+e.P,CA(e,e.P)}function CA(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=lA(DS(e.eb,e),t)}function AA(e){e.B&&(SS.clearTimeout(e.B),e.B=null)}function NA(e){0==e.l.G||e.I||XN(e.l,e)}function xA(e){AA(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,WC(e.W),XC(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function RA(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||uN(n.i,e)))if(n.I=e.N,!e.J&&uN(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;JN(n),jN(n)}HN(n),aA(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=lA(DS(n.ab,n),6e3));if(lN(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else ex(n,11)}else if(!e.J&&n.g!=e||JN(n),!KS(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.U=s[0],s=s[1],2==n.G)if("c"==s[0]){n.J=s[1],n.la=s[2];var o=s[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=s[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c,l,u,h=s[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;g&&(!(c=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(l=r.i).g&&(WS(c,"spdy")||WS(c,"quic")||WS(c,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(hN(l,l.h),l.h=null)),!r.D||(u=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=u,KA(r.F,r.D,u))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,p,f=e;(r=n).oa=nx(r,r.H?r.la:null,r.W),f.J?(dN(r.i,f),d=f,(p=r.K)&&d.setTimeout(p),d.B&&(AA(d),SA(d)),r.g=f):GN(r),0<n.l.length&&KN(n)}else"stop"!=s[0]&&"close"!=s[0]||ex(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?ex(n,7):qN(n):"noop"!=s[0]&&n.j&&n.j.wa(s),n.A=0)}sA()}catch(e){}}function PA(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(AS(e)||"string"==typeof e)jS(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(AS(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(AS(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function OA(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof OA)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function DA(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];MA(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)MA(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function MA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(We=mA.prototype).setTimeout=function(e){this.P=e},We.gb=function(e){e=e.target;const t=this.L;t&&3==DN(e)?t.l():this.Ia(e)},We.Ia=function(e){try{if(e==this.g)e:{var t=DN(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||iC||this.g&&(this.h.h||this.g.ga()||MN(this.g)))){this.I||4!=t||7==n||sA(),AA(this);var r=this.g.ba();this.N=r;t:if(EA(this)){var i=MN(this.g);e="";var s=i.length,o=4==DN(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){xA(this),NA(this);var a="";break t}this.h.i=new SS.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.X,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!KS(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,aA(12),xA(this),NA(this);break e}eA(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,RA(this,r)}this.U?(kA(this,t,a),iC&&this.i&&3==t&&(JC(this.V,this.W,"tick",this.fb),this.W.start())):(eA(this.j,this.m,a,null),RA(this,a)),4==t&&xA(this),this.i&&!this.I&&(4==t?XN(this.l,this):(this.i=!1,SA(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,aA(12)):(this.o=0,aA(13)),xA(this),NA(this)}}}catch(e){}var h,d,p,f,g,m,v},We.fb=function(){var e,t;this.g&&(e=DN(this.g),t=this.g.ga(),this.C<t.length&&(AA(this),kA(this,e,t),this.i&&4!=e&&SA(this)))},We.cancel=function(){this.I=!0,xA(this)},We.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(sA(),aA(17)),xA(this),this.o=2,NA(this)):CA(this,this.Y-n)},(We=OA.prototype).R=function(){DA(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},We.T=function(){return DA(this),this.g.concat()},We.get=function(e,t){return MA(this.h,e)?this.h[e]:t},We.set=function(e,t){MA(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},We.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var LA=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function FA(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof FA?(this.g=void 0!==t?t:e.g,qA(this,e.j),this.s=e.s,jA(this,e.i),VA(this,e.m),this.l=e.l,t=e.h,(n=new ZA).i=t.i,t.g&&(n.g=new OA(t.g),n.h=t.h),BA(this,n),this.o=e.o):e&&(n=String(e).match(LA))?(this.g=!!t,qA(this,n[1]||"",!0),this.s=zA(n[2]||""),jA(this,n[3]||"",!0),VA(this,n[4]),this.l=zA(n[5]||"",!0),BA(this,n[6]||"",!0),this.o=zA(n[7]||"")):(this.g=!!t,this.h=new ZA(null,this.g))}function UA(e){return new FA(e)}function qA(e,t,n){e.j=n?zA(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function jA(e,t,n){e.i=n?zA(t,!0):t}function VA(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function BA(e,t,n){var r,i;t instanceof ZA?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(eN(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tN(this,t),rN(this,n,e))},r)),r.j=i):(n||(t=WA(t,JA)),e.h=new ZA(t,e.g))}function KA(e,t,n){e.h.set(t,n)}function $A(e){return KA(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function zA(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function WA(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,GA),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function GA(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}FA.prototype.toString=function(){var e=[],t=this.j;t&&e.push(WA(t,HA,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(WA(t,HA,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(WA(n,"/"==n.charAt(0)?YA:QA,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",WA(n,XA)),e.join("")};var HA=/[#\/\?@]/g,QA=/[#\?:]/g,YA=/[#\?]/g,JA=/[#\?@]/g,XA=/#/g;function ZA(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function eN(n){n.g||(n.g=new OA,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function tN(e,t){eN(e),t=iN(e,t),MA(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,MA((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&DA(e)))}function nN(e,t){return eN(e),t=iN(e,t),MA(e.g.h,t)}function rN(e,t,n){tN(e,t),0<n.length&&(e.i=null,e.g.set(iN(e,t),BS(n)),e.h+=n.length)}function iN(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(We=ZA.prototype).add=function(e,t){eN(this),this.i=null,e=iN(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},We.forEach=function(n,r){eN(this),this.g.forEach(function(e,t){jS(e,function(e){n.call(r,e,t,this)},this)},this)},We.T=function(){eN(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},We.R=function(e){eN(this);var t=[];if("string"==typeof e)nN(this,e)&&(t=VS(t,this.g.get(iN(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=VS(t,e[n])}return t},We.set=function(e,t){return eN(this),this.i=null,nN(this,e=iN(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},We.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},We.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var sN=class{constructor(e,t){this.h=e,this.g=t}};function oN(e){this.l=e||10,e=SS.PerformanceNavigationTiming?0<(e=SS.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(SS.g&&SS.g.Ea&&SS.g.Ea()&&SS.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var aN;function cN(e){return e.h||e.g&&e.g.size>=e.j}function lN(e){return e.h?1:e.g?e.g.size:0}function uN(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function hN(e,t){e.g?e.g.add(t):e.h=t}function dN(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function pN(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return BS(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function fN(){}function gN(){this.g=new fN}function mN(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function vN(e){this.l=e.$b||null,this.j=e.ib||!1}function yN(e,t){DC.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=_N,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}oN.prototype.cancel=function(){if(this.i=pN(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fN.prototype.stringify=function(e){return SS.JSON.stringify(e,void 0)},fN.prototype.parse=function(e){return SS.JSON.parse(e,void 0)},LS(vN,uA),vN.prototype.g=function(){return new yN(this.l,this.j)},vN.prototype.i=(aN={},function(){return aN}),LS(yN,DC);var _N=0;function wN(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function bN(e){e.readyState=4,e.l=null,e.j=null,e.A=null,IN(e)}function IN(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(We=yN.prototype).open=function(e,t){if(this.readyState!=_N)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,IN(this)},We.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||SS).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},We.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bN(this)),this.readyState=_N},We.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,IN(this)),this.g&&(this.readyState=3,IN(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==SS.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;wN(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},We.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?bN:IN)(this),3==this.readyState&&wN(this))},We.Ua=function(e){this.g&&(this.response=this.responseText=e,bN(this))},We.Ta=function(e){this.g&&(this.response=e,bN(this))},We.ha=function(){this.g&&bN(this)},We.setRequestHeader=function(e,t){this.v.append(e,t)},We.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},We.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(yN.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var TN=SS.JSON.parse;function EN(e){DC.call(this),this.headers=new OA,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=kN,this.K=this.L=!1}LS(EN,DC);var kN="",SN=/^https?$/i,CN=["POST","PUT"];function AN(e){return"content-type"==e.toLowerCase()}function NN(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,xN(e),PN(e)}function xN(e){e.D||(e.D=!0,MC(e,"complete"),MC(e,"error"))}function RN(e){if(e.h&&void 0!==kS&&(!e.C[1]||4!=DN(e)||2!=e.ba()))if(e.v&&4==DN(e))GC(e.Fa,0,e);else if(MC(e,"readystatechange"),4==DN(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(LA)[1]||null)&&SS.self&&SS.self.location&&(i=(r=SS.self.location.protocol).substr(0,r.length-1)),n=!SN.test(i?i.toLowerCase():"")),t=n),t)MC(e,"complete"),MC(e,"success");else{e.m=6;try{var a=2<DN(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",xN(e)}}finally{PN(e)}}}function PN(e,t){if(e.g){ON(e);const n=e.g,r=e.C[0]?CS:null;e.g=null,e.C=null,t||MC(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ON(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(SS.clearTimeout(e.A),e.A=null)}function DN(e){return e.g?e.g.readyState:0}function MN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case kN:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function LN(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let n="";return QS(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):KA(e,t,n))}function FN(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function UN(e){this.za=0,this.l=[],this.h=new ZC,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=FN("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=FN("baseRetryDelayMs",5e3,e),this.$a=FN("retryDelaySeedMs",1e4,e),this.Ya=FN("forwardChannelMaxRetries",2,e),this.ra=FN("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new oN(e&&e.concurrentRequestLimit),this.Ca=new gN,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function qN(e){var t,n;VN(e),3==e.G&&(t=e.V++,KA(n=UA(e.F),"SID",e.J),KA(n,"RID",t),KA(n,"TYPE","terminate"),zN(e,n),(t=new mA(e,e.h,t,void 0)).K=2,t.v=$A(UA(n)),n=!1,!(n=SS.navigator&&SS.navigator.sendBeacon?SS.navigator.sendBeacon(t.v.toString(),""):n)&&SS.Image&&((new Image).src=t.v,n=!0),n||(t.g=rx(t.l,null),t.g.ea(t.v)),t.F=Date.now(),SA(t)),tx(e)}function jN(e){e.g&&(QN(e),e.g.cancel(),e.g=null)}function VN(e){jN(e),e.u&&(SS.clearTimeout(e.u),e.u=null),JN(e),e.i.cancel(),e.m&&("number"==typeof e.m&&SS.clearTimeout(e.m),e.m=null)}function BN(e,t){e.l.push(new sN(e.Za++,t)),3==e.G&&KN(e)}function KN(e){cN(e.i)||e.m||(e.m=!0,VC(e.Ha,e),e.C=0)}function $N(e,t){var n=t?t.m:e.V++,r=UA(e.F);KA(r,"SID",e.J),KA(r,"RID",n),KA(r,"AID",e.U),zN(e,r),e.o&&e.s&&LN(r,e.o,e.s),n=new mA(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=WN(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hN(e.i,n),IA(n,r,t)}function zN(e,n){e.j&&PA({},function(e,t){KA(n,t,e)})}function WN(e,t,r){r=Math.min(e.l.length,r);var i=e.j?DS(e.j.Oa,e.j,e):null;e:{var s=e.l;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var o=s[t].h,a=s[t].g;if((o-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{PA(e,function(e,t){let n=e;NS(e)&&(n=FC(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(a,c,"req"+o+"_")}catch(e){i&&i(a)}}if(e){i=c.join("&");break e}}}return e=e.l.splice(0,r),t.D=e,i}function GN(e){e.g||e.u||(e.Y=1,VC(e.Ga,e),e.A=0)}function HN(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=lA(DS(e.Ga,e),ZN(e,e.A)),e.A++,1)}function QN(e){null!=e.B&&(SS.clearTimeout(e.B),e.B=null)}function YN(e){e.g=new mA(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=UA(e.oa);KA(t,"RID","rpc"),KA(t,"SID",e.J),KA(t,"CI",e.N?"0":"1"),KA(t,"AID",e.U),zN(e,t),KA(t,"TYPE","xmlhttp"),e.o&&e.s&&LN(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=$A(UA(t)),n.s=null,n.U=!0,TA(n,e)}function JN(e){null!=e.v&&(SS.clearTimeout(e.v),e.v=null)}function XN(e,t){var n,r,i,s=null;if(e.g==t){JN(e),QN(e),e.g=null;var o=2}else{if(!uN(e.i,t))return;s=t.D,dN(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,MC(o=rA(),new cA(o,s)),KN(e)):GN(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,lN((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=lA(DS(r.Ha,r,i),ZN(r,r.C)),r.C++,0))))&&(2!=o||!HN(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:ex(e,5);break;case 4:ex(e,10);break;case 3:ex(e,6);break;default:ex(e,2)}}function ZN(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function ex(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=DS(e.jb,e),n||(n=new FA("//www.google.com/images/cleardot.gif"),SS.location&&"http"==SS.location.protocol||qA(n,"https"),$A(n)),function(e,t){var n=new ZC;if(SS.Image){const r=new Image;r.onload=MS(mN,n,r,"TestLoadImage: loaded",!0,t),r.onerror=MS(mN,n,r,"TestLoadImage: error",!1,t),r.onabort=MS(mN,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=MS(mN,n,r,"TestLoadImage: timeout",!1,t),SS.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):aA(2),e.G=0,e.j&&e.j.va(t),tx(e),VN(e)}function tx(e){e.G=0,e.I=-1,e.j&&(0==pN(e.i).length&&0==e.l.length||(e.i.i.length=0,BS(e.l),e.l.length=0),e.j.ua())}function nx(e,t,n){let r=(a=n)instanceof FA?UA(a):new FA(a,void 0);var i,s,o,a,c;return""!=r.i?(t&&jA(r,t+"."+r.i),VA(r,r.m)):(c=SS.location,r=(i=c.protocol,s=t?t+"."+c.hostname:c.hostname,o=+c.port,a=n,c=new FA(null,void 0),i&&qA(c,i),s&&jA(c,s),o&&VA(c,o),a&&(c.l=a),c)),e.aa&&QS(e.aa,function(e,t){KA(r,t,e)}),t=e.D,n=e.sa,t&&n&&KA(r,t,n),KA(r,"VER",e.ma),zN(e,r),r}function rx(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new EN(new vN({ib:!0})):new EN(e.qa)).L=e.H,t}function ix(){}function sx(){if(nC&&!(10<=Number(dC)))throw Error("Environmental error: no available transport.")}function ox(e,t){DC.call(this),this.g=new UN(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!KS(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!KS(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new lx(this)}function ax(e){pA.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function cx(){fA.call(this),this.status=1}function lx(e){this.g=e}(We=EN.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||yA).g(),this.C=this.u?hA(this.u):hA(yA),this.g.onreadystatechange=DS(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void NN(this,e)}e=n||"";const i=new OA(this.headers);r&&PA(r,function(e,t){i.set(t,e)}),r=function(t){e:{var n=AN,r=t.length,i="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in i&&n.call(void 0,i[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(i.T()),n=SS.FormData&&e instanceof SS.FormData,0<=qS(CN,t)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ON(this),0<this.B&&((this.K=(s=this.g,nC&&hC()&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=DS(this.pa,this)):this.A=GC(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){NN(this,e)}var s},We.pa=function(){void 0!==kS&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,MC(this,"timeout"),this.abort(8))},We.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,MC(this,"complete"),MC(this,"abort"),PN(this))},We.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),PN(this,!0)),EN.Z.M.call(this)},We.Fa=function(){this.s||(this.F||this.v||this.l?RN(this):this.cb())},We.cb=function(){RN(this)},We.ba=function(){try{return 2<DN(this)?this.g.status:-1}catch(e){return-1}},We.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},We.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),TN(t)}},We.Da=function(){return this.m},We.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(We=UN.prototype).ma=8,We.G=1,We.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},We.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new mA(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=YS(e),XS(e,this.P)):e=this.P),null===this.o&&(s.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var i=this.l[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=WN(this,s,n),KA(r=UA(this.F),"RID",t),KA(r,"CVER",22),this.D&&KA(r,"X-HTTP-Session-Id",this.D),zN(this,r),this.o&&e&&LN(r,this.o,e),hN(this.i,s),this.Ra&&KA(r,"TYPE","init"),this.ja?(KA(r,"$req",n),KA(r,"SID","null"),s.$=!0,IA(s,r,null)):IA(s,r,n),this.G=2}}else 3==this.G&&(t?$N(this,t):0==this.l.length||cN(this.i)||$N(this))},We.Ga=function(){var e;this.u=null,YN(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=lA(DS(this.bb,this),e))},We.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,aA(10),jN(this),YN(this))},We.ab=function(){null!=this.v&&(this.v=null,jN(this),HN(this),aA(19))},We.jb=function(e){e?(this.h.info("Successfully pinged google.com"),aA(2)):(this.h.info("Failed to ping google.com"),aA(1))},(We=ix.prototype).xa=function(){},We.wa=function(){},We.va=function(){},We.ua=function(){},We.Oa=function(){},sx.prototype.g=function(e,t){return new ox(e,t)},LS(ox,DC),ox.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),VC(DS(e.hb,e,t))),aA(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=nx(e,null,e.W),KN(e)},ox.prototype.close=function(){qN(this.g)},ox.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,BN(this.g,t)):this.v?((t={}).__data__=FC(e),BN(this.g,t)):BN(this.g,e)},ox.prototype.M=function(){this.g.j=null,delete this.j,qN(this.g),delete this.g,ox.Z.M.call(this)},LS(ax,pA),LS(cx,fA),LS(lx,ix),lx.prototype.xa=function(){MC(this.g,"a")},lx.prototype.wa=function(e){MC(this.g,new ax(e))},lx.prototype.va=function(e){MC(this.g,new cx)},lx.prototype.ua=function(){MC(this.g,"b")},sx.prototype.createWebChannel=sx.prototype.g,ox.prototype.send=ox.prototype.u,ox.prototype.open=ox.prototype.m,c.NO_ERROR=0,c.TIMEOUT=8,c.HTTP_ERROR=6,yt.COMPLETE="complete",(dA.EventType=l).OPEN="a",l.CLOSE="b",l.ERROR="c",l.MESSAGE="d",DC.prototype.listen=DC.prototype.N,EN.prototype.listenOnce=EN.prototype.O,EN.prototype.getLastError=EN.prototype.La,EN.prototype.getLastErrorCode=EN.prototype.Da,EN.prototype.getStatus=EN.prototype.ba,EN.prototype.getResponseJson=EN.prototype.Qa,EN.prototype.getResponseText=EN.prototype.ga,EN.prototype.send=EN.prototype.ea;var ux,hx=rA,dx=c,px=yt,fx=tA,gx=10,mx=11,vx=vN,yx=dA,_x=EN;const wx="@firebase/firestore";class bx{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bx.UNAUTHENTICATED=new bx(null),bx.GOOGLE_CREDENTIALS=new bx("google-credentials-uid"),bx.FIRST_PARTY=new bx("first-party-uid"),bx.MOCK_USER=new bx("mock-user");let Ix="9.6.7";const Tx=new ep("@firebase/firestore");function Ex(){return Tx.logLevel}function kx(e,...t){var n;Tx.logLevel<=$h.DEBUG&&(n=t.map(Ax),Tx.debug(`Firestore (${Ix}): ${e}`,...n))}function Sx(e,...t){var n;Tx.logLevel<=$h.ERROR&&(n=t.map(Ax),Tx.error(`Firestore (${Ix}): ${e}`,...n))}function Cx(e,...t){var n;Tx.logLevel<=$h.WARN&&(n=t.map(Ax),Tx.warn(`Firestore (${Ix}): ${e}`,...n))}function Ax(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Nx(e="Unexpected state"){var t=`FIRESTORE (${Ix}) INTERNAL ASSERTION FAILED: `+e;throw Sx(t),new Error(t)}function xx(e){e||Nx()}const Rx={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Px extends gd{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ox{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dx{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Mx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(bx.UNAUTHENTICATED))}shutdown(){}}class Lx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Fx{constructor(e){this.t=e,this.currentUser=bx.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new Ox;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ox,t.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},a=e=>{kx("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(kx("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ox))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(kx("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xx("string"==typeof e.accessToken),new Dx(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return xx(null===e||"string"==typeof e),new bx(e)}}class Ux{constructor(e,t,n){this.type="FirstParty",this.user=bx.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);var r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class qx{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Ux(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(bx.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class jx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Vx{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,n){const r=e=>{null!=e.error&&kx("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.p;return this.p=e.token,kx("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{kx("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.g.getImmediate({optional:!0}))?i(e):kx("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(xx("string"==typeof e.token),this.p=e.token,new jx(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Bx{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.T&&this.T(e),e}}Bx.A=-1;class Kx{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function $x(e,t){return e<t?-1:t<e?1:0}function zx(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Wx(e){return e+"\0"}class Gx{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Px(Rx.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Px(Rx.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Px(Rx.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Px(Rx.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Gx.fromMillis(Date.now())}static fromDate(e){return Gx.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Gx(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$x(this.nanoseconds,e.nanoseconds):$x(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Hx{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Hx(e)}static min(){return new Hx(new Gx(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Qx(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Yx(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Jx(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Xx{constructor(e,t,n){void 0===t?t=0:t>e.length&&Nx(),void 0===n?n=e.length-t:n>e.length-t&&Nx(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Xx.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xx?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Zx extends Xx{construct(e,t,n){return new Zx(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new Px(Rx.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Zx(t)}static emptyPath(){return new Zx([])}}const eR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tR extends Xx{construct(e,t,n){return new tR(e,t,n)}static isValidIdentifier(e){return eR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!tR.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new tR(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new Px(Rx.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Px(Rx.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Px(Rx.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new Px(Rx.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tR(t)}static emptyPath(){return new tR([])}}class nR{constructor(e){(this.fields=e).sort(tR.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zx(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class rR{constructor(e){this.binaryString=e}static fromBase64String(e){var t=atob(e);return new rR(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new rR(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $x(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rR.EMPTY_BYTE_STRING=new rR("");const iR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sR(t){if(xx(!!t),"string"!=typeof t)return{seconds:oR(t.seconds),nanos:oR(t.nanos)};{let e=0;var n=iR.exec(t);xx(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function oR(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function aR(e){return"string"==typeof e?rR.fromBase64String(e):rR.fromUint8Array(e)}function cR(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function lR(e){var t=sR(e.mapValue.fields.__local_write_time__.timestampValue);return new Gx(t.seconds,t.nanos)}class uR{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class hR{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new hR("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof hR&&e.projectId===this.projectId&&e.database===this.database}}function dR(e){return null==e}function pR(e){return 0===e&&1/e==-1/0}function fR(e){return"number"==typeof e&&Number.isInteger(e)&&!pR(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class gR{constructor(e){this.path=e}static fromPath(e){return new gR(Zx.fromString(e))}static fromName(e){return new gR(Zx.fromString(e).popFirst(5))}static empty(){return new gR(Zx.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Zx.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Zx.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new gR(new Zx(e.slice()))}}const mR={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function vR(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?cR(e)?4:10:Nx()}function yR(r,i){if(r===i)return!0;var e,t,n=vR(r);if(n!==vR(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return lR(r).isEqual(lR(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=sR(r.timestampValue),n=sR(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,aR(r.bytesValue).isEqual(aR(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,oR((t=r).geoPointValue.latitude)===oR(e.geoPointValue.latitude)&&oR(t.geoPointValue.longitude)===oR(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return oR(e.integerValue)===oR(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=oR(e.doubleValue),r=oR(t.doubleValue);return n===r?pR(n)===pR(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return zx(r.arrayValue.values||[],i.arrayValue.values||[],yR);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(Qx(t)!==Qx(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!yR(t[e],n[e])))return!1;return!0}(r);default:return Nx()}}function _R(e,t){return void 0!==(e.values||[]).find(e=>yR(e,t))}function wR(e,t){if(e===t)return 0;var n,r,i,s,o=vR(e),a=vR(t);if(o!==a)return $x(o,a);switch(o){case 0:return 0;case 1:return $x(e.booleanValue,t.booleanValue);case 2:return r=t,i=oR(e.integerValue||e.doubleValue),s=oR(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return bR(e.timestampValue,t.timestampValue);case 4:return bR(lR(e),lR(t));case 5:return $x(e.stringValue,t.stringValue);case 6:return function(e,t){const n=aR(e),r=aR(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=$x(n[i],r[i]);if(0!==t)return t}return $x(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=$x(oR(n.latitude),oR(r.latitude)))?s:$x(oR(n.longitude),oR(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=wR(n[i],r[i]);if(t)return t}return $x(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){const t=$x(r[a],s[a]);if(0!==t)return t;var o=wR(n[r[a]],i[s[a]]);if(0!==o)return o}return $x(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Nx()}}function bR(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return $x(e,t);var n=sR(e),r=sR(t),i=$x(n.seconds,r.seconds);return 0!==i?i:$x(n.nanos,r.nanos)}function IR(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=sR(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?aR(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,gR.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):Nx();var t}(e)}function TR(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ER(e){return e&&"integerValue"in e}function kR(e){return!!e&&"arrayValue"in e}function SR(e){return e&&"nullValue"in e}function CR(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function AR(e){return e&&"mapValue"in e}function NR(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Yx(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=NR(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=NR(t.arrayValue.values[e]);return r}return Object.assign({},t)}class xR{constructor(e){this.value=e}static empty(){return new xR({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!AR(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=NR(t)}setAll(e){let n=tR.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=NR(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());AR(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yR(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];AR(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){Yx(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new xR(NR(this.value))}}class RR{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new RR(e,0,Hx.min(),Hx.min(),xR.empty(),0)}static newFoundDocument(e,t,n){return new RR(e,1,t,Hx.min(),n,0)}static newNoDocument(e,t){return new RR(e,2,t,Hx.min(),xR.empty(),0)}static newUnknownDocument(e,t){return new RR(e,3,t,Hx.min(),xR.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xR.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xR.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof RR&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new RR(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class PR{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}PR.UNKNOWN_ID=-1;class OR{constructor(e,t){this.fieldPath=e,this.kind=t}}class DR{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new DR(0,MR.min())}}class MR{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new MR(Hx.min(),gR.empty(),-1)}}class LR{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.P=null}}function FR(e,t=null,n=[],r=[],i=null,s=null,o=null){return new LR(e,t,n,r,i,s,o)}function UR(e){const t=e;if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(t=e).field.canonicalString()+t.op.toString()+IR(t.value);var t}).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),dR(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>IR(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>IR(e)).join(",")),t.P=e}return t.P}function qR(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let o=0;o<e.orderBy.length;o++)if(n=e.orderBy[o],r=t.orderBy[o],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r,i,s;if(e.filters.length!==t.filters.length)return!1;for(let a=0;a<e.filters.length;a++)if(i=e.filters[a],s=t.filters[a],i.op!==s.op||!i.field.isEqual(s.field)||!yR(i.value,s.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ZR(e.startAt,t.startAt)&&ZR(e.endAt,t.endAt)}function jR(e){return gR.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class VR extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.v(e,t,n):new BR(e,t,n):"array-contains"===t?new WR(e,n):"in"===t?new GR(e,n):"not-in"===t?new HR(e,n):"array-contains-any"===t?new QR(e,n):new VR(e,t,n)}static v(e,t,n){return new("in"===t?KR:$R)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.V(wR(t,this.value)):null!==t&&vR(this.value)===vR(t)&&this.V(wR(t,this.value))}V(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Nx()}}S(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class BR extends VR{constructor(e,t,n){super(e,t,n),this.key=gR.fromName(n.referenceValue)}matches(e){var t=gR.comparator(e.key,this.key);return this.V(t)}}class KR extends VR{constructor(e,t){super(e,"in",t),this.keys=zR(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class $R extends VR{constructor(e,t){super(e,"not-in",t),this.keys=zR(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function zR(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>gR.fromName(e.referenceValue))}class WR extends VR{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return kR(t)&&_R(t.arrayValue,this.value)}}class GR extends VR{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&_R(this.value.arrayValue,t)}}class HR extends VR{constructor(e,t){super(e,"not-in",t)}matches(e){if(_R(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!_R(this.value.arrayValue,t)}}class QR extends VR{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!kR(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>_R(this.value.arrayValue,e))}}class YR{constructor(e,t){this.position=e,this.inclusive=t}}class JR{constructor(e,t="asc"){this.field=e,this.dir=t}}function XR(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?gR.comparator(gR.fromName(o.referenceValue),n.key):wR(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ZR(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!yR(e.position[n],t.position[n]))return!1;return!0}class eP{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function tP(e,t,n,r,i,s,o,a){return new eP(e,t,n,r,i,s,o,a)}function nP(e){return new eP(e)}function rP(e){return!dR(e.limit)&&"F"===e.limitType}function iP(e){return!dR(e.limit)&&"L"===e.limitType}function sP(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function oP(e){for(const t of e.filters)if(t.S())return t.field;return null}function aP(e){return null!==e.collectionGroup}function cP(t){const n=t;if(null===n.D){n.D=[];const t=oP(n),e=sP(n);if(null!==t&&null===e)t.isKeyField()||n.D.push(new JR(t)),n.D.push(new JR(tR.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.D.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.D.push(new JR(tR.keyField(),t))}}}return n.D}function lP(e){const t=e;if(!t.C)if("F"===t.limitType)t.C=FR(t.path,t.collectionGroup,cP(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of cP(t)){const t="desc"===i.dir?"asc":"desc";e.push(new JR(i.field,t))}var n=t.endAt?new YR(t.endAt.position,!t.endAt.inclusive):null,r=t.startAt?new YR(t.startAt.position,!t.startAt.inclusive):null;t.C=FR(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.C}function uP(e,t,n){return new eP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function hP(e,t){return qR(lP(e),lP(t))&&e.limitType===t.limitType}function dP(e){return`${UR(lP(e))}|lt:${e.limitType}`}function pP(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${IR(t.value)}`;var t}).join(", ")}]`),dR(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>IR(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>IR(e)).join(",")),`Target(${t})`}(lP(e))}; limitType=${e.limitType})`}function fP(n,e){return e.isFoundDocument()&&(i=n,o=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):gR.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=XR(t,cP(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=XR(t,cP(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,o}function gP(i){return(e,t)=>{let n=!1;for(const r of cP(i)){const i=function(e,i,t){var n=e.field.isKeyField()?gR.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?wR(n,r):Nx()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Nx()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function mP(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pR(t)?"-0":t}}function vP(e){return{integerValue:""+e}}function yP(e,t){return fR(t)?vP(t):mP(e,t)}class _P{constructor(){this._=void 0}}function wP(e,t){return e instanceof SP?ER(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class bP extends _P{}class IP extends _P{constructor(e){super(),this.elements=e}}function TP(e,t){const n=AP(t);for(const t of e.elements)n.some(e=>yR(e,t))||n.push(t);return{arrayValue:{values:n}}}class EP extends _P{constructor(e){super(),this.elements=e}}function kP(e,t){let n=AP(t);for(const t of e.elements)n=n.filter(e=>!yR(e,t));return{arrayValue:{values:n}}}class SP extends _P{constructor(e,t){super(),this.O=e,this.k=t}}function CP(e){return oR(e.integerValue||e.doubleValue)}function AP(e){return kR(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class NP{constructor(e,t){this.field=e,this.transform=t}}class xP{constructor(e,t){this.version=e,this.transformResults=t}}class RP{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new RP}static exists(e){return new RP(void 0,e)}static updateTime(e){return new RP(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function PP(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class OP{}function DP(e,t,n){e instanceof UP?function(e,t,n){const r=e.value.clone(),i=VP(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qP?function(e,t,n){if(!PP(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=VP(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(jP(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function MP(e,t,n){e instanceof UP?function(e,t,n){if(PP(e.precondition,t)){const r=e.value.clone(),i=BP(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(FP(t),r).setHasLocalMutations()}}(e,t,n):e instanceof qP?function(e,t,n){if(PP(e.precondition,t)){const r=BP(e.fieldTransforms,n,t),i=t.data;i.setAll(jP(e)),i.setAll(r),t.convertToFoundDocument(FP(t),i).setHasLocalMutations()}}(e,t,n):(t=t,PP(e.precondition,t)&&t.convertToNoDocument(Hx.min()))}function LP(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&zx(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof IP&&t instanceof IP||e instanceof EP&&t instanceof EP?zx(e.elements,t.elements,yR):e instanceof SP&&t instanceof SP?yR(e.k,t.k):e instanceof bP&&t instanceof bP)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function FP(e){return e.isFoundDocument()?e.version:Hx.min()}class UP extends OP{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class qP extends OP{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function jP(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function VP(e,t,n){const r=new Map;xx(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,o=t.data.field(i.field);r.set(i.field,(a=s,c=o,l=n[u],a instanceof IP?TP(a,c):a instanceof EP?kP(a,c):l))}var a,c,l;return r}function BP(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,c=a=void 0,i instanceof bP?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof IP?TP(i,s):i instanceof EP?kP(i,s):(a=wP(i=i,s),c=CP(a)+CP(i.k),ER(a)&&ER(i.k)?vP(c):mP(i.O,c))))}var i,s,o,a,c;return r}class KP extends OP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class $P extends OP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class zP{constructor(e){this.count=e}}function WP(e){switch(e){default:return Nx(),0;case Rx.CANCELLED:case Rx.UNKNOWN:case Rx.DEADLINE_EXCEEDED:case Rx.RESOURCE_EXHAUSTED:case Rx.INTERNAL:case Rx.UNAVAILABLE:case Rx.UNAUTHENTICATED:return;case Rx.INVALID_ARGUMENT:case Rx.NOT_FOUND:case Rx.ALREADY_EXISTS:case Rx.PERMISSION_DENIED:case Rx.FAILED_PRECONDITION:case Rx.ABORTED:case Rx.OUT_OF_RANGE:case Rx.UNIMPLEMENTED:case Rx.DATA_LOSS:return 1}}function GP(e){if(void 0===e)return Sx("GRPC error has no .code"),Rx.UNKNOWN;switch(e){case ux.OK:return Rx.OK;case ux.CANCELLED:return Rx.CANCELLED;case ux.UNKNOWN:return Rx.UNKNOWN;case ux.DEADLINE_EXCEEDED:return Rx.DEADLINE_EXCEEDED;case ux.RESOURCE_EXHAUSTED:return Rx.RESOURCE_EXHAUSTED;case ux.INTERNAL:return Rx.INTERNAL;case ux.UNAVAILABLE:return Rx.UNAVAILABLE;case ux.UNAUTHENTICATED:return Rx.UNAUTHENTICATED;case ux.INVALID_ARGUMENT:return Rx.INVALID_ARGUMENT;case ux.NOT_FOUND:return Rx.NOT_FOUND;case ux.ALREADY_EXISTS:return Rx.ALREADY_EXISTS;case ux.PERMISSION_DENIED:return Rx.PERMISSION_DENIED;case ux.FAILED_PRECONDITION:return Rx.FAILED_PRECONDITION;case ux.ABORTED:return Rx.ABORTED;case ux.OUT_OF_RANGE:return Rx.OUT_OF_RANGE;case ux.UNIMPLEMENTED:return Rx.UNIMPLEMENTED;case ux.DATA_LOSS:return Rx.DATA_LOSS;default:return Nx()}}(c=ux=ux||{})[c.OK=0]="OK",c[c.CANCELLED=1]="CANCELLED",c[c.UNKNOWN=2]="UNKNOWN",c[c.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",c[c.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",c[c.NOT_FOUND=5]="NOT_FOUND",c[c.ALREADY_EXISTS=6]="ALREADY_EXISTS",c[c.PERMISSION_DENIED=7]="PERMISSION_DENIED",c[c.UNAUTHENTICATED=16]="UNAUTHENTICATED",c[c.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",c[c.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",c[c.ABORTED=10]="ABORTED",c[c.OUT_OF_RANGE=11]="OUT_OF_RANGE",c[c.UNIMPLEMENTED=12]="UNIMPLEMENTED",c[c.INTERNAL=13]="INTERNAL",c[c.UNAVAILABLE=14]="UNAVAILABLE",c[c.DATA_LOSS=15]="DATA_LOSS";class HP{constructor(e,t){this.comparator=e,this.root=t||YP.EMPTY}insert(e,t){return new HP(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,YP.BLACK,null,null))}remove(e){return new HP(this.comparator,this.root.remove(e,this.comparator).copy(null,null,YP.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new QP(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new QP(this.root,e,this.comparator,!1)}getReverseIterator(){return new QP(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new QP(this.root,e,this.comparator,!0)}}class QP{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class YP{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:YP.RED,this.left=null!=r?r:YP.EMPTY,this.right=null!=i?i:YP.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new YP(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return YP.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return YP.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,YP.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,YP.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Nx();if(this.right.isRed())throw Nx();var e=this.left.check();if(e!==this.right.check())throw Nx();return e+(this.isRed()?0:1)}}YP.EMPTY=null,YP.RED=!0,YP.BLACK=!1,YP.EMPTY=new class{constructor(){this.size=0}get key(){throw Nx()}get value(){throw Nx()}get color(){throw Nx()}get left(){throw Nx()}get right(){throw Nx()}copy(e,t,n,r,i){return this}insert(e,t,n){return new YP(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class JP{constructor(e){this.comparator=e,this.data=new HP(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new XP(this.data.getIterator())}getIteratorFrom(e){return new XP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof JP))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new JP(this.comparator);return t.data=e,t}}class XP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ZP(e){return e.hasNext()?e.getNext():void 0}const eO=new HP(gR.comparator);const tO=new HP(gR.comparator);const nO=new HP(gR.comparator),rO=new JP(gR.comparator);function iO(...e){let t=rO;for(const n of e)t=t.add(n);return t}const sO=new JP($x);class oO{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,aO.createSynthesizedTargetChangeForCurrentChange(e,t)),new oO(Hx.min(),n,sO,eO,iO())}}class aO{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new aO(rR.EMPTY_BYTE_STRING,t,iO(),iO(),iO())}}class cO{constructor(e,t,n,r){this.M=e,this.removedTargetIds=t,this.key=n,this.$=r}}class lO{constructor(e,t){this.targetId=e,this.F=t}}class uO{constructor(e,t,n=rR.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class hO{constructor(){this.B=0,this.L=fO(),this.U=rR.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){0<e.approximateByteSize()&&(this.K=!0,this.U=e)}H(){let n=iO(),r=iO(),i=iO();return this.L.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Nx()}}),new aO(this.U,this.q,n,r,i)}J(){this.K=!1,this.L=fO()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){--this.B}et(){this.K=!0,this.q=!0}}class dO{constructor(e){this.nt=e,this.st=new Map,this.it=eO,this.rt=pO(),this.ot=new JP($x)}ct(e){for(const t of e.M)e.$&&e.$.isFoundDocument()?this.ut(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ht(n){this.forEachTarget(n,e=>{const t=this.lt(e);switch(n.state){case 0:this.ft(e)&&t.W(n.resumeToken);break;case 1:t.tt(),t.G||t.J(),t.W(n.resumeToken);break;case 2:t.tt(),t.G||this.removeTarget(e);break;case 3:this.ft(e)&&(t.et(),t.W(n.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),t.W(n.resumeToken));break;default:Nx()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.st.forEach((e,t)=>{this.ft(t)&&n(t)})}_t(e){const t=e.targetId,n=e.F.count,r=this.wt(t);if(r){const e=r.target;if(jR(e))if(0===n){const n=new gR(e.path);this.at(t,n,RR.newNoDocument(n,Hx.min()))}else xx(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(r){const i=new Map;this.st.forEach((e,t)=>{var n=this.wt(t);if(n){if(e.current&&jR(n.target)){const i=new gR(n.target.path);null!==this.it.get(i)||this.It(t,i)||this.at(t,i,RR.newNoDocument(i,r))}e.j&&(i.set(t,e.H()),e.J())}});let s=iO();this.rt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.wt(e);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.it.forEach((e,t)=>t.setReadTime(r));var e=new oO(r,i,this.ot,this.it,s);return this.it=eO,this.rt=pO(),this.ot=new JP($x),e}ut(e,t){var n;this.ft(e)&&(n=this.It(e,t.key)?2:0,this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e)))}at(e,t,n){if(this.ft(e)){const r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),n&&(this.it=this.it.insert(t,n))}}removeTarget(e){this.st.delete(e)}gt(e){var t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new hO,this.st.set(e,t)),t}Et(e){let t=this.rt.get(e);return t||(t=new JP($x),this.rt=this.rt.insert(e,t)),t}ft(e){var t=null!==this.wt(e);return t||kx("WatchChangeAggregator","Detected inactive target",e),t}wt(e){var t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}dt(t){this.st.set(t,new hO),this.nt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function pO(){return new HP(gR.comparator)}function fO(){return new HP(gR.comparator)}const gO={asc:"ASCENDING",desc:"DESCENDING"},mO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class vO{constructor(e,t){this.databaseId=e,this.N=t}}function yO(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function _O(e,t){return e.N?t.toBase64():t.toUint8Array()}function wO(e){return xx(!!e),Hx.fromTimestamp((t=sR(e),new Gx(t.seconds,t.nanos)));var t}function bO(e,t){return e=e,new Zx(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function IO(e){var t=Zx.fromString(e);return xx(jO(t)),t}function TO(e,t){return bO(e.databaseId,t.path)}function EO(e,t){const n=IO(t);if(n.get(1)!==e.databaseId.projectId)throw new Px(Rx.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Px(Rx.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new gR(AO(n))}function kO(e,t){return bO(e.databaseId,t)}function SO(e){var t=IO(e);return 4===t.length?Zx.emptyPath():AO(t)}function CO(e){return new Zx(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function AO(e){return xx(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function NO(e,t,n){return{name:TO(e,t),fields:n.value.mapValue.fields}}function xO(e,t,n){const r=EO(e,t.name),i=wO(t.updateTime),s=new xR({mapValue:{fields:t.fields}}),o=RR.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function RO(e,t){let n;if(t instanceof UP)n={update:NO(e,t.key,t.value)};else if(t instanceof KP)n={delete:TO(e,t.key)};else if(t instanceof qP)n={update:NO(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof $P))return Nx();n={verify:TO(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof bP)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof IP)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof EP)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof SP)return{fieldPath:e.field.canonicalString(),increment:t.k};throw Nx()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,yO(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:Nx()),n;var r}function PO(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?RP.updateTime(wO(i.updateTime)):void 0!==i.exists?RP.exists(i.exists):RP.none():RP.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)xx("REQUEST_TIME"===t.setToServerValue),n=new bP;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new IP(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new EP(e)}else"increment"in t?n=new SP(e,t.increment):Nx();var r=tR.fromServerFormat(t.fieldPath);return new NP(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=EO(t,n.update.name),o=new xR({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new nR(e.map(e=>tR.fromServerFormat(e)))}();return new qP(s,o,t,e,r)}return new UP(s,o,e,r)}if(n.delete){const r=EO(t,n.delete);return new KP(r,e)}if(n.verify){const r=EO(t,n.verify);return new $P(r,e)}return Nx()}function OO(e,t){return{documents:[kO(e,t.path)]}}function DO(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=kO(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=kO(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(e=>function(e){if("=="===e.op){if(CR(e.value))return{unaryFilter:{field:LO(e.field),op:"IS_NAN"}};if(SR(e.value))return{unaryFilter:{field:LO(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(CR(e.value))return{unaryFilter:{field:LO(e.field),op:"IS_NOT_NAN"}};if(SR(e.value))return{unaryFilter:{field:LO(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:LO(e.field),op:(t=e.op,mO[t]),value:e.value}};var t}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:LO(e.field),direction:(e=e.dir,gO[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var s,i=(s=t.limit,e.N||dR(s)?s:{value:s});return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function MO(e){let t=SO(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){xx(1===r);const f=n.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[qO(e)]:void 0!==e.fieldFilter?[UO(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):Nx():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new JR(FO(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;var c,l,u,h;n.limit&&(a=(e=n.limit,dR(c="object"==typeof e?e.value:e)?null:c));let d=null;n.startAt&&(d=(l=n.startAt,h=!!l.before,u=l.values||[],new YR(u,h)));let p=null;return n.endAt&&(p=(l=n.endAt,u=!l.before,h=l.values||[],new YR(h,u))),tP(t,i,o,s,a,"F",d,p)}function LO(e){return{fieldPath:e.canonicalString()}}function FO(e){return tR.fromServerFormat(e.fieldPath)}function UO(e){return VR.create(FO(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Nx()}}(),e.fieldFilter.value)}function qO(e){switch(e.unaryFilter.op){case"IS_NAN":var t=FO(e.unaryFilter.field);return VR.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=FO(e.unaryFilter.field);return VR.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=FO(e.unaryFilter.field);return VR.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=FO(e.unaryFilter.field);return VR.create(n,"!=",{nullValue:"NULL_VALUE"});default:return Nx()}}function jO(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function VO(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=BO(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return BO(t)}function BO(e){return e+""}function KO(t){const n=t.length;if(xx(2<=n),2===n)return xx(""===t.charAt(0)&&""===t.charAt(1)),Zx.emptyPath();const r=n-2,i=[];let s="";for(let o=0;o<n;){const n=t.indexOf("",o);switch((n<0||n>r)&&Nx(),t.charAt(n+1)){case"":const r=t.substring(o,n);let e;0===s.length?e=r:(s+=r,e=s,s=""),i.push(e);break;case"":s+=t.substring(o,n),s+="\0";break;case"":s+=t.substring(o,n+1);break;default:Nx()}o=n+2}return new Zx(i)}class $O{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class zO{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}zO.store="owner",zO.key="owner";class WO{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}WO.store="mutationQueues",WO.keyPath="userId";class GO{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}GO.store="mutations",GO.keyPath="batchId",GO.userMutationsIndex="userMutationsIndex",GO.userMutationsKeyPath=["userId","batchId"];class HO{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,VO(t)]}static key(e,t,n){return[e,VO(t),n]}}HO.store="documentMutations",HO.PLACEHOLDER=new HO;class QO{constructor(e,t){this.path=e,this.readTime=t}}class YO{constructor(e,t){this.path=e,this.version=t}}class JO{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}JO.store="remoteDocuments",JO.readTimeIndex="readTimeIndex",JO.readTimeIndexPath="readTime",JO.collectionReadTimeIndex="collectionReadTimeIndex",JO.collectionReadTimeIndexPath=["parentPath","readTime"];class XO{constructor(e){this.byteSize=e}}XO.store="remoteDocumentGlobal",XO.key="remoteDocumentGlobalKey";class ZO{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}ZO.store="targets",ZO.keyPath="targetId",ZO.queryTargetsIndexName="queryTargetsIndex",ZO.queryTargetsKeyPath=["canonicalId","targetId"];class e1{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}e1.store="targetDocuments",e1.keyPath=["targetId","path"],e1.documentTargetsIndex="documentTargetsIndex",e1.documentTargetsKeyPath=["path","targetId"];class t1{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}t1.key="targetGlobalKey",t1.store="targetGlobal";class n1{constructor(e,t){this.collectionId=e,this.parent=t}}n1.store="collectionParents",n1.keyPath=["collectionId","parent"];class r1{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}r1.store="clientMetadata",r1.keyPath="clientId";class i1{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}i1.store="bundles",i1.keyPath="bundleId";class s1{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}s1.store="namedQueries",s1.keyPath="name";class o1{constructor(e,t,n){this.indexId=e,this.collectionGroup=t,this.fields=n}}o1.store="indexConfiguration",o1.keyPath="indexId",o1.collectionGroupIndex="collectionGroupIndex",o1.collectionGroupIndexPath="collectionGroup";class a1{constructor(e,t,n,r,i,s){this.indexId=e,this.uid=t,this.sequenceNumber=n,this.readTime=r,this.documentKey=i,this.largestBatchId=s}}a1.store="indexState",a1.keyPath=["indexId","uid"],a1.sequenceNumberIndex="sequenceNumberIndex",a1.sequenceNumberIndexPath=["uid","sequenceNumber"];class c1{constructor(e,t,n,r,i){this.indexId=e,this.uid=t,this.arrayValue=n,this.directionalValue=r,this.documentKey=i}}c1.store="indexEntries",c1.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],c1.documentKeyIndex="documentKeyIndex",c1.documentKeyIndexPath=["indexId","uid","documentKey"];class l1{constructor(e,t,n,r,i,s){this.userId=e,this.collectionPath=t,this.documentId=n,this.collectionGroup=r,this.largestBatchId=i,this.overlayMutation=s}}l1.store="documentOverlays",l1.keyPath=["userId","collectionPath","documentId"],l1.collectionPathOverlayIndex="collectionPathOverlayIndex",l1.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],l1.collectionGroupOverlayIndex="collectionGroupOverlayIndex",l1.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const u1=[WO.store,GO.store,HO.store,JO.store,ZO.store,zO.store,t1.store,e1.store,r1.store,XO.store,n1.store,i1.store,s1.store],h1=[...u1,l1.store],d1=[...h1,o1.store,a1.store,c1.store],p1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class f1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class g1{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&Nx(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new g1((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof g1?t:g1.resolve(t)}catch(e){return g1.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g1.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g1.reject(t)}static resolve(n){return new g1((e,t)=>{e(n)})}static reject(n){return new g1((e,t)=>{t(n)})}static waitFor(e){return new g1((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=g1.resolve(!1);for(const n of e)t=t.next(e=>e?g1.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class m1{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.At=new Ox,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{e.error?this.At.reject(new _1(n,e.error)):this.At.resolve()},this.transaction.onerror=e=>{var t=E1(e.target.error);this.At.reject(new _1(n,t))}}static open(e,t,n,r){try{return new m1(t,e.transaction(r,n))}catch(e){throw new _1(t,e)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(kx("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new b1(t)}}class v1{constructor(e,t,n){this.name=e,this.version=t,this.bt=n,12.2===v1.vt(sd())&&Sx("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return kx("SimpleDb","Removing database:",e),I1(window.indexedDB.deleteDatabase(e)).toPromise()}static Vt(){if(!dd())return!1;if(v1.St())return!0;const e=sd(),t=v1.vt(e),n=0<t&&t<10,r=v1.Dt(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static Nt(e,t){return e.store(t)}static vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async xt(s){return this.db||(kx("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new _1(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new Px(Rx.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new Px(Rx.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new _1(s,t))},i.onupgradeneeded=e=>{kx("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.bt.kt(t,i.transaction,e.oldVersion,this.version).next(()=>{kx("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Ot&&(this.db.onversionchange=e=>this.Ot(e)),this.db}Mt(t){this.Ot=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.xt(e);const t=m1.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.Pt(),e)).catch(e=>(t.abort(e),g1.reject(e))).toPromise();return s.catch(()=>{}),await t.Rt,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(kx("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class y1{constructor(e){this.$t=e,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(e){this.$t=e}done(){this.Ft=!0}Ut(e){this.Bt=e}delete(){return I1(this.$t.delete())}}class _1 extends Px{constructor(e,t){super(Rx.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function w1(e){return"IndexedDbTransactionError"===e.name}class b1{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(kx("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(kx("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),I1(n)}add(e){return kx("SimpleDb","ADD",this.store.name,e,e),I1(this.store.add(e))}get(t){return I1(this.store.get(t)).next(e=>(kx("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return kx("SimpleDb","DELETE",this.store.name,e),I1(this.store.delete(e))}count(){return kx("SimpleDb","COUNT",this.store.name),I1(this.store.count())}qt(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.Kt(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new g1((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}Gt(e,t){kx("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.jt=!1;var r=this.cursor(n);return this.Kt(r,(e,t,n)=>n.delete())}Qt(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Kt(r,t)}Wt(i){const e=this.cursor({});return new g1((n,r)=>{e.onerror=e=>{var t=E1(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Kt(e,s){const o=[];return new g1((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new y1(t),r=s(t.primaryKey,t.value,n);if(r instanceof g1){const e=r.catch(e=>(n.done(),g1.reject(e)));o.push(e)}n.isDone?i():null===n.Lt?t.continue():t.continue(n.Lt)}else i()}}).next(()=>g1.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function I1(e){return new g1((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=E1(e.target.error);r(t)}})}let T1=!1;function E1(e){const t=v1.vt(sd());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new Px("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return T1||(T1=!0,setTimeout(()=>{throw e},0)),e}}return e}class k1 extends f1{constructor(e,t){super(),this.zt=e,this.currentSequenceNumber=t}}function S1(e,t){var n=e;return v1.Nt(n.zt,t)}class C1{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&DP(i,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&MP(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&MP(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(Hx.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),iO())}isEqual(e){return this.batchId===e.batchId&&zx(this.mutations,e.mutations,(e,t)=>LP(e,t))&&zx(this.baseMutations,e.baseMutations,(e,t)=>LP(e,t))}}class A1{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){xx(e.mutations.length===n.length);let r=nO;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new A1(e,t,n,r)}}class N1{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class x1{constructor(e,t,n,r,i=Hx.min(),s=Hx.min(),o=rR.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new x1(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new x1(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new x1(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class R1{constructor(e){this.Ht=e}}function P1(e,t){let n;if(t.document)n=xO(e.Ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=gR.fromSegments(t.noDocument.path),r=F1(t.noDocument.readTime);n=RR.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Nx();{const e=gR.fromSegments(t.unknownDocument.path),i=F1(t.unknownDocument.version);n=RR.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime(M1(t.readTime)),n}function O1(e,t){var n,r=D1(t.readTime),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var s={name:TO(n=e.Ht,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:yO(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new JO(null,null,s,o,r,i)}if(t.isNoDocument()){const a=t.key.path.toArray(),c=L1(t.version),l=t.hasCommittedMutations;return new JO(null,new QO(a,c),null,l,r,i)}if(t.isUnknownDocument()){const a=t.key.path.toArray(),u=L1(t.version);return new JO(new YO(a,u),null,null,!0,r,i)}return Nx()}function D1(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function M1(e){var t=new Gx(e[0],e[1]);return Hx.fromTimestamp(t)}function L1(e){var t=e.toTimestamp();return new $O(t.seconds,t.nanoseconds)}function F1(e){var t=new Gx(e.seconds,e.nanoseconds);return Hx.fromTimestamp(t)}function U1(t,e){const n=(e.baseMutations||[]).map(e=>PO(t.Ht,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>PO(t.Ht,e)),i=Gx.fromMillis(e.localWriteTimeMs);return new C1(e.batchId,i,n,r)}function q1(e){var t,n=F1(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?F1(e.lastLimboFreeSnapshotVersion):Hx.min();let i;return i=void 0!==e.query.documents?(xx(1===(t=e.query).documents.length),lP(nP(SO(t.documents[0])))):lP(MO(e.query)),new x1(i,e.targetId,0,e.lastListenSequenceNumber,n,r,rR.fromBase64String(e.resumeToken))}function j1(e,t){var n=L1(t.snapshotVersion),r=L1(t.lastLimboFreeSnapshotVersion),i=(jR(t.target)?OO:DO)(e.Ht,t.target),s=t.resumeToken.toBase64();return new ZO(t.targetId,UR(t.target),n,s,t.sequenceNumber,r,i)}function V1(e){var t=MO({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?uP(t,t.limit,"L"):t}function B1(e,t){return new N1(t.largestBatchId,PO(e.Ht,t.overlayMutation))}function K1(e,t){var n=t.path.lastSegment();return[e,VO(t.path.popLast()),n]}class $1{getBundleMetadata(e,t){return z1(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:F1(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return z1(e).put({bundleId:(n=t).id,createTime:L1(wO(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return W1(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:V1(t.bundledQuery),readTime:F1(t.readTime)};var t})}saveNamedQuery(e,t){return W1(e).put({name:(t=t).name,readTime:L1(wO(t.readTime)),bundledQuery:t.bundledQuery})}}function z1(e){return S1(e,i1.store)}function W1(e){return S1(e,s1.store)}class G1{constructor(e,t){this.O=e,this.userId=t}static Jt(e,t){var n=t.uid||"";return new G1(e,n)}getOverlay(e,t){return H1(e).get(K1(this.userId,t)).next(e=>e?B1(this.O,e):null)}saveOverlays(n,r,e){const i=[];return e.forEach(e=>{var t=new N1(r,e);i.push(this.Yt(n,t))}),g1.waitFor(i)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(VO(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(H1(n).Gt(l1.collectionPathOverlayIndex,t))}),g1.waitFor(i)}getOverlaysForCollection(e,t,n){const r=new Map,i=VO(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return H1(e).qt(l1.collectionPathOverlayIndex,s).next(e=>{for(const t of e){const e=B1(this.O,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=new Map;let o;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return H1(e).Qt({index:l1.collectionGroupOverlayIndex,range:r},(e,t,n)=>{const r=B1(this.O,t);s.size<i||r.largestBatchId===o?(s.set(r.getKey(),r),o=r.largestBatchId):n.done()}).next(()=>s)}Yt(e,t){return H1(e).put(function(e,t,n){var[,r,i]=K1(t,n.mutation.key);return new l1(t,r,i,n.mutation.key.getCollectionGroup(),n.largestBatchId,RO(e.Ht,n.mutation))}(this.O,this.userId,t))}}function H1(e){return S1(e,l1.store)}class Q1{constructor(){}Xt(e,t){this.Zt(e,t),t.te()}Zt(e,t){var n,r;"nullValue"in e?this.ee(t,5):"booleanValue"in e?(this.ee(t,10),t.ne(e.booleanValue?1:0)):"integerValue"in e?(this.ee(t,15),t.ne(oR(e.integerValue))):"doubleValue"in e?(n=oR(e.doubleValue),isNaN(n)?this.ee(t,13):(this.ee(t,15),pR(n)?t.ne(0):t.ne(n))):"timestampValue"in e?(r=e.timestampValue,this.ee(t,20),"string"==typeof r?t.se(r):(t.se(`${r.seconds||""}`),t.ne(r.nanos||0))):"stringValue"in e?(this.ie(e.stringValue,t),this.re(t)):"bytesValue"in e?(this.ee(t,30),t.oe(aR(e.bytesValue)),this.re(t)):"referenceValue"in e?this.ce(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ee(t,45),t.ne(r.latitude||0),t.ne(r.longitude||0)):"mapValue"in e?yR(e,mR)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):Nx()}ie(e,t){this.ee(t,25),this.he(e,t)}he(e,t){t.se(e)}ue(e,t){var n=e.fields||{};this.ee(t,55);for(const e of Object.keys(n))this.ie(e,t),this.Zt(n[e],t)}ae(e,t){var n=e.values||[];this.ee(t,50);for(const e of n)this.Zt(e,t)}ce(e,t){this.ee(t,37),gR.fromName(e).path.forEach(e=>{this.ee(t,60),this.he(e,t)})}ee(e,t){e.ne(t)}re(e){e.ne(2)}}function Y1(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}Q1.le=new Q1;class J1{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.de(n.value),n=t.next();this._e()}we(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.me(n.value),n=t.next();this.ge()}ye(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.de(e);else if(e<2048)this.de(960|e>>>6),this.de(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.de(480|e>>>12),this.de(128|63&e>>>6),this.de(128|63&e);else{const e=t.codePointAt(0);this.de(240|e>>>18),this.de(128|63&e>>>12),this.de(128|63&e>>>6),this.de(128|63&e)}}this._e()}pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.me(e);else if(e<2048)this.me(960|e>>>6),this.me(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.me(480|e>>>12),this.me(128|63&e>>>6),this.me(128|63&e);else{const e=t.codePointAt(0);this.me(240|e>>>18),this.me(128|63&e>>>12),this.me(128|63&e>>>6),this.me(128|63&e)}}this.ge()}Ie(e){var t=this.Ee(e),n=Y1(t);this.Te(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ae(e){var t=this.Ee(e),n=Y1(t);this.Te(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Te(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ve(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}de(e){var t=255&e;0==t?(this.Pe(0),this.Pe(255)):255==t?(this.Pe(255),this.Pe(0)):this.Pe(t)}me(e){var t=255&e;0==t?(this.ve(0),this.ve(255)):255==t?(this.ve(255),this.ve(0)):this.ve(e)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(e){this.Te(1),this.buffer[this.position++]=e}ve(e){this.Te(1),this.buffer[this.position++]=~e}Te(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class X1{constructor(e){this.Se=e}oe(e){this.Se.fe(e)}se(e){this.Se.ye(e)}ne(e){this.Se.Ie(e)}te(){this.Se.Re()}}class Z1{constructor(e){this.Se=e}oe(e){this.Se.we(e)}se(e){this.Se.pe(e)}ne(e){this.Se.Ae(e)}te(){this.Se.be()}}class eD{constructor(){this.Se=new J1,this.De=new X1(this.Se),this.Ce=new Z1(this.Se)}seed(e){this.Se.seed(e)}Ne(e){return 0===e?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}class tD{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}}function nD(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=gR.comparator(e.documentKey,t.documentKey),0!==n?n:(n=rD(e.arrayValue,t.arrayValue),0!==n?n:rD(e.directionalValue,t.directionalValue)))}function rD(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class iD{constructor(){this.xe=new sD}addToCollectionParentIndex(e,t){return this.xe.add(t),g1.resolve()}getCollectionParents(e,t){return g1.resolve(this.xe.getEntries(t))}addFieldIndex(e,t){return g1.resolve()}deleteFieldIndex(e,t){return g1.resolve()}getDocumentsMatchingTarget(e,t,n){return g1.resolve(iO())}getFieldIndex(e,t){return g1.resolve(null)}getFieldIndexes(e,t){return g1.resolve([])}getNextCollectionGroupToUpdate(e){return g1.resolve(null)}updateCollectionGroup(e,t,n){return g1.resolve()}updateIndexEntries(e,t){return g1.resolve()}}class sD{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new JP(Zx.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new JP(Zx.comparator)).toArray()}}class oD{constructor(e){this.user=e,this.ke=new sD,this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.ke.has(t))return g1.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.ke.add(t)});r={collectionId:n,parent:VO(r)};return aD(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Wx(n),""],!1,!0);return aD(e).qt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(KO(t.parent))}return r})}addFieldIndex(e,t){const n=lD(e),r=(t=t,new o1(t.indexId,t.collectionGroup,t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])));return delete r.indexId,n.add(r).next()}deleteFieldIndex(e,t){const n=lD(e),r=uD(e),i=cD(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t,n){return g1.resolve(iO())}getFieldIndex(e,t){return g1.resolve(null)}Oe(e,t){const n=new eD;for(const i of e.fields.filter(e=>2!==e.kind)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.Ne(i.kind);Q1.le.Xt(e,r)}return n.Ve()}Me(e){const t=new eD;return Q1.le.Xt(e,t.Ne(0)),t.Ve()}getFieldIndexes(e,t){const n=lD(e),r=uD(e);return(t?n.qt(o1.collectionGroupIndex,IDBKeyRange.bound(t,t)):n.qt()).next(e=>{const s=[];return g1.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new DR(e.sequenceNumber,new MR(F1(e.readTime),new gR(KO(e.documentKey)),e.largestBatchId)):DR.empty(),r=t.fields.map(([e,t])=>new OR(tR.fromServerFormat(e),t)),new PR(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>e.indexState.sequenceNumber-t.indexState.sequenceNumber),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=lD(e),s=uD(e);return this.$e(e).next(t=>i.qt(o1.collectionGroupIndex,IDBKeyRange.bound(n,n)).next(e=>g1.forEach(e,e=>s.put(function(e,t,n,r){return new a1(e,t.uid||"",n,L1(r.readTime),VO(r.documentKey.path),r.largestBatchId)}(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return g1.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?g1.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),g1.forEach(e,n=>this.Fe(i,t,n).next(e=>{var t=this.Be(r,n);return e.isEqual(t)?g1.resolve():this.Le(i,r,e,t)}))))})}Ue(e,t,n){return cD(e).put(new c1(n.indexId,this.uid,n.arrayValue,n.directionalValue,VO(t.key.path)))}qe(e,t,n){return cD(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,VO(t.key.path)])}Fe(e,n,r){const t=cD(e);let i=new JP(nD);return t.Qt({index:c1.documentKeyIndex,range:IDBKeyRange.only([r.indexId,this.uid,VO(n.path)])},(e,t)=>{i=i.add(new tD(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}Be(e,t){let n=new JP(nD);var r=this.Oe(t,e);if(null==r)return n;const i=t.fields.find(e=>2===e.kind);if(null!=i){var s=e.data.field(i.fieldPath);if(kR(s))for(const i of s.arrayValue.values||[])n=n.add(new tD(t.indexId,e.key,this.Me(i),r))}else n=n.add(new tD(t.indexId,e.key,new Uint8Array,r));return n}Le(t,n,l,e){kx("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const r=[];return function(e,n,r,i){var s=l.getIterator(),o=e.getIterator();let a=ZP(s),c=ZP(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:0<r&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=ZP(o)):t?(i(a),a=ZP(s)):(a=ZP(s),c=ZP(o))}}(e,nD,e=>{r.push(this.Ue(t,n,e))},e=>{r.push(this.qe(t,n,e))}),g1.waitFor(r)}$e(e){let r=1;return uD(e).Qt({index:a1.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}}function aD(e){return S1(e,n1.store)}function cD(e){return S1(e,c1.store)}function lD(e){return S1(e,o1.store)}function uD(e){return S1(e,a1.store)}const hD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class dD{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new dD(e,dD.DEFAULT_COLLECTION_PERCENTILE,dD.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function pD(e,t,n){const r=e.store(GO.store),i=e.store(HO.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Qt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{xx(1===a)}));const l=[];for(const e of n.mutations){const r=HO.key(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return g1.waitFor(s).next(()=>l)}function fD(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Nx();t=e.noDocument}return JSON.stringify(t).length}dD.DEFAULT_COLLECTION_PERCENTILE=10,dD.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dD.DEFAULT=new dD(41943040,dD.DEFAULT_COLLECTION_PERCENTILE,dD.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dD.DISABLED=new dD(-1,0,0);class gD{constructor(e,t,n,r){this.userId=e,this.O=t,this.indexManager=n,this.referenceDelegate=r,this.Ke={}}static Jt(e,t,n,r){xx(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new gD(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vD(e).Qt({index:GO.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=yD(u),g=vD(u);return g.add({}).next(e=>{xx("number"==typeof e);const t=new C1(e,h,d,p),n=(i=this.O,s=this.userId,o=t,a=o.baseMutations.map(e=>RO(i.Ht,e)),c=o.mutations.map(e=>RO(i.Ht,e)),new GO(s,o.batchId,o.localWriteTime.toMillis(),a,c)),r=[];var i,s,o,a,c;let l=new JP((e,t)=>$x(e.canonicalString(),t.canonicalString()));for(const u of p){const h=HO.key(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,HO.PLACEHOLDER))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Ke[e]=t.keys()}),g1.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return vD(e).get(t).next(e=>e?(xx(e.userId===this.userId),U1(this.O,e)):null)}Ge(e,n){return this.Ke[n]?g1.resolve(this.Ke[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.Ke[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return vD(e).Qt({index:GO.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(xx(t.batchId>=r),i=U1(this.O,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return vD(e).Qt({index:GO.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vD(e).qt(GO.userMutationsIndex,t).next(e=>e.map(e=>U1(this.O,e)))}getAllMutationBatchesAffectingDocumentKey(o,a){const e=HO.prefixForPath(this.userId,a.path),t=IDBKeyRange.lowerBound(e),c=[];return yD(o).Qt({range:t},(e,t,n)=>{var[r,i,s]=e,i=KO(i);if(r===this.userId&&a.path.isEqual(i))return vD(o).get(s).next(e=>{if(!e)throw Nx();xx(e.userId===this.userId),c.push(U1(this.O,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new JP($x);const n=[];return e.forEach(o=>{var e=HO.prefixForPath(this.userId,o.path),e=IDBKeyRange.lowerBound(e),e=yD(t).Qt({range:e},(e,t,n)=>{var[r,i,s]=e,i=KO(i);r===this.userId&&o.path.isEqual(i)?a=a.add(s):n.done()});n.push(e)}),g1.waitFor(n).next(()=>this.je(t,a))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,a=o.length+1,n=HO.prefixForPath(this.userId,o),r=IDBKeyRange.lowerBound(n);let c=new JP($x);return yD(e).Qt({range:r},(e,t,n)=>{var[r,i,s]=e,i=KO(i);r===this.userId&&o.isPrefixOf(i)?i.length===a&&(c=c.add(s)):n.done()}).next(()=>this.je(e,c))}je(t,e){const n=[],r=[];return e.forEach(e=>{r.push(vD(t).get(e).next(e=>{if(null===e)throw Nx();xx(e.userId===this.userId),n.push(U1(this.O,e))}))}),g1.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return pD(t.zt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Qe(n.batchId)}),g1.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Qe(e){delete this.Ke[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return g1.resolve();const t=IDBKeyRange.lowerBound(HO.prefixForUser(this.userId)),r=[];return yD(n).Qt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=KO(e[1]);r.push(t)}else n.done()}).next(()=>{xx(0===r.length)})})}containsKey(e,t){return mD(e,this.userId,t)}We(e){return _D(e).get(this.userId).next(e=>e||new WO(this.userId,-1,""))}}function mD(e,s,t){const n=HO.prefixForPath(s,t.path),o=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return yD(e).Qt({range:r,jt:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===o&&(a=!0),n.done()}).next(()=>a)}function vD(e){return S1(e,GO.store)}function yD(e){return S1(e,HO.store)}function _D(e){return S1(e,WO.store)}class wD{constructor(e){this.ze=e}next(){return this.ze+=2,this.ze}static He(){return new wD(0)}static Je(){return new wD(-1)}}class bD{constructor(e,t){this.referenceDelegate=e,this.O=t}allocateTargetId(n){return this.Ye(n).next(e=>{const t=new wD(e.highestTargetId);return e.highestTargetId=t.next(),this.Xe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ye(e).next(e=>Hx.fromTimestamp(new Gx(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ye(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Ye(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Xe(t,e)))}addTargetData(t,n){return this.Ze(t,n).next(()=>this.Ye(t).next(e=>(e.targetCount+=1,this.tn(n,e),this.Xe(t,e))))}updateTargetData(e,t){return this.Ze(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>ID(t).delete(e.targetId)).next(()=>this.Ye(t)).next(e=>(xx(0<e.targetCount),--e.targetCount,this.Xe(t,e)))}removeTargets(r,i,s){let o=0;const a=[];return ID(r).Qt((e,t)=>{var n=q1(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(o++,a.push(this.removeTargetData(r,n)))}).next(()=>g1.waitFor(a)).next(()=>o)}forEachTarget(e,r){return ID(e).Qt((e,t)=>{var n=q1(t);r(n)})}Ye(e){return TD(e).get(t1.key).next(e=>(xx(null!==e),e))}Xe(e,t){return TD(e).put(t1.key,t)}Ze(e,t){return ID(e).put(j1(this.O,t))}tn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ye(e).next(e=>e.targetCount)}getTargetData(e,i){var t=UR(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return ID(e).Qt({range:t,index:ZO.queryTargetsIndexName},(e,t,n)=>{var r=q1(t);qR(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=ED(n);return e.forEach(e=>{var t=VO(e.path);i.push(s.put(new e1(r,t))),i.push(this.referenceDelegate.addReference(n,r,e))}),g1.waitFor(i)}removeMatchingKeys(n,e,r){const i=ED(n);return g1.forEach(e,e=>{var t=VO(e.path);return g1.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=ED(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ED(e);let i=iO();return r.Qt({range:n,jt:!0},(e,t,n)=>{var r=KO(e[1]),r=new gR(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=VO(t.path),n=IDBKeyRange.bound([n],[Wx(n)],!1,!0);let r=0;return ED(e).Qt({index:e1.documentTargetsIndex,jt:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Tt(e,t){return ID(e).get(t).next(e=>e?q1(e):null)}}function ID(e){return S1(e,ZO.store)}function TD(e){return S1(e,t1.store)}function ED(e){return S1(e,e1.store)}async function kD(e){if(e.code!==Rx.FAILED_PRECONDITION||e.message!==p1)throw e;kx("LocalStore","Unexpectedly lost primary lease")}function SD([e,t],[n,r]){var i=$x(e,n);return 0===i?$x(t,r):i}class CD{constructor(e){this.en=e,this.buffer=new JP(SD),this.nn=0}sn(){return++this.nn}rn(e){var t=[e,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();SD(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class AD{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.on=!1,this.cn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(e)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return null!==this.cn}un(e){var t=this.on?3e5:6e4;kx("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.cn=null,this.on=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){w1(e)?kx("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await kD(e)}await this.un(e)})}}class ND{constructor(e,t){this.an=e,this.params=t}calculateTargetCount(e,t){return this.an.hn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return g1.resolve(Bx.A);const n=new CD(t);return this.an.forEachTarget(e,e=>n.rn(e.sequenceNumber)).next(()=>this.an.ln(e,e=>n.rn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.an.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.an.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(kx("LruGarbageCollector","Garbage collection skipped; disabled"),g1.resolve(hD)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(kx("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hD):this.fn(t,n))}getCacheSize(e){return this.an.getCacheSize(e)}fn(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(kx("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),Ex()<=$h.DEBUG&&kx("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),g1.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class xD{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new ND(e,t))}hn(e){const n=this.dn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}dn(e){let t=0;return this.ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ln(e,n){return this._n(e,(e,t)=>n(t))}addReference(e,t,n){return RD(e,n)}removeReference(e,t,n){return RD(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return RD(e,t)}wn(t,n){let r=!1;return _D(t).Wt(e=>mD(t,e,n).next(e=>(e&&(r=!0),g1.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this._n(n,(t,e)=>{if(e<=r){const r=this.wn(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t,Hx.min()),ED(n).delete([0,VO(t.path)])))});s.push(r)}}).next(()=>g1.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return RD(e,t)}_n(e,r){const t=ED(e);let i,s=Bx.A;return t.Qt({index:e1.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==Bx.A&&r(new gR(KO(i)),s),s=n,i=t):s=Bx.A}).next(()=>{s!==Bx.A&&r(new gR(KO(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function RD(e,t){return ED(e).put((t=t,e=e.currentSequenceNumber,new e1(0,VO(t.path),e)))}class PD{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(r){Yx(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return Jx(this.inner)}}class OD{constructor(){this.changes=new PD(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,RR.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?g1.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class DD{constructor(e){this.O=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return FD(e).put(UD(t),n)}removeEntry(e,t){const n=FD(e),r=UD(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.mn(t,e)))}getEntry(e,t){return FD(e).get(UD(t)).next(e=>this.gn(t,e))}yn(e,t){return FD(e).get(UD(t)).next(e=>({document:this.gn(t,e),size:fD(e)}))}getEntries(e,t){let r=eO;return this.pn(e,t,(e,t)=>{var n=this.gn(e,t);r=r.insert(e,n)}).next(()=>r)}In(e,t){let r=eO,i=new HP(gR.comparator);return this.pn(e,t,(e,t)=>{var n=this.gn(e,t);r=r.insert(e,n),i=i.insert(e,fD(t))}).next(()=>({documents:r,En:i}))}pn(e,t,i){if(t.isEmpty())return g1.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return FD(e).Qt({range:n},(e,t,n)=>{for(var r=gR.fromSegments(e);o&&gR.comparator(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.Ut(o.path.toArray()):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getAll(e,i,t){let s=eO;const o=i.length+1,n={};if(t.isEqual(Hx.min())){const e=i.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=i.toArray(),s=D1(t);n.range=IDBKeyRange.lowerBound([e,s],!0),n.index=JO.collectionReadTimeIndex}return FD(e).Qt(n,(e,t,n)=>{var r;e.length===o&&(r=this.gn(gR.fromSegments(e),t),i.isPrefixOf(r.key.path)?s=s.insert(r.key,r):n.done())}).next(()=>s)}newChangeBuffer(e){return new MD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return LD(e).get(XO.key).next(e=>(xx(!!e),e))}mn(e,t){return LD(e).put(XO.key,t)}gn(e,t){if(t){const e=P1(this.O,t);if(!e.isNoDocument()||!e.version.isEqual(Hx.min()))return e}return RR.newInvalidDocument(e)}}class MD extends OD{constructor(e,t){super(),this.Tn=e,this.trackRemovals=t,this.An=new PD(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const o=[];let a=0,c=new JP((e,t)=>$x(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.An.get(e);if(t.isValidDocument()){var r=O1(this.Tn.O,t);c=c.add(e.path.popLast());var i=fD(r);a+=i-n,o.push(this.Tn.addEntry(s,e,r))}else if(a-=n,this.trackRemovals){const a=O1(this.Tn.O,t.convertToNoDocument(Hx.min()));o.push(this.Tn.addEntry(s,e,a))}else o.push(this.Tn.removeEntry(s,e))}),c.forEach(e=>{o.push(this.Tn.indexManager.addToCollectionParentIndex(s,e))}),o.push(this.Tn.updateMetadata(s,a)),g1.waitFor(o)}getFromCache(e,t){return this.Tn.yn(e,t).next(e=>(this.An.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Tn.In(e,t).next(({documents:e,En:t})=>(t.forEach((e,t)=>{this.An.set(e,t)}),e))}}function LD(e){return S1(e,XO.store)}function FD(e){return S1(e,JO.store)}function UD(e){return e.path.toArray()}class qD{constructor(e){this.O=e}kt(t,n,e,r){const i=new m1("createOrUpgrade",n);var s;e<1&&1<=r&&(t.createObjectStore(zO.store),(s=t).createObjectStore(WO.store,{keyPath:WO.keyPath}),s.createObjectStore(GO.store,{keyPath:GO.keyPath,autoIncrement:!0}).createIndex(GO.userMutationsIndex,GO.userMutationsKeyPath,{unique:!0}),s.createObjectStore(HO.store),jD(t),t.createObjectStore(JO.store));let o=g1.resolve();return e<3&&3<=r&&(0!==e&&((s=t).deleteObjectStore(e1.store),s.deleteObjectStore(ZO.store),s.deleteObjectStore(t1.store),jD(t)),o=o.next(()=>function(){const e=i.store(t1.store),t=new t1(0,0,Hx.min().toTimestamp(),0);return e.put(t1.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,i){return i.store(GO.store).qt().next(e=>{r.deleteObjectStore(GO.store),r.createObjectStore(GO.store,{keyPath:GO.keyPath,autoIncrement:!0}).createIndex(GO.userMutationsIndex,GO.userMutationsKeyPath,{unique:!0});const t=i.store(GO.store),n=e.map(e=>t.put(e));return g1.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore(r1.store,{keyPath:r1.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Rn(i))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(XO.store),this.Pn(i)))),e<7&&7<=r&&(o=o.next(()=>this.bn(i))),e<8&&8<=r&&(o=o.next(()=>this.vn(t,i))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(JO.store);e.createIndex(JO.readTimeIndex,JO.readTimeIndexPath,{unique:!1}),e.createIndex(JO.collectionReadTimeIndex,JO.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.Vn(i))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(i1.store,{keyPath:i1.keyPath}),t.createObjectStore(s1.store,{keyPath:s1.keyPath})})),e<12&&12<=r&&(o=o.next(()=>{!function(){const e=t.createObjectStore(l1.store,{keyPath:l1.keyPath});e.createIndex(l1.collectionPathOverlayIndex,l1.collectionPathOverlayIndexPath,{unique:!1}),e.createIndex(l1.collectionGroupOverlayIndex,l1.collectionGroupOverlayIndexPath,{unique:!1})}()})),e<13&&13<=r&&(o=o.next(()=>{var e;(e=t).createObjectStore(o1.store,{keyPath:o1.keyPath,autoIncrement:!0}).createIndex(o1.collectionGroupIndex,o1.collectionGroupIndexPath,{unique:!1}),e.createObjectStore(a1.store,{keyPath:a1.keyPath}).createIndex(a1.sequenceNumberIndex,a1.sequenceNumberIndexPath,{unique:!1}),e.createObjectStore(c1.store,{keyPath:c1.keyPath}).createIndex(c1.documentKeyIndex,c1.documentKeyIndexPath,{unique:!1})})),o}Pn(t){let n=0;return t.store(JO.store).Qt((e,t)=>{n+=fD(t)}).next(()=>{var e=new XO(n);return t.store(XO.store).put(XO.key,e)})}Rn(r){const e=r.store(WO.store),t=r.store(GO.store);return e.qt().next(e=>g1.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.qt(GO.userMutationsIndex,e).next(e=>g1.forEach(e,e=>{xx(e.userId===n.userId);var t=U1(this.O,e);return pD(r,n.userId,t).next(()=>{})}))}))}bn(e){const o=e.store(e1.store),t=e.store(JO.store);return e.store(t1.store).get(t1.key).next(i=>{const s=[];return t.Qt((e,t)=>{const n=new Zx(e),r=[0,VO(n)];s.push(o.get(r).next(e=>e?g1.resolve():(e=>o.put(new e1(0,VO(e),i.highestListenSequenceNumber)))(n)))}).next(()=>g1.waitFor(s))})}vn(e,t){e.createObjectStore(n1.store,{keyPath:n1.keyPath});const n=t.store(n1.store),r=new sD,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:VO(r)})}};return t.store(JO.store).Qt({jt:!0},(e,t)=>{const n=new Zx(e);return i(n.popLast())}).next(()=>t.store(HO.store).Qt({jt:!0},([,e],t)=>{const n=KO(e);return i(n.popLast())}))}Vn(e){const r=e.store(ZO.store);return r.Qt((e,t)=>{var n=q1(t),n=j1(this.O,n);return r.put(n)})}}function jD(e){e.createObjectStore(e1.store,{keyPath:e1.keyPath}).createIndex(e1.documentTargetsIndex,e1.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(ZO.store,{keyPath:ZO.keyPath}).createIndex(ZO.queryTargetsIndexName,ZO.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(t1.store)}const VD="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class BD{constructor(e,t,n,r,i,s,o,a,c,l,u=12){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Sn=i,this.window=s,this.document=o,this.Dn=c,this.Cn=l,this.schemaVersion=u,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=e=>Promise.resolve(),!BD.Vt())throw new Px(Rx.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xD(this,r),this.Bn=t+"main",this.O=new R1(a),this.Ln=new v1(this.Bn,this.schemaVersion,new qD(this.O)),this.Un=new bD(this.referenceDelegate,this.O),this.qn=(a=this.O,new DD(a)),this.Kn=new $1,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===l&&Sx("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Px(Rx.FAILED_PRECONDITION,VD);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Un.getHighestSequenceNumber(e))}).then(e=>{this.Nn=new Bx(e,this.Dn)}).then(()=>{this.xn=!0}).catch(e=>(this.Ln&&this.Ln.close(),Promise.reject(e)))}Hn(t){return this.Fn=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ln.Mt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Sn.enqueueAndForget(async()=>{this.started&&await this.jn()}))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>$D(t).put(new r1(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Jn(t).next(e=>{e||(this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)))})}).next(()=>this.Yn(t)).next(e=>this.isPrimary&&!e?this.Xn(t).next(()=>!1):!!e&&this.Zn(t).next(()=>!0))).catch(e=>{if(w1(e))return kx("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return kx("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Sn.enqueueRetryable(()=>this.Fn(e)),this.isPrimary=e})}Jn(e){return KD(e).get(zO.key).next(e=>g1.resolve(this.ts(e)))}es(e){return $D(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.ss(this.$n,18e5)){this.$n=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=S1(e,r1.store);return r.qt().next(e=>{const t=this.rs(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return g1.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Gn)for(const t of e)this.Gn.removeItem(this.os(t.clientId))}}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.jn().then(()=>this.ns()).then(()=>this.zn()))}ts(e){return!!e&&e.ownerId===this.clientId}Yn(t){return this.Cn?g1.resolve(!0):KD(t).get(zO.key).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)){if(this.ts(e)&&this.networkEnabled)return!0;if(!this.ts(e)){if(!e.allowTabSynchronization)throw new Px(Rx.FAILED_PRECONDITION,VD);return!1}}return!(!this.networkEnabled||!this.inForeground)||$D(t).qt().next(e=>void 0===this.rs(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&kx("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),await this.Ln.runTransaction("shutdown","readwrite",[zO.store,r1.store],e=>{const t=new k1(e,Bx.A);return this.Xn(t).next(()=>this.es(t))}),this.Ln.close(),this.fs()}rs(e,t){return e.filter(e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId))}ds(){return this.runTransaction("getActiveClients","readonly",e=>$D(e).qt().next(e=>this.rs(e,18e5).map(e=>e.clientId)))}get started(){return this.xn}getMutationQueue(e,t){return gD.Jt(e,this.O,t,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(e){return new oD(e)}getDocumentOverlayCache(e){return G1.Jt(this.O,e)}getBundleCache(){return this.Kn}runTransaction(t,n,r){kx("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=13===(e=this.schemaVersion)?d1:12===e?h1:11===e?u1:void Nx();let s;return this.Ln.runTransaction(t,i,e,e=>(s=new k1(e,this.Nn?this.Nn.next():Bx.A),"readwrite-primary"===n?this.Jn(s).next(e=>!!e||this.Yn(s)).next(e=>{if(!e)throw Sx(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)),new Px(Rx.FAILED_PRECONDITION,p1);return r(s)}).next(e=>this.Zn(s).next(()=>e)):this._s(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}_s(e){return KD(e).get(zO.key).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Cn||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Px(Rx.FAILED_PRECONDITION,VD)})}Zn(e){var t=new zO(this.clientId,this.allowTabSynchronization,Date.now());return KD(e).put(zO.key,t)}static Vt(){return v1.Vt()}Xn(e){const t=KD(e);return t.get(zO.key).next(e=>this.ts(e)?(kx("IndexedDbPersistence","Releasing primary lease."),t.delete(zO.key)):g1.resolve())}ss(e,t){var n=Date.now();return!(e<n-t||n<e&&(Sx(`Detected an update time that is in the future: ${e} > ${n}`),1))}Qn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=()=>{this.Sn.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.jn()))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.kn=()=>{this.us(),!ad()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(e){var t;try{var n=null!==(null===(t=this.Gn)||void 0===t?void 0:t.getItem(this.os(e)));return kx("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Sx("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(e){Sx("Failed to set zombie client id.",e)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(e){}}os(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function KD(e){return S1(e,zO.store)}function $D(e){return S1(e,r1.store)}function zD(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class WD{constructor(e,t){this.progress=e,this.ws=t}}class GD{constructor(e,t,n){this.qn=e,this.gs=t,this.indexManager=n}ys(t,n){return this.gs.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.ps(t,n,e))}ps(e,t,n){return this.qn.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Is(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Es(t,e){return this.qn.getEntries(t,e).next(e=>this.Ts(t,e).next(()=>e))}Ts(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Is(t,e))}As(e,t,n){return r=t,gR.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Rs(e,t.path):aP(t)?this.Ps(e,t,n):this.bs(e,t,n);var r}Rs(e,t){return this.ys(e,new gR(t)).next(e=>{let t=tO;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Ps(r,i,s){const o=i.collectionGroup;let a=tO;return this.indexManager.getCollectionParents(r,o).next(e=>g1.forEach(e,e=>{var t,n=(t=i,e=e.child(o),new eP(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.bs(r,n,s).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}bs(t,n,e){let i;return this.qn.getAll(t,n.path,e).next(e=>(i=e,this.gs.getAllMutationBatchesAffectingQuery(t,n))).next(t=>{for(const r of t)for(const t of r.mutations){var n=t.key;let e=i.get(n);null==e&&(e=RR.newInvalidDocument(n),i=i.insert(n,e)),MP(t,e,r.localWriteTime),e.isFoundDocument()||(i=i.remove(n))}}).next(()=>(i.forEach((e,t)=>{fP(n,t)||(i=i.remove(e))}),i))}}class HD{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.vs=n,this.Vs=r}static Ss(e,t){let n=iO(),r=iO();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new HD(e,t.fromCache,n,r)}}class QD{Ds(e){this.Cs=e}As(t,r,i,s){return 0===(e=r).filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||i.isEqual(Hx.min())?this.Ns(t,r):this.Cs.Es(t,s).next(e=>{const n=this.xs(r,e);return(rP(r)||iP(r))&&this.ks(r.limitType,n,s,i)?this.Ns(t,r):(Ex()<=$h.DEBUG&&kx("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pP(r)),this.Cs.As(t,r,i).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))});var e}xs(n,e){let r=new JP(gP(n));return e.forEach((e,t)=>{fP(n,t)&&(r=r.add(t))}),r}ks(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Ns(e,t){return Ex()<=$h.DEBUG&&kx("QueryEngine","Using full collection scan to execute query:",pP(t)),this.Cs.As(e,t,Hx.min())}}class YD{constructor(e,t,n,r){this.persistence=e,this.Os=t,this.O=r,this.Ms=new HP($x),this.$s=new PD(e=>UR(e),qR),this.Fs=Hx.min(),this.Bs=e.getRemoteDocumentCache(),this.Un=e.getTargetCache(),this.Kn=e.getBundleCache(),this.Ls(n)}Ls(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new GD(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function JD(e,t,n,r){return new YD(e,t,n,r)}async function XD(e,t){const o=e;return o.persistence.runTransaction("Handle user change","readonly",i=>{let s;return o.gs.getAllMutationBatches(i).next(e=>(s=e,o.Ls(t),o.gs.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=iO();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.Us.Es(i,r).next(e=>({qs:e,removedBatchIds:t,addedBatchIds:n}))})})}function ZD(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Un.getLastRemoteSnapshotVersion(e))}function eM(e,l){const u=e,h=l.snapshotVersion;let d=u.Ms;return u.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const e=u.Bs.newChangeBuffer({trackRemovals:!0});d=u.Ms;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Un.removeMatchingKeys(a,t.removedDocuments,n).next(()=>u.Un.addMatchingKeys(a,t.addedDocuments,n)));let e=r.withSequenceNumber(a.currentSequenceNumber);var i,s,o;l.targetMismatches.has(n)?e=e.withResumeToken(rR.EMPTY_BYTE_STRING,Hx.min()).withLastLimboFreeSnapshotVersion(Hx.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,o=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||c.push(u.Un.updateTargetData(a,e))}});let t=eO;if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(a,e))}),c.push(tM(a,e,l.documentUpdates).next(e=>{t=e})),!h.isEqual(Hx.min())){const l=u.Un.getLastRemoteSnapshotVersion(a).next(e=>u.Un.setTargetsMetadata(a,a.currentSequenceNumber,h));c.push(l)}return g1.waitFor(c).next(()=>e.apply(a)).next(()=>u.Us.Ts(a,t)).next(()=>t)}).then(e=>(u.Ms=d,e))}function tM(e,s,t){let n=iO();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=eO;return t.forEach((e,t)=>{const n=r.get(e);t.isNoDocument()&&t.version.isEqual(Hx.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):kx("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),i})}function nM(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Un.getTargetData(t,r).next(e=>e?(n=e,g1.resolve(n)):i.Un.allocateTargetId(t).next(e=>(n=new x1(r,e,0,t.currentSequenceNumber),i.Un.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Ms.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ms=i.Ms.insert(e.targetId,e),i.$s.set(r,e.targetId)),e})}async function rM(e,t,n){const r=e,i=r.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!w1(e))throw e;kx("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ms=r.Ms.remove(t),r.$s.delete(i.target)}function iM(e,n,r){const i=e;let s=Hx.min(),o=iO();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.$s.get(n);return void 0!==i?g1.resolve(r.Ms.get(i)):r.Un.getTargetData(t,n)}(i,t,lP(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Un.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.Os.As(t,n,r?s:Hx.min(),r?o:iO())).next(e=>({documents:e,Ks:o})))}function sM(e,t){const n=e,r=n.Un,i=n.Ms.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Tt(e,t).next(e=>e?e.target:null))}function oM(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let i=eO,s=D1(n);const o=FD(t),a=IDBKeyRange.lowerBound(s,!0);return o.Qt({index:JO.readTimeIndex,range:a},(e,t)=>{var n=P1(r.O,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({ws:i,readTime:M1(s)}))}(n.Bs,e,n.Fs)).then(({ws:e,readTime:t})=>(n.Fs=t,e))}class aM{constructor(e){this.O=e,this.Ws=new Map,this.zs=new Map}getBundleMetadata(e,t){return g1.resolve(this.Ws.get(t))}saveBundleMetadata(e,t){return this.Ws.set(t.id,{id:t.id,version:t.version,createTime:wO(t.createTime)}),g1.resolve()}getNamedQuery(e,t){return g1.resolve(this.zs.get(t))}saveNamedQuery(e,t){return this.zs.set(t.name,{name:(t=t).name,query:V1(t.bundledQuery),readTime:wO(t.readTime)}),g1.resolve()}}class cM{constructor(){this.overlays=new HP(gR.comparator),this.Hs=new Map}getOverlay(e,t){return g1.resolve(this.overlays.get(t))}saveOverlays(t,n,e){return e.forEach(e=>{this.Yt(t,n,e)}),g1.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Hs.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Hs.delete(n)),g1.resolve()}getOverlaysForCollection(e,t,n){const r=new Map,i=t.length+1,s=new gR(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return g1.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new HP((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=new Map,i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=new Map,a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(t,e)),!(o.size>=r)););return g1.resolve(o)}Yt(e,t,n){if(null!==n){var r=this.overlays.get(n.key);null!==r&&this.Hs.get(r.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new N1(t,n));let e=this.Hs.get(t);void 0===e&&(e=new Set,this.Hs.set(t,e)),e.add(n.key)}}}class lM{constructor(){this.Js=new JP(uM.Ys),this.Xs=new JP(uM.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(e,t){var n=new uM(e,t);this.Js=this.Js.add(n),this.Xs=this.Xs.add(n)}ti(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ei(new uM(e,t))}ni(e,t){e.forEach(e=>this.removeReference(e,t))}si(e){const t=new gR(new Zx([])),n=new uM(t,e),r=new uM(t,e+1),i=[];return this.Xs.forEachInRange([n,r],e=>{this.ei(e),i.push(e.key)}),i}ii(){this.Js.forEach(e=>this.ei(e))}ei(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}ri(e){var t=new gR(new Zx([])),n=new uM(t,e),t=new uM(t,e+1);let r=iO();return this.Xs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new uM(e,0),t=this.Js.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class uM{constructor(e,t){this.key=e,this.oi=t}static Ys(e,t){return gR.comparator(e.key,t.key)||$x(e.oi,t.oi)}static Zs(e,t){return $x(e.oi,t.oi)||gR.comparator(e.key,t.key)}}class hM{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.gs=[],this.ci=1,this.ui=new JP(uM.Ys)}checkEmpty(e){return g1.resolve(0===this.gs.length)}addMutationBatch(e,t,n,r){var i=this.ci;this.ci++,0<this.gs.length&&this.gs[this.gs.length-1];var s=new C1(i,t,n,r);this.gs.push(s);for(const t of r)this.ui=this.ui.add(new uM(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return g1.resolve(s)}lookupMutationBatch(e,t){return g1.resolve(this.ai(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.hi(t+1),n=n<0?0:n;return g1.resolve(this.gs.length>n?this.gs[n]:null)}getHighestUnacknowledgedBatchId(){return g1.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(e){return g1.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new uM(t,0),r=new uM(t,Number.POSITIVE_INFINITY),i=[];return this.ui.forEachInRange([n,r],e=>{var t=this.ai(e.oi);i.push(t)}),g1.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new JP($x);return t.forEach(e=>{var t=new uM(e,0),n=new uM(e,Number.POSITIVE_INFINITY);this.ui.forEachInRange([t,n],e=>{r=r.add(e.oi)})}),g1.resolve(this.li(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;gR.isDocumentKey(i)||(i=i.child(""));var s=new uM(new gR(i),0);let o=new JP($x);return this.ui.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.oi)),!0)},s),g1.resolve(this.li(o))}li(e){const n=[];return e.forEach(e=>{var t=this.ai(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){xx(0===this.fi(r.batchId,"removed")),this.gs.shift();let i=this.ui;return g1.forEach(r.mutations,e=>{var t=new uM(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ui=i})}Qe(e){}containsKey(e,t){var n=new uM(t,0),n=this.ui.firstAfterOrEqual(n);return g1.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.gs.length,g1.resolve()}fi(e,t){return this.hi(e)}hi(e){return 0===this.gs.length?0:e-this.gs[0].batchId}ai(e){var t=this.hi(e);return t<0||t>=this.gs.length?null:this.gs[t]}}class dM{constructor(e){this.di=e,this.docs=new HP(gR.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.di(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return g1.resolve(n?n.document.mutableCopy():RR.newInvalidDocument(t))}getEntries(e,t){let n=eO;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():RR.newInvalidDocument(e))}),g1.resolve(n)}getAll(e,t,n){let r=eO;const i=new gR(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||i.readTime.compareTo(n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return g1.resolve(r)}_i(e,t){return g1.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new pM(this)}getSize(e){return g1.resolve(this.size)}}class pM extends OD{constructor(e){super(),this.Tn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Tn.addEntry(n,t)):this.Tn.removeEntry(e)}),g1.waitFor(r)}getFromCache(e,t){return this.Tn.getEntry(e,t)}getAllFromCache(e,t){return this.Tn.getEntries(e,t)}}class fM{constructor(e){this.persistence=e,this.wi=new PD(e=>UR(e),qR),this.lastRemoteSnapshotVersion=Hx.min(),this.highestTargetId=0,this.mi=0,this.gi=new lM,this.targetCount=0,this.yi=wD.He()}forEachTarget(e,n){return this.wi.forEach((e,t)=>n(t)),g1.resolve()}getLastRemoteSnapshotVersion(e){return g1.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g1.resolve(this.mi)}allocateTargetId(e){return this.highestTargetId=this.yi.next(),g1.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.mi&&(this.mi=t),g1.resolve()}Ze(e){this.wi.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.yi=new wD(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}addTargetData(e,t){return this.Ze(t),this.targetCount+=1,g1.resolve()}updateTargetData(e,t){return this.Ze(t),g1.resolve()}removeTargetData(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),--this.targetCount,g1.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.wi.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.wi.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),g1.waitFor(o).next(()=>s)}getTargetCount(e){return g1.resolve(this.targetCount)}getTargetData(e,t){var n=this.wi.get(t)||null;return g1.resolve(n)}addMatchingKeys(e,t,n){return this.gi.ti(t,n),g1.resolve()}removeMatchingKeys(t,e,n){this.gi.ni(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),g1.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.gi.si(t),g1.resolve()}getMatchingKeysForTargetId(e,t){var n=this.gi.ri(t);return g1.resolve(n)}containsKey(e,t){return g1.resolve(this.gi.containsKey(t))}}class gM{constructor(e,t){this.pi={},this.overlays={},this.Nn=new Bx(0),this.xn=!1,this.xn=!0,this.referenceDelegate=e(this),this.Un=new fM(this),this.indexManager=new iD,this.qn=(e=e=>this.referenceDelegate.Ii(e),new dM(e)),this.O=new R1(t),this.Kn=new aM(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cM,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.pi[e.toKey()];return n||(n=new hM(t,this.referenceDelegate),this.pi[e.toKey()]=n),n}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(e,t,n){kx("MemoryPersistence","Starting transaction:",e);const r=new mM(this.Nn.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.Ti(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(t,n){return g1.or(Object.values(this.pi).map(e=>()=>e.containsKey(t,n)))}}class mM extends f1{constructor(e){super(),this.currentSequenceNumber=e}}class vM{constructor(e){this.persistence=e,this.Ri=new lM,this.Pi=null}static bi(e){return new vM(e)}get vi(){if(this.Pi)return this.Pi;throw Nx()}addReference(e,t,n){return this.Ri.addReference(n,t),this.vi.delete(n.toString()),g1.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.vi.add(n.toString()),g1.resolve()}markPotentiallyOrphaned(e,t){return this.vi.add(t.toString()),g1.resolve()}removeTarget(e,t){this.Ri.si(t.targetId).forEach(e=>this.vi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.vi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Pi=new Set}Ti(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g1.forEach(this.vi,e=>{const t=gR.fromPath(e);return this.Vi(n,t).next(e=>{e||r.removeEntry(t,Hx.min())})}).next(()=>(this.Pi=null,r.apply(n)))}updateLimboDocument(e,t){return this.Vi(e,t).next(e=>{e?this.vi.delete(t.toString()):this.vi.add(t.toString())})}Ii(e){return 0}Vi(e,t){return g1.or([()=>g1.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}function yM(e,t){return`firestore_clients_${e}_${t}`}function _M(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function wM(e,t){return`firestore_targets_${e}_${t}`}class bM{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Si(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Px(r.error.code,r.error.message))),s?new bM(e,t,r.state,i):(Sx("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class IM{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Si(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Px(n.error.code,n.error.message))),i?new IM(e,n.state,r):(Sx("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class TM{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Si(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sO;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=fR(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new TM(e,i):(Sx("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class EM{constructor(e,t){this.clientId=e,this.onlineState=t}static Si(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new EM(t.clientId,t.onlineState):(Sx("SharedClientState",`Failed to parse online state: ${e}`),null)}}class kM{constructor(){this.activeTargetIds=sO}Ci(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ni(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Di(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class SM{constructor(e,t,n,r,i){this.window=e,this.Sn=t,this.persistenceKey=n,this.xi=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new HP($x),this.started=!1,this.$i=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Fi=yM(this.persistenceKey,this.xi),this.Bi=`firestore_sequence_number_${this.persistenceKey}`,this.Mi=this.Mi.insert(this.xi,new kM),this.Li=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Ki=`firestore_online_state_${this.persistenceKey}`,this.Gi=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.ki)}static Vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.ds();for(const n of e)if(n!==this.xi){const e=this.getItem(yM(this.persistenceKey,n));var t;!e||(t=TM.Si(n,e))&&(this.Mi=this.Mi.insert(t.clientId,t))}this.ji();const n=this.storage.getItem(this.Ki);if(n){const e=this.Qi(n);e&&this.Wi(e)}for(const e of this.$i)this.Oi(e);this.$i=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Bi,JSON.stringify(e))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(n){let r=!1;return this.Mi.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Hi(e,"pending")}updateMutationState(e,t,n){this.Hi(e,t,n),this.Ji(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(wM(this.persistenceKey,e)))||(n=IM.Si(e,n))&&(t=n.state)),this.Yi.Ci(e),this.ji(),t}removeLocalQueryTarget(e){this.Yi.Ni(e),this.ji()}isLocalQueryTarget(e){return this.Yi.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wM(this.persistenceKey,e))}updateQueryState(e,t,n){this.Xi(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Ji(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Zi(e)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return kx("SharedClientState","READ",e,t),t}setItem(e,t){kx("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){kx("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Oi(e){const r=e;r.storageArea===this.storage&&(kx("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.Fi?this.Sn.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Li.test(r.key)){if(null==r.newValue){var e=this.er(r.key);return this.nr(e,null)}e=this.sr(r.key,r.newValue);if(e)return this.nr(e.clientId,e)}else if(this.Ui.test(r.key)){if(null!==r.newValue){var t=this.ir(r.key,r.newValue);if(t)return this.rr(t)}}else if(this.qi.test(r.key)){if(null!==r.newValue){t=this.cr(r.key,r.newValue);if(t)return this.ur(t)}}else if(r.key===this.Ki){if(null!==r.newValue){var n=this.Qi(r.newValue);if(n)return this.Wi(n)}}else if(r.key===this.Bi){n=function(e){let t=Bx.A;if(null!=e)try{var n=JSON.parse(e);xx("number"==typeof n),t=n}catch(e){Sx("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue);n!==Bx.A&&this.sequenceNumberHandler(n)}else if(r.key===this.Gi)return this.syncEngine.ar()}else this.$i.push(r)}):Sx("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(e,t,n){const r=new bM(this.currentUser,e,t,n),i=_M(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Di())}Ji(e){var t=_M(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Zi(e){var t={clientId:this.xi,onlineState:e};this.storage.setItem(this.Ki,JSON.stringify(t))}Xi(e,t,n){const r=wM(this.persistenceKey,e),i=new IM(e,t,n);this.setItem(r,i.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(e){var t=this.Li.exec(e);return t?t[1]:null}sr(e,t){var n=this.er(e);return TM.Si(n,t)}ir(e,t){var n=this.Ui.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return bM.Si(new bx(n),r,t)}cr(e,t){var n=this.qi.exec(e),n=Number(n[1]);return IM.Si(n,t)}Qi(e){return EM.Si(e)}async rr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.hr(e.batchId,e.state,e.error);kx("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}ur(e){return this.syncEngine.lr(e.targetId,e.state,e.error)}nr(e,t){const n=t?this.Mi.insert(e,t):this.Mi.remove(e),r=this.zi(this.Mi),i=this.zi(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.dr(s,o).then(()=>{this.Mi=n})}Wi(e){this.Mi.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}zi(e){let n=sO;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class CM{constructor(){this._r=new kM,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this._r.Ci(e),this.wr[e]||"not-current"}updateQueryState(e,t,n){this.wr[e]=t}removeLocalQueryTarget(e){this._r.Ni(e)}isLocalQueryTarget(e){return this._r.activeTargetIds.has(e)}clearQueryState(e){delete this.wr[e]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(e){return this._r.activeTargetIds.has(e)}start(){return this._r=new kM,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class AM{mr(e){}shutdown(){}}class NM{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(e){this.Er.push(e)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){kx("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Er)e(0)}Ir(){kx("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Er)e(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const xM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class RM{constructor(e){this.Ar=e.Ar,this.Rr=e.Rr}Pr(e){this.br=e}vr(e){this.Vr=e}onMessage(e){this.Sr=e}close(){this.Rr()}send(e){this.Ar(e)}Dr(){this.br()}Cr(e){this.Vr(e)}Nr(e){this.Sr(e)}}class PM extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.kr=t+"://"+e.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(t,e,n,r,i){const s=this.$r(t,e);kx("RestConnection","Sending: ",s,n);var o={};return this.Fr(o,r,i),this.Br(t,s,o,n).then(e=>(kx("RestConnection","Received: ",e),e),e=>{throw Cx("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}Lr(e,t,n,r,i){return this.Mr(e,t,n,r,i)}Fr(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Ix,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}$r(e,t){var n=xM[e];return`${this.kr}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Br(a,t,n,r){return new Promise((i,s)=>{const o=new _x;o.listenOnce(px.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case dx.NO_ERROR:var e=o.getResponseJson();kx("Connection","XHR received:",JSON.stringify(e)),i(e);break;case dx.TIMEOUT:kx("Connection",'RPC "'+a+'" timed out'),s(new Px(Rx.DEADLINE_EXCEEDED,"Request time out"));break;case dx.HTTP_ERROR:var t,n=o.getStatus();if(kx("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(Rx).indexOf(r)?r:Rx.UNKNOWN,s(new Px(t,a.message))):s(new Px(Rx.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Px(Rx.UNAVAILABLE,"Connection failed."));break;default:Nx()}}finally{kx("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}Ur(e,t,n){const r=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new sx,s=hx(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new vx({})),this.Fr(o.initMessageHeaders,t,n),od()||ld()||0<=sd().indexOf("Electron/")||ud()||0<=sd().indexOf("MSAppHost/")||cd()||(o.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");kx("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let l=!1,u=!1;const h=new RM({Ar:e=>{u?kx("Connection","Not sending because WebChannel is closed:",e):(l||(kx("Connection","Opening WebChannel transport."),c.open(),l=!0),kx("Connection","WebChannel sending:",e),c.send(e))},Rr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(c,yx.EventType.OPEN,()=>{u||kx("Connection","WebChannel transport opened.")}),d(c,yx.EventType.CLOSE,()=>{u||(u=!0,kx("Connection","WebChannel transport closed"),h.Cr())}),d(c,yx.EventType.ERROR,e=>{u||(u=!0,Cx("Connection","WebChannel transport errored:",e),h.Cr(new Px(Rx.UNAVAILABLE,"The operation could not be completed")))}),d(c,yx.EventType.MESSAGE,n=>{if(!u){var e=n.data[0];xx(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){kx("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=ux[e];if(void 0!==t)return GP(t)}(n),t=r.message;void 0===e&&(e=Rx.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),u=!0,h.Cr(new Px(e,t)),c.close()}else kx("Connection","WebChannel received:",e),h.Nr(e)}}),d(s,fx.STAT_EVENT,e=>{e.stat===gx?kx("Connection","Detected buffering proxy"):e.stat===mx&&kx("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.Dr()},0),h}}function OM(){return"undefined"!=typeof window?window:null}function DM(){return"undefined"!=typeof document?document:null}function MM(e){return new vO(e,!0)}class LM{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Sn=e,this.timerId=t,this.qr=n,this.Kr=r,this.Gr=i,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(e){this.cancel();var t=Math.floor(this.jr+this.Jr()),n=Math.max(0,Date.now()-this.Wr),r=Math.max(0,t-n);0<r&&kx("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.jr} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,r,()=>(this.Wr=Date.now(),e())),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class FM{constructor(e,t,n,r,i,s,o,a){this.Sn=e,this.Xr=n,this.Zr=r,this.eo=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new LM(e,t)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,()=>this.lo()))}fo(e){this._o(),this.stream.send(e)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(e,t){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==e?this.ro.reset():t&&t.code===Rx.RESOURCE_EXHAUSTED?(Sx(t.toString()),Sx("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):t&&t.code===Rx.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.vr(t)}mo(){}auth(){this.state=1;const e=this.yo(this.no),n=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.no===n&&this.po(e,t)},t=>{e(()=>{var e=new Px(Rx.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Io(e)})})}po(e,t){const n=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr(()=>{n(()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,()=>(this.co()&&(this.state=3),Promise.resolve())),this.listener.Pr()))}),this.stream.vr(e=>{n(()=>this.Io(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}uo(){this.state=5,this.ro.Hr(async()=>{this.state=0,this.start()})}Io(e){return kx("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}yo(t){return e=>{this.Sn.enqueueAndForget(()=>this.no===t?e():(kx("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class UM extends FM{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.O=i}Eo(e,t){return this.eo.Ur("Listen",e,t)}onMessage(e){this.ro.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:Nx(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.N?(xx(void 0===p||"string"==typeof p),rR.fromBase64String(p||"")):(xx(void 0===p||p instanceof Uint8Array),rR.fromUint8Array(p||new Uint8Array))),o=t.targetChange.cause,a=o&&(a=void 0===(p=o).code?Rx.UNKNOWN:GP(p.code),new Px(a,p.message||""));n=new uO(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var a=EO(e,c.document.name),l=wO(c.document.updateTime),u=new xR({mapValue:{fields:c.document.fields}}),l=RR.newFoundDocument(a,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new cO(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=EO(e,u.document),l=u.readTime?wO(u.readTime):Hx.min(),l=RR.newNoDocument(c,l),u=u.removedTargetIds||[];n=new cO([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=EO(e,h.document),h=h.removedTargetIds||[];n=new cO([],h,d,null)}else{if(!("filter"in t))return Nx();{t.filter;const e=t.filter;e.targetId;h=e.count||0,d=new zP(h),h=e.targetId;n=new lO(h,d)}}var a,p;return n}(this.O,e),n=function(e){if(!("targetChange"in e))return Hx.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?wO(t.readTime):Hx.min()}(e);return this.listener.To(t,n)}Ao(e){const t={};t.database=CO(this.O),t.addTarget=function(e,t){let n;var r=t.target;return n=jR(r)?{documents:OO(e,r)}:{query:DO(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=_O(e,t.resumeToken):0<t.snapshotVersion.compareTo(Hx.min())&&(n.readTime=yO(e,t.snapshotVersion.toTimestamp())),n}(this.O,e);var n,r,r=(this.O,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nx()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.fo(t)}Ro(e){const t={};t.database=CO(this.O),t.removeTarget=e,this.fo(t)}}class qM extends FM{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.O=i,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(e,t){return this.eo.Ur("Write",e,t)}onMessage(e){if(xx(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(xx(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?wO(e.updateTime):wO(t);return n.isEqual(Hx.min())&&(n=wO(t)),new xP(n,e.transformResults||[])}(e,i))):[]),n=wO(e.commitTime);return this.listener.Vo(n,t)}var r,i;return xx(!e.writeResults||0===e.writeResults.length),this.Po=!0,this.listener.So()}Do(){const e={};e.database=CO(this.O),this.fo(e)}vo(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>RO(this.O,e))};this.fo(t)}}class jM extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.eo=n,this.O=r,this.Co=!1}No(){if(this.Co)throw new Px(Rx.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(n,r,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.eo.Mr(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Rx.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Px(Rx.UNKNOWN,e.toString())})}Lr(n,r,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.eo.Lr(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Rx.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Px(Rx.UNKNOWN,e.toString())})}terminate(){this.Co=!0}}class VM{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve())))}Bo(e){"Online"===this.state?this.$o("Unknown"):(this.xo++,1<=this.xo&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.$o("Offline")))}set(e){this.Lo(),this.xo=0,"Online"===e&&(this.Oo=!1),this.$o(e)}$o(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Fo(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(Sx(t),this.Oo=!1):kx("OnlineStateTracker",t)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class BM{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=i,this.jo.mr(e=>{n.enqueueAndForget(async()=>{JM(this)&&(kx("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Ko.add(4),await $M(t),t.Qo.set("Unknown"),t.Ko.delete(4),await KM(t)}(this))})}),this.Qo=new VM(n,r)}}async function KM(e){if(JM(e))for(const t of e.Go)await t(!0)}async function $M(e){for(const t of e.Go)await t(!1)}function zM(e,t){const n=e;n.qo.has(t.targetId)||(n.qo.set(t.targetId,t),YM(n)?QM(n):oL(n).co()&&GM(n,t))}function WM(e,t){const n=e,r=oL(n);n.qo.delete(t),r.co()&&HM(n,t),0===n.qo.size&&(r.co()?r.ho():JM(n)&&n.Qo.set("Unknown"))}function GM(e,t){e.Wo.Z(t.targetId),oL(e).Ao(t)}function HM(e,t){e.Wo.Z(t),oL(e).Ro(t)}function QM(t){t.Wo=new dO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qo.get(e)||null}),oL(t).start(),t.Qo.Mo()}function YM(e){return JM(e)&&!oL(e).oo()&&0<e.qo.size}function JM(e){return 0===e.Ko.size}function XM(e){e.Wo=void 0}async function ZM(e,t,n){if(!w1(t))throw t;e.Ko.add(1),await $M(e),e.Qo.set("Offline"),n=n||(()=>ZD(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{kx("RemoteStore","Retrying IndexedDB access"),await n(),e.Ko.delete(1),await KM(e)})}function eL(t,n){return n().catch(e=>ZM(t,e,n))}async function tL(e){const t=e,n=aL(t);let r=0<t.Uo.length?t.Uo[t.Uo.length-1].batchId:-1;for(;JM(i=t)&&i.Uo.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.gs.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Uo.length&&n.ho();break}r=e.batchId,function(e,t){e.Uo.push(t);const n=aL(e);n.co()&&n.bo&&n.vo(t.mutations)}(t,e)}catch(e){await ZM(t,e)}var i;nL(t)&&rL(t)}function nL(e){return JM(e)&&!aL(e).oo()&&0<e.Uo.length}function rL(e){aL(e).start()}async function iL(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),kx("RemoteStore","RemoteStore received new credentials");var r=JM(n);n.Ko.add(3),await $M(n),r&&n.Qo.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ko.delete(3),await KM(n)}async function sL(e,t){const n=e;t?(n.Ko.delete(2),await KM(n)):(n.Ko.add(2),await $M(n),n.Qo.set("Unknown"))}function oL(t){return t.zo||(t.zo=function(e,t,n){const r=e;return r.No(),new UM(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Pr:(async function(n){n.qo.forEach((e,t)=>{GM(n,e)})}).bind(null,t),vr:(async function(e,t){XM(e),YM(e)?(e.Qo.Bo(t),QM(e)):e.Qo.set("Unknown")}).bind(null,t),To:(async function(e,r,t){if(e.Qo.set("Online"),r instanceof uO&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qo.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qo.delete(n),e.Wo.removeTarget(n))}(e)}catch(t){kx("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await ZM(e,t)}else if(r instanceof cO?e.Wo.ct(r):r instanceof lO?e.Wo._t(r):e.Wo.ht(r),!t.isEqual(Hx.min()))try{const r=await ZD(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Wo.yt(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qo.get(t);n&&r.qo.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.qo.get(e);var n;t&&(r.qo.set(e,t.withResumeToken(rR.EMPTY_BYTE_STRING,t.snapshotVersion)),HM(r,e),n=new x1(t.target,e,1,t.sequenceNumber),GM(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){kx("RemoteStore","Failed to raise snapshot:",r),await ZM(e,r)}}).bind(null,t)}),t.Go.push(async e=>{e?(t.zo.ao(),YM(t)?QM(t):t.Qo.set("Unknown")):(await t.zo.stop(),XM(t))})),t.zo}function aL(t){return t.Ho||(t.Ho=function(e,t,n){const r=e;return r.No(),new qM(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Pr:(async function(e){aL(e).Do()}).bind(null,t),vr:(async function(e,t){t&&aL(e).bo&&await async function(e,t){if(WP(n=t.code)&&n!==Rx.ABORTED){const n=e.Uo.shift();aL(e).ao(),await eL(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await tL(e)}var n}(e,t),nL(e)&&rL(e)}).bind(null,t),So:(async function(e){const t=aL(e);for(const n of e.Uo)t.vo(n.mutations)}).bind(null,t),Vo:(async function(e,t,n){const r=e.Uo.shift(),i=A1.from(r,t,n);await eL(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await tL(e)}).bind(null,t)}),t.Go.push(async e=>{e?(t.Ho.ao(),await tL(t)):(await t.Ho.stop(),0<t.Uo.length&&(kx("RemoteStore",`Stopping write stream with ${t.Uo.length} pending writes`),t.Uo=[]))})),t.Ho}class cL{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ox,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new cL(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Px(Rx.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lL(e,t){if(Sx("AsyncQueue",`${t}: ${e}`),w1(e))return new Px(Rx.UNAVAILABLE,`${t}: ${e}`);throw e}class uL{constructor(n){this.comparator=n?(e,t)=>n(e,t)||gR.comparator(e.key,t.key):(e,t)=>gR.comparator(e.key,t.key),this.keyedMap=tO,this.sortedSet=new HP(this.comparator)}static emptySet(e){return new uL(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uL))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new uL;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class hL{constructor(){this.Jo=new HP(gR.comparator)}track(e){var t=e.doc.key,n=this.Jo.get(t);!n||0!==e.type&&3===n.type?this.Jo=this.Jo.insert(t,e):3===e.type&&1!==n.type?this.Jo=this.Jo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jo=this.Jo.remove(t):1===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):Nx()}Yo(){const n=[];return this.Jo.inorderTraversal((e,t)=>{n.push(t)}),n}}class dL{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new dL(e,t,uL.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hP(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class pL{constructor(){this.Xo=void 0,this.listeners=[]}}class fL{constructor(){this.queries=new PD(e=>dP(e),hP),this.onlineState="Unknown",this.Zo=new Set}}async function gL(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new pL),i)try{s.Xo=await n.onListen(r)}catch(e){const n=lL(e,`Initialization of query '${pP(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.tc(n.onlineState),!s.Xo||t.ec(s.Xo)&&vL(n)}async function mL(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function vL(e){e.Zo.forEach(e=>{e.next()})}class yL{constructor(e,t,n){this.query=e,this.nc=t,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=n||{}}ec(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new dL(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.sc?this.rc(e)&&(this.nc.next(e),t=!0):this.oc(e,this.onlineState)&&(this.cc(e),t=!0),this.ic=e,t}onError(e){this.nc.error(e)}tc(e){this.onlineState=e;let t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}oc(e,t){return!e.fromCache||!(this.options.uc&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}rc(e){if(0<e.docChanges.length)return!0;var t=this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}cc(e){e=dL.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}class _L{constructor(e,t){this.payload=e,this.byteLength=t}ac(){return"metadata"in this.payload}}class wL{constructor(e){this.O=e}Gs(e){return EO(this.O,e)}js(e){return e.metadata.exists?xO(this.O,e.document,!1):RR.newNoDocument(this.Gs(e.metadata.name),this.Qs(e.metadata.readTime))}Qs(e){return wO(e)}}class bL{constructor(e,t,n){this.hc=e,this.localStore=t,this.O=n,this.queries=[],this.documents=[],this.progress=IL(e)}lc(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}fc(e){const t=new Map,n=new wL(this.O);for(const i of e)if(i.metadata.queries){const e=n.Gs(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||iO()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=iO(),o=eO;for(const e of n){const n=t.Gs(e.metadata.name);e.document&&(s=s.add(n));const l=t.js(e);l.setReadTime(t.Qs(e.metadata.readTime)),o=o.insert(n,l)}const a=i.Bs.newChangeBuffer({trackRemovals:!0}),c=await nM(i,(r=r,lP(nP(Zx.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>tM(t,a,o).next(e=>(a.apply(t),e)).next(e=>i.Un.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Un.addMatchingKeys(t,s,c.targetId)).next(()=>i.Us.Ts(t,e)).next(()=>e)))}(this.localStore,new wL(this.O),this.documents,this.hc.id),t=this.fc(this.documents);for(const e of this.queries)await async function(e,n,r=iO()){const i=await nM(e,lP(V1(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=wO(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Kn.saveNamedQuery(e,n);t=i.withResumeToken(rR.EMPTY_BYTE_STRING,t);return s.Ms=s.Ms.insert(t.targetId,t),s.Un.updateTargetData(e,t).next(()=>s.Un.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Un.addMatchingKeys(e,r,i.targetId)).next(()=>s.Kn.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new WD(Object.assign({},this.progress),e)}}function IL(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class TL{constructor(e){this.key=e}}class EL{constructor(e){this.key=e}}class kL{constructor(e,t){this.query=e,this.dc=t,this._c=null,this.current=!1,this.wc=iO(),this.mutatedKeys=iO(),this.mc=gP(e),this.gc=new uL(this.mc)}get yc(){return this.dc}Ic(e,t){const a=t?t.Ec:new hL,c=(t||this).gc;let l=(t||this).mutatedKeys,u=c,h=!1;const d=rP(this.query)&&c.size===this.query.limit?c.last():null,p=iP(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=fP(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.Tc(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.mc(r,d)||p&&this.mc(r,p)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||p)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),rP(this.query)||iP(this.query))for(;u.size>this.query.limit;){const e=rP(this.query)?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{gc:u,Ec:a,ks:h,mutatedKeys:l}}Tc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;const i=e.Ec.Yo();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nx()}};return n(e)-n(t)}(e.type,t.type)||this.mc(e.doc,t.doc)),this.Ac(n);var s=t?this.Rc():[],o=0===this.wc.size&&this.current?1:0,a=o!==this._c;return this._c=o,0!==i.length||a?{snapshot:new dL(this.query,e.gc,r,i,e.mutatedKeys,0==o,a,!1),Pc:s}:{Pc:s}}tc(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new hL,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}Ac(e){e&&(e.addedDocuments.forEach(e=>this.dc=this.dc.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.dc=this.dc.delete(e)),this.current=e.current)}Rc(){if(!this.current)return[];const t=this.wc;this.wc=iO(),this.gc.forEach(e=>{this.bc(e.key)&&(this.wc=this.wc.add(e.key))});const n=[];return t.forEach(e=>{this.wc.has(e)||n.push(new EL(e))}),this.wc.forEach(e=>{t.has(e)||n.push(new TL(e))}),n}vc(e){this.dc=e.Ks,this.wc=iO();var t=this.Ic(e.documents);return this.applyChanges(t,!0)}Vc(){return dL.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class SL{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class CL{constructor(e){this.key=e,this.Sc=!1}}class AL{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Dc={},this.Cc=new PD(e=>dP(e),hP),this.Nc=new Map,this.xc=new Set,this.kc=new HP(gR.comparator),this.Oc=new Map,this.Mc=new lM,this.$c={},this.Fc=new Map,this.Bc=wD.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function NL(n,e,t,r){n.Uc=(e,s,t)=>async function(e,t,n){let r=t.view.Ic(s);r.ks&&(r=await iM(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ic(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return UL(e,t.targetId,i.Pc),i.snapshot}(n,e,t);const i=await iM(n.localStore,e,!0),s=new kL(e,i.Ks),o=s.Ic(i.documents),a=aO.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);UL(n,t,c.Pc);var l=new SL(e,t,s);return n.Cc.set(e,l),n.Nc.has(t)?n.Nc.get(t).push(e):n.Nc.set(t,[e]),c.snapshot}async function xL(e,t,n){const r=zL(e);try{const e=await function(e,r){const i=e,s=Gx.now(),t=r.reduce((e,t)=>e.add(t.key),iO());let o;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>i.Us.Es(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=wP(r.transform,e||null);null!=i&&(null==n&&(n=xR.empty()),n.set(r.field,i))}return n||null}(n,o.get(n.key));null!=r&&t.push(new qP(n.key,r,function r(e){const i=[];return Yx(e.fields,(e,t)=>{const n=new tR([e]);if(AR(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new nR(i)}(r.value.mapValue),RP.exists(!0)))}return i.gs.addMutationBatch(n,s,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.$c[e.currentUser.toKey()];r=r||new HP($x),r=r.insert(t,n),e.$c[e.currentUser.toKey()]=r}(r,e.batchId,n),await jL(r,e.changes),await tL(r.remoteStore)}catch(e){const t=lL(e,"Failed to persist write");n.reject(t)}}async function RL(e,t){const r=e;try{const e=await eM(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Oc.get(t);n&&(xx(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Sc=!0:0<e.modifiedDocuments.size?xx(n.Sc):0<e.removedDocuments.size&&(xx(n.Sc),n.Sc=!1))}),await jL(r,e,t)}catch(e){await kD(e)}}function PL(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.Cc.forEach((e,t)=>{var n=t.view.tc(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.tc(n)&&(r=!0)}),r&&vL(t)}(t.eventManager,i),r.length&&t.Dc.To(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function OL(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=g1.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);xx(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),o.next(()=>e.gs.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.gs.performConsistencyCheck(e)).next(()=>i.Us.Es(e,t))})}(n.localStore,t);ML(n,r,null),DL(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await jL(n,e)}catch(e){await kD(e)}}function DL(e,t){(e.Fc.get(t)||[]).forEach(e=>{e.resolve()}),e.Fc.delete(t)}function ML(e,t,n){const r=e;let i=r.$c[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.$c[r.currentUser.toKey()]=i}}function LL(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Nc.get(e))t.Cc.delete(r),n&&t.Dc.qc(r,n);t.Nc.delete(e),t.isPrimaryClient&&t.Mc.si(e).forEach(e=>{t.Mc.containsKey(e)||FL(t,e)})}function FL(e,t){e.xc.delete(t.path.canonicalString());var n=e.kc.get(t);null!==n&&(WM(e.remoteStore,n),e.kc=e.kc.remove(t),e.Oc.delete(n),qL(e))}function UL(e,t,n){for(const r of n)r instanceof TL?(e.Mc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.kc.get(n)||e.xc.has(r)||(kx("SyncEngine","New document in limbo: "+n),e.xc.add(r),qL(e))}(e,r)):r instanceof EL?(kx("SyncEngine","Document no longer in limbo: "+r.key),e.Mc.removeReference(r.key,t),e.Mc.containsKey(r.key)||FL(e,r.key)):Nx()}function qL(e){for(;0<e.xc.size&&e.kc.size<e.maxConcurrentLimboResolutions;){var t=e.xc.values().next().value;e.xc.delete(t);var n=new gR(Zx.fromString(t)),t=e.Bc.next();e.Oc.set(t,new CL(n)),e.kc=e.kc.insert(n,t),zM(e.remoteStore,new x1(lP(nP(n.path)),t,2,Bx.A))}}async function jL(e,t,r){const i=e,s=[],o=[],a=[];i.Cc.isEmpty()||(i.Cc.forEach((e,n)=>{a.push(i.Uc(n,t,r).then(e=>{var t;e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,e.fromCache?"not-current":"current"),s.push(e),t=HD.Ss(n.targetId,e),o.push(t))}))}),await Promise.all(a),i.Dc.To(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>g1.forEach(t,t=>g1.forEach(t.vs,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>g1.forEach(t.Vs,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!w1(e))throw e;kx("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Ms.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Ms=r.Ms.insert(t,i)}}}(i.localStore,o))}async function VL(r,e){const i=r;if($L(i),zL(i),!0===e&&!0!==i.Lc){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await BL(i,r.toArray());i.Lc=!0,await sL(i.remoteStore,!0);for(const r of e)zM(i.remoteStore,r)}else if(!1===e&&!1!==i.Lc){const r=[];let n=Promise.resolve();i.Nc.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(LL(i,t),rM(i.localStore,t,!0))),WM(i.remoteStore,t)}),await n,await BL(i,r),function(){const n=i;n.Oc.forEach((e,t)=>{WM(n.remoteStore,t)}),n.Mc.ii(),n.Oc=new Map,n.kc=new HP(gR.comparator)}(),i.Lc=!1,await sL(i.remoteStore,!1)}}async function BL(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.Nc.get(t);if(u&&0!==u.length){e=await nM(r.localStore,lP(u[0]));for(const t of u){const n=r.Cc.get(t),u=(o=r,a=n,l=c=void 0,l=await iM((c=o).localStore,a.query,!0),l=a.view.vc(l),c.isPrimaryClient&&UL(c,a.targetId,l.Pc),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await sM(r.localStore,t);e=await nM(r.localStore,u),await NL(r,KL(u),t,!1)}i.push(e)}var o,a,c,l;return r.Dc.To(s),i}function KL(e){return tP(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $L(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=RL.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.Oc.get(t);if(r&&r.Sc)return iO().add(r.key);{let e=iO();const r=n.Nc.get(t);if(!r)return e;for(const t of r){const r=n.Cc.get(t);e=e.unionWith(r.view.yc)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Oc.get(t),s=i&&i.key;if(s){let e=new HP(gR.comparator);e=e.insert(s,RR.newNoDocument(s,Hx.min()));const n=iO().add(s),i=new oO(Hx.min(),new Map,new JP($x),e,n);await RL(r,i),r.kc=r.kc.remove(s),r.Oc.delete(t),qL(r)}else await rM(r.localStore,t,!1).then(()=>LL(r,t,n)).catch(kD)}).bind(null,t),t.Dc.To=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.ec(e)&&(r=!0);i.Xo=e}}r&&vL(n)}).bind(null,t.eventManager),t.Dc.qc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function zL(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=OL.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.gs.lookupMutationBatch(t,r).next(e=>(xx(null!==e),n=e.keys(),i.gs.removeMutationBatch(t,e))).next(()=>i.gs.performConsistencyCheck(t)).next(()=>i.Us.Es(t,n))})}(r.localStore,t);ML(r,t,n),DL(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await jL(r,e)}catch(n){await kD(n)}}).bind(null,t),t}class WL{constructor(){this.synchronizeTabs=!1}async initialize(e){this.O=MM(e.databaseInfo.databaseId),this.sharedClientState=this.Gc(e),this.persistence=this.jc(e),await this.persistence.start(),this.gcScheduler=this.Qc(e),this.localStore=this.Wc(e)}Qc(e){return null}Wc(e){return JD(this.persistence,new QD,e.initialUser,this.O)}jc(e){return new gM(vM.bi,this.O)}Gc(e){return new CM}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class GL extends WL{constructor(e,t,n){super(),this.zc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=FD(t);let r=Hx.min();return e.Qt({index:JO.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=M1(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Fs=e})}(this.localStore),await this.zc.initialize(this,e),await zL(this.zc.syncEngine),await tL(this.zc.remoteStore),await this.persistence.Hn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Wc(e){return JD(this.persistence,new QD,e.initialUser,this.O)}Qc(e){var t=this.persistence.referenceDelegate.garbageCollector;return new AD(t,e.asyncQueue)}jc(e){var t=zD(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?dD.withCacheSize(this.cacheSizeBytes):dD.DEFAULT;return new BD(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,OM(),DM(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(e){return new CM}}class HL extends GL{constructor(e,t){super(e,t,!1),this.zc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.zc.syncEngine;this.sharedClientState instanceof SM&&(this.sharedClientState.syncEngine={hr:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.gs;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Ge(t,n).next(e=>e?r.Us.Es(t,e):g1.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await tL(i.remoteStore):"acknowledged"===n||"rejected"===n?(ML(i,t,r||null),DL(i,t),i.localStore.gs.Qe(t)):Nx(),await jL(i,s)):kx("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),lr:(async function(e,t,n,r){const i=e;if(i.Lc)kx("SyncEngine","Ignoring unexpected query state notification.");else if(i.Nc.has(t))switch(n){case"current":case"not-current":{const e=await oM(i.localStore),r=oO.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await jL(i,e,r);break}case"rejected":await rM(i.localStore,t,!0),LL(i,t,r);break;default:Nx()}}).bind(null,t),dr:(async function(e,t,n){const r=$L(e);if(r.Lc){for(const e of t)if(r.Nc.has(e))kx("SyncEngine","Adding an already active target "+e);else{const t=await sM(r.localStore,e),n=await nM(r.localStore,t);await NL(r,KL(t),n.targetId,!1),zM(r.remoteStore,n)}for(const e of n)r.Nc.has(e)&&await rM(r.localStore,e,!1).then(()=>{WM(r.remoteStore,e),LL(r,e)}).catch(kD)}}).bind(null,t),ds:(function(e){return e.localStore.persistence.ds()}).bind(null,t),ar:(async function(e){const t=e;return oM(t.localStore).then(e=>jL(t,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.Hn(async e=>{await VL(this.zc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Gc(e){var t=OM();if(!SM.Vt(t))throw new Px(Rx.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=zD(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new SM(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class QL{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>PL(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){kx("SyncEngine","User change. New user:",t.toKey());const r=await XD(n.localStore,t);n.currentUser=t,(e=n).Fc.forEach(e=>{e.forEach(e=>{e.reject(new Px(Rx.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await jL(n,r.qs)}}).bind(null,this.syncEngine),await sL(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fL}createDatastore(e){var t,n,r,i,s=MM(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new PM(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new jM(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>PL(this.syncEngine,e,0),s=new(NM.Vt()?NM:AM),new BM(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new AL(e,t,n,r,i,s);return o&&(a.Lc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;kx("RemoteStore","RemoteStore shutting down."),t.Ko.add(5),await $M(t),t.jo.shutdown(),t.Qo.set("Unknown")}(this.remoteStore)}}function YL(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class JL{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Hc(this.observer.next,e)}error(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Jc(){this.muted=!0}Hc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class XL{constructor(e,t){this.Yc=e,this.O=t,this.metadata=new Ox,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then(e=>{e&&e.ac()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Yc.cancel()}async getMetadata(){return this.metadata.promise}async Kc(){return await this.getMetadata(),this.Zc()}async Zc(){var e=await this.tu();if(null===e)return null;var t=this.Xc.decode(e),n=Number(t);isNaN(n)&&this.eu(`length string (${t}) is not valid number`);t=await this.nu(n);return new _L(JSON.parse(t),e.length+n)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async tu(){for(;this.su()<0&&!await this.iu(););if(0===this.buffer.length)return null;var e=this.su();e<0&&this.eu("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async nu(e){for(;this.buffer.length<e;)await this.iu()&&this.eu("Reached the end of bundle when more is expected.");var t=this.Xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}eu(e){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${e}`)}async iu(){var e=await this.Yc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ZL{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Px(Rx.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=CO(r.O)+"/documents",i={documents:t.map(e=>TO(r.O,e))},s=await r.Lr("BatchGetDocuments",n,i),o=new Map;s.forEach(e=>{const t=(n=r.O,"found"in(e=e)?function(e,t){xx(!!t.found),t.found.name,t.found.updateTime;var n=EO(e,t.found.name),r=wO(t.found.updateTime),i=new xR({mapValue:{fields:t.found.fields}});return RR.newFoundDocument(n,r,i)}(n,e):"missing"in e?function(e,t){xx(!!t.missing),xx(!!t.readTime);var n=EO(e,t.missing),r=wO(t.readTime);return RR.newNoDocument(n,r)}(n,e):Nx());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{var t=o.get(e.toString());xx(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new KP(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=gR.fromPath(t);this.mutations.push(new $P(n,this.precondition(n)))}),await async function(e,t){const n=e,r=CO(n.O)+"/documents",i={writes:t.map(e=>RO(n.O,e))};await n.Mr("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Nx();t=Hx.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Px(Rx.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?RP.updateTime(t):RP.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return RP.exists(!0);if(t.isEqual(Hx.min()))throw new Px(Rx.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return RP.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class eF{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.ru=5,this.ro=new LM(this.asyncQueue,"transaction_retry")}run(){--this.ru,this.ou()}ou(){this.ro.Hr(async()=>{const t=new ZL(this.datastore),e=this.cu(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.uu(e)}))}).catch(e=>{this.uu(e)})})}cu(e){try{var t=this.updateFunction(e);return!dR(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}uu(e){0<this.ru&&this.au(e)?(--this.ru,this.asyncQueue.enqueueAndForget(()=>(this.ou(),Promise.resolve()))):this.deferred.reject(e)}au(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||!WP(t)}}class tF{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=bx.UNAUTHENTICATED,this.clientId=Kx.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{kx("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(kx("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Px(Rx.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Ox;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=lL(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function nF(e,t){e.asyncQueue.verifyOperationInProgress(),kx("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await XD(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function rF(e,n){e.asyncQueue.verifyOperationInProgress();var t=await iF(e);kx("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>iL(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>iL(n.remoteStore,t)),e.onlineComponents=n}async function iF(e){return e.offlineComponents||(kx("FirestoreClient","Using default OfflineComponentProvider"),await nF(e,new WL)),e.offlineComponents}async function sF(e){return e.onlineComponents||(kx("FirestoreClient","Using default OnlineComponentProvider"),await rF(e,new QL)),e.onlineComponents}function oF(e){return iF(e).then(e=>e.persistence)}function aF(e){return iF(e).then(e=>e.localStore)}function cF(e){return sF(e).then(e=>e.remoteStore)}function lF(e){return sF(e).then(e=>e.syncEngine)}async function uF(e){const t=await sF(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=$L(e);let r,i;const s=n.Cc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Vc();else{const e=await nM(n.localStore,lP(t));n.isPrimaryClient&&zM(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await NL(n,t,r,"current"===s)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.Cc.get(t),i=n.Nc.get(r.targetId);if(1<i.length)return n.Nc.set(r.targetId,i.filter(e=>!hP(e,t))),void n.Cc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await rM(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),WM(n.remoteStore,r.targetId),LL(n,r.targetId)}).catch(kD)):(LL(n,r.targetId),await rM(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function hF(e,t,n={}){const r=new Ox;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new JL({next:e=>{r.enqueueAndForget(()=>mL(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new Px(Rx.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new Px(Rx.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new yL(nP(i.path),e,{includeMetadataChanges:!0,uc:!0});return gL(n,a)}(await uF(e),e.asyncQueue,t,n,r)),r.promise}function dF(e,t,n={}){const r=new Ox;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new JL({next:e=>{n.enqueueAndForget(()=>mL(t,o)),e.fromCache&&"server"===r.source?i.reject(new Px(Rx.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new yL(e,s,{includeMetadataChanges:!0,uc:!0});return gL(t,o)}(await uF(e),e.asyncQueue,t,n,r)),r.promise}function pF(e,t,n,r){const i=(n=n,t=MM(t),s="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return YL(e,void 0);if(e instanceof ArrayBuffer)return YL(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new XL(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=wO(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Kn.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes});r._updateProgress(IL(i));const o=new bL(i,t.localStore,n.O);let e=await n.Kc();for(;e;){const t=await o.lc(e);t&&r._updateProgress(t),e=await n.Kc()}var s=await o.complete();await jL(t,s.ws,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Kn.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress)}catch(t){Cx("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await lF(e),i,r)})}const fF=new Map;function gF(e,t,n){if(!n)throw new Px(Rx.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function mF(e,t,n,r){if(!0===t&&!0===r)throw new Px(Rx.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function vF(e){if(!gR.isDocumentKey(e))throw new Px(Rx.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function yF(e){if(gR.isDocumentKey(e))throw new Px(Rx.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _F(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Nx();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function wF(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new Px(Rx.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=_F(e);throw new Px(Rx.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function bF(e,t){if(t<=0)throw new Px(Rx.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class IF{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Px(Rx.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Px(Rx.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,mF("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class TF{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new IF({}),this._settingsFrozen=!1,e instanceof hR?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Px(Rx.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hR(e.options.projectId)}(e))}get app(){if(!this._app)throw new Px(Rx.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Px(Rx.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new IF(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Mx;switch(e.type){case"gapi":var t=e.client;return xx(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new qx(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Px(Rx.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=fF.get(e);t&&(kx("ComponentProvider","Removing Datastore"),fF.delete(e),t.terminate())}(this),Promise.resolve()}}class EF{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new SF(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new EF(this.firestore,e,this._key)}}class kF{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new kF(this.firestore,e,this._query)}}class SF extends kF{constructor(e,t,n){super(e,t,nP(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new EF(this.firestore,null,new gR(e))}withConverter(e){return new SF(this.firestore,e,this._path)}}function CF(e,t,...n){if(e=$d(e),gF("collection","path",t),e instanceof TF){var r=Zx.fromString(t,...n);return yF(r),new SF(e,null,r)}if(!(e instanceof EF||e instanceof SF))throw new Px(Rx.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Zx.fromString(t,...n));return yF(r),new SF(e.firestore,null,r)}function AF(e,t,...n){if(e=$d(e),gF("doc","path",t=1===arguments.length?Kx.R():t),e instanceof TF){var r=Zx.fromString(t,...n);return vF(r),new EF(e,null,new gR(r))}if(!(e instanceof EF||e instanceof SF))throw new Px(Rx.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Zx.fromString(t,...n));return vF(r),new EF(e.firestore,e instanceof SF?e.converter:null,new gR(r))}function NF(e,t){return e=$d(e),t=$d(t),(e instanceof EF||e instanceof SF)&&(t instanceof EF||t instanceof SF)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function xF(e,t){return e=$d(e),t=$d(t),e instanceof kF&&t instanceof kF&&e.firestore===t.firestore&&hP(e._query,t._query)&&e.converter===t.converter}class RF{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new LM(this,"async_queue_retry"),this.yu=()=>{var e=DM();e&&kx("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ro.Yr()};const e=DM();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.fu){this.fu=!0,this.mu=e||!1;const t=DM();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.yu)}}enqueue(e){if(this.pu(),this.fu)return new Promise(()=>{});const t=new Ox;return this.Iu(()=>this.fu&&this.mu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.lu.push(e),this.Eu()))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(e){if(!w1(e))throw e;kx("AsyncQueue","Operation failed with retryable error: "+e)}0<this.lu.length&&this.ro.Hr(()=>this.Eu())}}Iu(e){var t=this.hu.then(()=>(this.wu=!0,e().catch(e=>{throw this._u=e,this.wu=!1,Sx("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.wu=!1,e))));return this.hu=t}enqueueAfterDelay(e,t,n){this.pu(),-1<this.gu.indexOf(e)&&(t=0);var r=cL.createAndSchedule(this,e,t,n,e=>this.Tu(e));return this.du.push(r),r}pu(){this._u&&Nx()}verifyOperationInProgress(){}async Au(){for(var e;await(e=this.hu),e!==this.hu;);}Ru(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}Pu(t){return this.Au().then(()=>{this.du.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Au()})}bu(e){this.gu.push(e)}Tu(e){var t=this.du.indexOf(e);this.du.splice(t,1)}}function PF(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class OF{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ox,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var DF,MF,LF,FF;class UF extends TF{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new RF,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||jF(this),this._firestoreClient.terminate()}}function qF(e){return e._firestoreClient||jF(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function jF(e){var t,n,r,i,s,o=e._freezeSettings(),o=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",i=e._persistenceKey,s=o,new uR(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new tF(e._authCredentials,e._appCheckCredentials,e._queue,o)}function VF(e,n,r){const i=new Ox;return e.asyncQueue.enqueue(async()=>{try{await nF(e,r),await rF(e,n),i.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===Rx.FAILED_PRECONDITION||t.code===Rx.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}var t}).then(()=>i.promise)}function BF(e){return function(e){const t=new Ox;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;JM(n.remoteStore)||kx("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.gs.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Fc.get(e)||[];r.push(t),n.Fc.set(e,r)}catch(e){const n=lL(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await lF(e),t)),t.promise}(qF(e=wF(e,UF)))}function KF(e){return(n=qF(e=wF(e,UF))).asyncQueue.enqueue(async()=>{const e=await oF(n),t=await cF(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Ko.delete(0),KM(e)}()});var n}function $F(e){return(n=qF(e=wF(e,UF))).asyncQueue.enqueue(async()=>{const e=await oF(n),t=await cF(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Ko.add(0),await $M(e),e.Qo.set("Offline")}()});var n}function zF(t,e){return n=qF(t=wF(t,UF)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Kn.getNamedQuery(e,t))}(await aF(n),r)).then(e=>e?new kF(t,null,e.query):null);var n,r}function WF(e){if(e._initialized||e._terminated)throw new Px(Rx.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class GF{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Px(Rx.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tR(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class HF{constructor(e){this._byteString=e}static fromBase64String(e){try{return new HF(rR.fromBase64String(e))}catch(e){throw new Px(Rx.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new HF(rR.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class QF{constructor(e){this._methodName=e}}class YF{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new Px(Rx.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Px(Rx.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $x(this._lat,e._lat)||$x(this._long,e._long)}}const JF=/^__.*__$/;class XF{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new qP(e,this.data,this.fieldMask,t,this.fieldTransforms):new UP(e,this.data,t,this.fieldTransforms)}}class ZF{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qP(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function eU(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Nx()}}class tU{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.O=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(e){return new tU(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.Nu(e),r}xu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.vu(),r}ku(e){return this.Su({path:void 0,Cu:!0})}Ou(e){return bU(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}Nu(e){if(0===e.length)throw this.Ou("Document fields must not be empty");if(eU(this.Vu)&&JF.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}class nU{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=n||MM(e)}Fu(e,t,n,r=!1){return new tU({Vu:e,methodName:t,$u:n,path:tR.emptyPath(),Cu:!1,Mu:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function rU(e){var t=e._freezeSettings(),n=MM(e._databaseId);return new nU(e._databaseId,!!t.ignoreUndefinedProperties,n)}function iU(e,t,n,r,i,s={}){const o=e.Fu(s.merge||s.mergeFields?2:0,t,n,i);vU("Data must be an object, but it was:",o,r);var a=gU(r,o);let c,l;if(s.merge)c=new nR(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=yU(t,r,n);if(!o.contains(i))throw new Px(Rx.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);IU(e,i)||e.push(i)}c=new nR(e),l=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=o.fieldTransforms;return new XF(new xR(a),c,l)}class sU extends QF{_toFieldTransform(e){if(2!==e.Vu)throw 1===e.Vu?e.Ou(`${this._methodName}() can only appear at the top level of your update data`):e.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof sU}}function oU(e,t,n){return new tU({Vu:3,$u:t.settings.$u,methodName:e._methodName,Cu:n},t.databaseId,t.O,t.ignoreUndefinedProperties)}class aU extends QF{_toFieldTransform(e){return new NP(e.path,new bP)}isEqual(e){return e instanceof aU}}class cU extends QF{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=oU(this,e,!0),n=this.Bu.map(e=>fU(e,t)),r=new IP(n);return new NP(e.path,r)}isEqual(e){return this===e}}class lU extends QF{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=oU(this,e,!0),n=this.Bu.map(e=>fU(e,t)),r=new EP(n);return new NP(e.path,r)}isEqual(e){return this===e}}class uU extends QF{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){var t=new SP(e.O,yP(e.O,this.Lu));return new NP(e.path,t)}isEqual(e){return this===e}}function hU(e,i,s,t){const o=e.Fu(1,i,s);vU("Data must be an object, but it was:",o,t);const a=[],c=xR.empty();Yx(t,(e,t)=>{var n=wU(i,e,s);t=$d(t);var r=o.xu(n);if(t instanceof sU)a.push(n);else{const e=fU(t,r);null!=e&&(a.push(n),c.set(n,e))}});var n=new nR(a);return new ZF(c,n,o.fieldTransforms)}function dU(e,t,n,r,i,s){const o=e.Fu(1,t,n),a=[yU(t,r,n)],c=[i];if(s.length%2!=0)throw new Px(Rx.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)a.push(yU(t,s[p])),c.push(s[p+1]);const l=[],u=xR.empty();for(let f=a.length-1;0<=f;--f)if(!IU(l,a[f])){const t=a[f];var h=$d(h=c[f]);const r=o.xu(t);if(h instanceof sU)l.push(t);else{const e=fU(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new nR(l);return new ZF(u,d,o.fieldTransforms)}function pU(e,t,n,r=!1){return fU(n,e.Fu(r?4:3,t))}function fU(s,e){if(mU(s=$d(s)))return vU("Unsupported field value:",e,s),gU(s,e);if(s instanceof QF)return function(e,t){if(!eU(t.Vu))throw t.Ou(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Ou(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=fU(i,t.ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=$d(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return yP(t.O,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Gx.fromDate(e);return{timestampValue:yO(t.O,n)}}if(e instanceof Gx){n=new Gx(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:yO(t.O,n)}}if(e instanceof YF)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof HF)return{bytesValue:_O(t.O,e._byteString)};if(e instanceof EF){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.Ou(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:bO(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ou(`Unsupported field value: ${_F(e)}`)}(0,e)}function gU(e,r){const i={};return Jx(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Yx(e,(e,t)=>{var n=fU(t,r.Du(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function mU(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Gx||e instanceof YF||e instanceof HF||e instanceof EF||e instanceof QF)}function vU(e,t,n){if(!mU(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=_F(n);throw"an object"===r?t.Ou(e+" a custom object"):t.Ou(e+" "+r)}var i}function yU(e,t,n){if((t=$d(t))instanceof GF)return t._internalPath;if("string"==typeof t)return wU(e,t);throw bU("Field path arguments must be of type string or ",e,!1,void 0,n)}const _U=new RegExp("[~\\*/\\[\\]]");function wU(t,n,r){if(0<=n.search(_U))throw bU(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new GF(...n.split("."))._internalPath}catch(e){throw bU(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function bU(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Px(Rx.INVALID_ARGUMENT,a+e+c)}function IU(e,t){return e.some(e=>e.isEqual(t))}class TU{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new EF(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new EU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(kU("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class EU extends TU{data(){return super.data()}}function kU(e,t){return"string"==typeof t?wU(e,t):(t instanceof GF?t:t._delegate)._internalPath}class SU{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class CU extends TU{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new AU(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(kU("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class AU extends CU{data(e={}){return super.data(e)}}class NU{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SU(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new AU(this._firestore,this._userDataWriter,e.key,e,new SU(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Px(Rx.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new AU(s._firestore,s._userDataWriter,e.doc.key,e.doc,new SU(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new AU(s._firestore,s._userDataWriter,e.doc.key,e.doc,new SU(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nx()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xU(e,t){return e instanceof CU&&t instanceof CU?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof NU&&t instanceof NU&&e._firestore===t._firestore&&xF(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function RU(e){if(iP(e)&&0===e.explicitOrderBy.length)throw new Px(Rx.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class PU{}function OU(e,...t){for(const n of t)e=n._apply(e);return e}class DU extends PU{constructor(e,t,n){super(),this.Uu=e,this.qu=t,this.Ku=n,this.type="where"}_apply(e){var t=rU(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Px(Rx.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){VU(o,s);const t=[];for(const n of o)t.push(jU(r,e,n));a={arrayValue:{values:t}}}else a=jU(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||VU(o,s),a=pU(n,t,o,"in"===s||"not-in"===s);var c=VR.create(i,s,a);return function(e,t){if(t.S()){const r=oP(e);if(null!==r&&!r.isEqual(t.field))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=sP(e);null!==n&&BU(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new Px(Rx.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Px(Rx.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,c),c}(e._query,"where",t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new kF(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new eP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class MU extends PU{constructor(e,t){super(),this.Uu=e,this.Gu=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new Px(Rx.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Px(Rx.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new JR(t,n);return n=i,null!==sP(e=e)||null!==(r=oP(e))&&BU(0,r,n.field),i}(e._query,this.Uu,this.Gu);return new kF(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new eP(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class LU extends PU{constructor(e,t,n){super(),this.type=e,this.ju=t,this.Qu=n}_apply(e){return new kF(e.firestore,e.converter,uP(e._query,this.ju,this.Qu))}}class FU extends PU{constructor(e,t,n){super(),this.type=e,this.Wu=t,this.zu=n}_apply(e){var t,n=qU(e,this.type,this.Wu,this.zu);return new kF(e.firestore,e.converter,(t=e._query,e=n,new eP(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class UU extends PU{constructor(e,t,n){super(),this.type=e,this.Wu=t,this.zu=n}_apply(e){var t,n=qU(e,this.type,this.Wu,this.zu);return new kF(e.firestore,e.converter,(t=e._query,e=n,new eP(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function qU(e,t,n,r){if(n[0]=$d(n[0]),n[0]instanceof TU)return function(e,t,n,r,i){if(!r)throw new Px(Rx.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of cP(e))if(n.field.isKeyField())s.push(TR(t,r.key));else{const e=r.data.field(n.field);if(cR(e))throw new Px(Rx.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new YR(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=rU(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Px(Rx.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const l=i[c];if(o[c].field.isKeyField()){if("string"!=typeof l)throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!aP(e)&&-1!==l.indexOf("/"))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(Zx.fromString(l));if(!gR.isDocumentKey(n))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new gR(n);a.push(TR(t,i))}else{const e=pU(n,r,l);a.push(e)}}return new YR(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function jU(e,t,n){if("string"==typeof(n=$d(n))){if(""===n)throw new Px(Rx.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aP(t)&&-1!==n.indexOf("/"))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(Zx.fromString(n));if(!gR.isDocumentKey(r))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return TR(e,new gR(r))}if(n instanceof EF)return TR(e,n._key);throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_F(n)}.`)}function VU(e,t){if(!Array.isArray(e)||0===e.length)throw new Px(Rx.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new Px(Rx.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function BU(e,t,n){if(!n.isEqual(t))throw new Px(Rx.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class KU{convertValue(e,t="none"){switch(vR(e)){case 0:return null;case 1:return e.booleanValue;case 2:return oR(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(aR(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Nx()}}convertObject(e,n){const r={};return Yx(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new YF(oR(e.latitude),oR(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return cR(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(lR(e));default:return null}}convertTimestamp(e){var t=sR(e);return new Gx(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Zx.fromString(e);xx(jO(n));const r=new hR(n.get(1),n.get(3)),i=new gR(n.popFirst(5));return r.isEqual(t)||Sx(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function $U(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class zU extends KU{constructor(e){super(),this.firestore=e}convertBytes(e){return new HF(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new EF(this.firestore,null,t)}}class WU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rU(e)}set(e,t,n){this._verifyNotCommitted();const r=GU(e,this._firestore),i=$U(r.converter,t,n),s=iU(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,RP.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=GU(e,this._firestore);let s;return s="string"==typeof(t=$d(t))||t instanceof GF?dU(this._dataReader,"WriteBatch.update",i._key,t,n,r):hU(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,RP.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=GU(e,this._firestore);return this._mutations=this._mutations.concat(new KP(t._key,RP.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Px(Rx.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function GU(e,t){if((e=$d(e)).firestore!==t)throw new Px(Rx.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class HU extends KU{constructor(e){super(),this.firestore=e}convertBytes(e){return new HF(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new EF(this.firestore,null,t)}}function QU(t){t=wF(t,EF);const n=wF(t.firestore,UF),e=qF(n),r=new HU(n);return function(e,t){const n=new Ox;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Us.ys(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Px(Rx.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=lL(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await aF(e),t,n)),n.promise}(e,t._key).then(e=>new CU(n,r,t._key,e,new SU(null!==e&&e.hasLocalMutations,!0),t.converter))}function YU(t){t=wF(t,kF);const n=wF(t.firestore,UF),e=qF(n),r=new HU(n);return function(e,t){const n=new Ox;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await iM(e,t,!0),s=new kL(t,i.Ks),o=s.Ic(i.documents),a=s.applyChanges(o,!1);n.resolve(a.snapshot)}catch(e){var r=lL(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await aF(e),t,n)),n.promise}(e,t._query).then(e=>new NU(n,r,t,e))}function JU(e,t,n){e=wF(e,EF);var r=wF(e.firestore,UF),i=$U(e.converter,t,n);return tq(r,[iU(rU(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,RP.none())])}function XU(e,t,n,...r){e=wF(e,EF);var i=wF(e.firestore,UF),s=rU(i);let o;return o="string"==typeof(t=$d(t))||t instanceof GF?dU(s,"updateDoc",e._key,t,n,r):hU(s,"updateDoc",e._key,t),tq(i,[o.toMutation(e._key,RP.exists(!0))])}function ZU(t,...n){var e;t=$d(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||PF(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(PF(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof EF)a=wF(t.firestore,UF),c=nP(t._key.path),o={next:e=>{n[i]&&n[i](nq(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=wF(t,kF);a=wF(l.firestore,UF),c=l._query;const u=new HU(a);o={next:e=>{n[i]&&n[i](new NU(a,u,l,e))},error:n[i+1],complete:n[i+2]},RU(t._query)}return function(e,t,n,r){const i=new JL(r),s=new yL(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>gL(await uF(e),s)),()=>{i.Jc(),e.asyncQueue.enqueueAndForget(async()=>mL(await uF(e),s))}}(qF(a),c,s,o)}function eq(e,t){return function(e,t){const n=new JL(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zo.add(t),t.next()}(await uF(e),n)),()=>{n.Jc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zo.delete(t)}(await uF(e),n))}}(qF(e=wF(e,UF)),PF(t)?t:{next:t})}function tq(e,t){return function(e,t){const n=new Ox;return e.asyncQueue.enqueueAndForget(async()=>xL(await lF(e),t,n)),n.promise}(qF(e),t)}function nq(e,t,n){var r=n.docs.get(t._key),i=new HU(e);return new CU(e,i,t._key,r,new SU(n.hasPendingWrites,n.fromCache),t.converter)}class rq extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=rU(e)}get(e){const n=GU(e,this._firestore),r=new zU(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Nx();const t=e[0];if(t.isFoundDocument())return new TU(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new TU(this._firestore,r,n._key,null,n.converter);throw Nx()})}set(e,t,n){var r=GU(e,this._firestore),i=$U(r.converter,t,n),i=iU(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=GU(e,this._firestore),s="string"==typeof(t=$d(t))||t instanceof GF?dU(this._dataReader,"Transaction.update",i._key,t,n,r):hU(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=GU(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=GU(e,this._firestore),n=new HU(this._firestore);return super.get(e).then(e=>new CU(this._firestore,n,t._key,e._document,new SU(!1,!1),t.converter))}}function iq(t,n){return function(t,n){const r=new Ox;return t.asyncQueue.enqueueAndForget(async()=>{var e=await sF(t).then(e=>e.datastore);new eF(t.asyncQueue,e,n,r).run()}),r.promise}(qF(t=wF(t,UF)),e=>n(new rq(t,e)))}W=gp,Ix=W,hp(new zd("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new UF(n,new Fx(e.getProvider("auth-internal")),new Vx(e.getProvider("app-check-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),_p(wx,"3.4.5",void 0),_p(wx,"3.4.5","esm2017");function sq(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Px("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function oq(){if("undefined"==typeof Uint8Array)throw new Px("unimplemented","Uint8Arrays are not available in this environment.")}function aq(){if("undefined"==typeof atob)throw new Px("unimplemented","Blobs are unavailable in Firestore in this environment.")}class cq{constructor(e){this._delegate=e}static fromBase64String(e){return aq(),new cq(HF.fromBase64String(e))}static fromUint8Array(e){return oq(),new cq(HF.fromUint8Array(e))}toBase64(){return aq(),this._delegate.toBase64()}toUint8Array(){return oq(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function lq(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class uq{enableIndexedDbPersistence(e,t){return function(e,t){WF(e=wF(e,UF));var n=qF(e),r=e._freezeSettings(),i=new QL;return VF(n,i,new GL(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){WF(e=wF(e,UF));var t=qF(e),n=e._freezeSettings(),r=new QL;return VF(t,r,new HL(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Px(Rx.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Ox;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!v1.Vt())return Promise.resolve();var t=e+"main";await v1.delete(t)}(zD(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class hq{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof hR||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Cx("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=wF(n,TF))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Cx("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=bx.MOCK_USER;else{e=id(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Px(Rx.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new bx(s)}n._authCredentials=new Lx(new Dx(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return KF(this._delegate)}disableNetwork(){return $F(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,mF("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return BF(this._delegate)}onSnapshotsInSync(e){return eq(this._delegate,e)}get app(){if(!this._appCompat)throw new Px("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new kq(this,CF(this._delegate,e))}catch(e){throw vq(e,"collection()","Firestore.collection()")}}doc(e){try{return new mq(this,AF(this._delegate,e))}catch(e){throw vq(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Iq(this,function(e,t){if(e=wF(e,TF),gF("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Px(Rx.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new kF(e,null,(t=t,new eP(Zx.emptyPath(),t)))}(this._delegate,e))}catch(e){throw vq(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return iq(this._delegate,e=>t(new pq(this,e)))}batch(){return qF(this._delegate),new fq(new WU(this._delegate,e=>tq(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=qF(t=wF(t,UF)),r=new OF,pF(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return zF(this._delegate,e).then(e=>e?new Iq(this,e):null)}}class dq extends KU{constructor(e){super(),this.firestore=e}convertBytes(e){return new cq(new HF(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return mq.forKey(t,this.firestore,null)}}class pq{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new dq(e)}get(e){const t=Sq(e);return this._delegate.get(t).then(e=>new wq(this._firestore,new CU(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=Sq(e);return n?(sq("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Sq(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Sq(e);return this._delegate.delete(t),this}}class fq{constructor(e){this._delegate=e}set(e,t,n){var r=Sq(e);return n?(sq("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Sq(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Sq(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class gq{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new AU(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new bq(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=gq.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new gq(e,new dq(e),t),r.set(t,i)),i}}gq.INSTANCES=new WeakMap;class mq{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new dq(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Px("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new mq(t,new EF(t._delegate,n,new gR(e)))}static forKey(e,t,n){return new mq(t,new EF(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new kq(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new kq(this.firestore,CF(this._delegate,e))}catch(e){throw vq(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=$d(e))instanceof EF&&NF(this._delegate,e)}set(e,t){t=sq("DocumentReference.set",t);try{return t?JU(this._delegate,e,t):JU(this._delegate,e)}catch(e){throw vq(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?XU(this._delegate,e):XU(this._delegate,e,t,...n)}catch(e){throw vq(e,"updateDoc()","DocumentReference.update()")}}delete(){return tq(wF((e=this._delegate).firestore,UF),[new KP(e._key,RP.none())]);var e}onSnapshot(...e){var t=yq(e),n=_q(e,e=>new wq(this.firestore,new CU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return ZU(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?QU:"server"===(null==e?void 0:e.source)?function(t){t=wF(t,EF);const n=wF(t.firestore,UF);return hF(qF(n),t._key,{source:"server"}).then(e=>nq(n,t,e))}:function(t){t=wF(t,EF);const n=wF(t.firestore,UF);return hF(qF(n),t._key).then(e=>nq(n,t,e))})(this._delegate),t.then(e=>new wq(this.firestore,new CU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new mq(this.firestore,e?this._delegate.withConverter(gq.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function vq(e,t,n){return e.message=e.message.replace(t,n),e}function yq(e){for(const t of e)if("object"==typeof t&&!lq(t))return t;return{}}function _q(e,t){var n;let r;return r=lq(e[0])?e[0]:lq(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class wq{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new mq(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return xU(this._delegate,e._delegate)}}class bq extends wq{data(e){var t=this._delegate.data(e);return void 0!==t||Nx(),t}}class Iq{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new dq(e)}where(e,t,n){try{return new Iq(this.firestore,OU(this._delegate,(r=n,i=t,s=kU("where",e),new DU(s,i,r))))}catch(e){throw vq(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new Iq(this.firestore,OU(this._delegate,([n,r="asc"]=[e,t],i=r,s=kU("orderBy",n),new MU(s,i))))}catch(e){throw vq(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new Iq(this.firestore,OU(this._delegate,(bF("limit",t=e),new LU("limit",t,"F"))))}catch(e){throw vq(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Iq(this.firestore,OU(this._delegate,(bF("limitToLast",t=e),new LU("limitToLast",t,"L"))))}catch(e){throw vq(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Iq(this.firestore,OU(this._delegate,function(...e){return new FU("startAt",e,!0)}(...e)))}catch(e){throw vq(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Iq(this.firestore,OU(this._delegate,function(...e){return new FU("startAfter",e,!1)}(...e)))}catch(e){throw vq(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Iq(this.firestore,OU(this._delegate,function(...e){return new UU("endBefore",e,!1)}(...e)))}catch(e){throw vq(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Iq(this.firestore,OU(this._delegate,function(...e){return new UU("endAt",e,!0)}(...e)))}catch(e){throw vq(e,"endAt()","Query.endAt()")}}isEqual(e){return xF(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?YU:"server"===(null==e?void 0:e.source)?function(t){t=wF(t,kF);const n=wF(t.firestore,UF),e=qF(n),r=new HU(n);return dF(e,t._query,{source:"server"}).then(e=>new NU(n,r,t,e))}:function(t){t=wF(t,kF);const n=wF(t.firestore,UF),e=qF(n),r=new HU(n);return RU(t._query),dF(e,t._query).then(e=>new NU(n,r,t,e))})(this._delegate),t.then(e=>new Eq(this.firestore,new NU(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=yq(e),n=_q(e,e=>new Eq(this.firestore,new NU(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return ZU(this._delegate,t,n)}withConverter(e){return new Iq(this.firestore,e?this._delegate.withConverter(gq.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Tq{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new bq(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Eq{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Iq(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new bq(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Tq(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new bq(this._firestore,e))})}isEqual(e){return xU(this._delegate,e._delegate)}}class kq extends Iq{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new mq(this.firestore,e):null}doc(e){try{return void 0===e?new mq(this.firestore,AF(this._delegate)):new mq(this.firestore,AF(this._delegate,e))}catch(e){throw vq(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=wF(e.firestore,UF),r=AF(e),i=$U(e.converter,t);return tq(n,[iU(rU(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,RP.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new mq(this.firestore,e))}isEqual(e){return NF(this._delegate,e._delegate)}withConverter(e){return new kq(this.firestore,e?this._delegate.withConverter(gq.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Sq(e){return wF(e,EF)}const Cq={Firestore:hq,GeoPoint:YF,Timestamp:Gx,Blob:cq,Transaction:pq,WriteBatch:fq,DocumentReference:mq,DocumentSnapshot:wq,Query:Iq,QueryDocumentSnapshot:bq,QuerySnapshot:Eq,CollectionReference:kq,FieldPath:class kK{constructor(...e){this._delegate=new GF(...e)}static documentId(){return new kK(tR.keyField().canonicalString())}isEqual(e){return(e=$d(e))instanceof GF&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class SK{constructor(e){this._delegate=e}static serverTimestamp(){const e=new aU("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new SK(e)}static delete(){const e=new sU("deleteField");return e._methodName="FieldValue.delete",new SK(e)}static arrayUnion(...e){const t=function(...e){return new cU("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new SK(t)}static arrayRemove(...e){const t=function(...e){return new lU("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new SK(t)}static increment(e){const t=new uU("increment",e);return t._methodName="FieldValue.increment",new SK(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,Tx.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};DF=Cp,MF=(e,t)=>new hq(e,t,new uq),DF.INTERNAL.registerComponent(new zd("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return MF(t,n)},"PUBLIC").setServiceProps(Object.assign({},Cq))),DF.registerVersion("@firebase/firestore-compat","0.1.14");function Aq(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function Nq(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>Nq(e)):"function"==typeof e||"object"==typeof e?Aq(e,e=>Nq(e)):e}const xq="functions",Rq={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pq extends gd{constructor(e,t,n){super(`${xq}/${e}`,t||""),this.details=n}}function Oq(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!Rq[e])return new Pq("internal","internal");n=Rq[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=Nq(i))}}catch(e){}return"ok"===n?null:new Pq(n,r,i)}class Dq{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const Mq="us-central1";class Lq{constructor(e,t,n,r,i=Mq,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Dq(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=Mq}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function Fq(t,n,r){return e=>async function(e,t,n,r){const i=e._url(t),s={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return Aq(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)},o={},a=await e.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken);a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken);null!==a.appCheckToken&&(o["X-Firebase-AppCheck"]=a.appCheckToken);const c=r.timeout||7e4,l=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new Pq("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(c),u=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(i,s,o,e.fetchImpl),l.promise,e.cancelAllRequests]);if(l.cancel(),!u)throw new Pq("cancelled","Firebase Functions instance was deleted.");var h=Oq(u.status,u.json);if(h)throw h;if(!u.json)throw new Pq("internal","Response is not valid JSON object.");let d=u.json.data;void 0===d&&(d=u.json.result);if(void 0===d)throw new Pq("internal","Response is missing data field.");h=Nq(d);return{data:h}}(t,n,e,r||{})}const Uq="@firebase/functions";function qq(e,t,n){$d(e).emulatorOrigin=`http://${t}:${n}`}LF=fetch.bind(self),hp(new zd(xq,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new Lq(n,r,i,s,t,LF)},"PUBLIC").setMultipleInstances(!0)),_p(Uq,"0.7.8",FF),_p(Uq,"0.7.8","esm2017");var jq,Vq,Bq,Kq;class $q{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return Fq($d(this._delegate),e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new gd("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new gd("functions","Port missing in origin provided to useFunctionsEmulator()");return qq(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return qq(this._delegate,e,t)}}const zq="us-central1",Wq=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:zq});return new $q(n,r)};jq={Functions:$q},Cp.INTERNAL.registerComponent(new zd("functions-compat",Wq,"PUBLIC").setServiceProps(jq).setMultipleInstances(!0)),Cp.registerVersion("@firebase/functions-compat","0.1.9");const Gq="/firebase-messaging-sw.js",Hq="/firebase-cloud-messaging-push-scope",Qq="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Yq="https://fcmregistrations.googleapis.com/v1",Jq="google.c.a.c_id",Xq="google.c.a.e";function Zq(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(yt=a2=a2||{})[yt.DATA_MESSAGE=1]="DATA_MESSAGE",yt[yt.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(yt=Vq=Vq||{}).PUSH_RECEIVED="push-received",yt.NOTIFICATION_CLICKED="notification-clicked";const ej="fcm_token_details_db",tj="fcm_token_object_Store";async function nj(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(ej))return null}let o=null;const e=await jp(ej,5,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(tj)){const i=e.transaction.objectStore(tj);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:Zq(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:Zq(n.auth),p256dh:Zq(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:Zq(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:Zq(r.auth),p256dh:Zq(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:Zq(r.vapidKey)}}))}});return e.close(),await Vp(ej),await Vp("fcm_vapid_details_db"),await Vp("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const rj="firebase-messaging-database",ij=1,sj="firebase-messaging-store";let oj=null;function aj(){return oj=oj||jp(rj,ij,e=>{0===e.oldVersion&&e.createObjectStore(sj)}),oj}async function cj(e){var t=uj(e);const n=await aj();t=await n.transaction(sj).objectStore(sj).get(t);if(t)return t;t=await nj(e.appConfig.senderId);return t?(await lj(e,t),t):void 0}async function lj(e,t){var n=uj(e);const r=await aj(),i=r.transaction(sj,"readwrite");return await i.objectStore(sj).put(t,n),await i.complete,t}function uj({appConfig:e}){return e.appId}const hj=new md("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function dj(e,t){var n={method:"DELETE",headers:await fj(e)};try{const s=await fetch(`${pj(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw hj.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw hj.create("token-unsubscribe-failed",{errorInfo:e})}}function pj({projectId:e}){return`${Yq}/projects/${e}/registrations`}async function fj({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function gj({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Qq&&(i.web.applicationPubKey=r),i}const mj=6048e5;async function vj(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Zq(t.getKey("auth")),p256dh:Zq(t.getKey("p256dh"))},c=await cj(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=a.vapidKey===n.vapidKey,i=a.endpoint===n.endpoint,s=a.auth===n.auth,o=a.p256dh===n.p256dh,r&&i&&s&&o)return Date.now()>=c.createTime+mj?async function(t,e){try{var n=await async function(e,t){var n=await fj(e),r=gj(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${pj(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw hj.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw hj.create("token-update-failed",{errorInfo:r})}if(!i.token)throw hj.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await lj(t.firebaseDependencies,r),n}catch(e){throw await yj(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await dj(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return _j(e.firebaseDependencies,a)}return _j(e.firebaseDependencies,a)}async function yj(e){var t=await cj(e.firebaseDependencies);t&&(await dj(e.firebaseDependencies,t.token),await async function(e){var t=uj(e);const n=await aj(),r=n.transaction(sj,"readwrite");await r.objectStore(sj).delete(t),await r.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function _j(e,t){var n={token:await async function(e,t){var n=await fj(e),r=gj(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(pj(e.appConfig),r);i=await s.json()}catch(e){throw hj.create("token-subscribe-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw hj.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw hj.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await lj(e,n),n.token}function wj(e){var t,n,r,i={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return n=i,(t=e).notification&&(n.notification={},(r=t.notification.title)&&(n.notification.title=r),(r=t.notification.body)&&(n.notification.body=r),(r=t.notification.image)&&(n.notification.image=r)),t=i,(n=e).data&&(t.data=n.data),n=i,(e=e).fcmOptions&&(n.fcmOptions={},(r=e.fcmOptions.link)&&(n.fcmOptions.link=r),(r=e.fcmOptions.analytics_label)&&(n.fcmOptions.analyticsLabel=r)),i}function bj(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function Ij(e){return hj.create("missing-app-config-values",{valueName:e})}bj("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),bj("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Tj{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw Ij("App Configuration Object");if(!e.name)throw Ij("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw Ij(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Ej(e){try{e.swRegistration=await navigator.serviceWorker.register(Gq,{scope:Hq}),e.swRegistration.update().catch(()=>{})}catch(e){throw hj.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}async function kj(e,t){if(!navigator)throw hj.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw hj.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=Qq)),await async function(e,t){if(t||e.swRegistration||await Ej(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw hj.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),vj(e)}async function Sj(e,t,n){var r=function(e){switch(e){case Vq.NOTIFICATION_CLICKED:return"notification_open";case Vq.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[Jq],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function Cj(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===Vq.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(wj(r)):e.onMessageHandler.next(wj(r))),n=r.data,"object"==typeof(t=n)&&t&&Jq in t&&"1"===n[Xq]&&await Sj(e,r.messageType,n))}const Aj="@firebase/messaging",Nj=e=>{const t=new Tj(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>Cj(t,e)),t},xj=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>kj(t,e)}};function Rj(e){return async function(e){if(!navigator)throw hj.create("only-available-in-window");return e.swRegistration||await Ej(e),yj(e)}(e=$d(e))}function Pj(e,t){return function(e,t){if(!navigator)throw hj.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=$d(e),t)}hp(new zd("messaging",Nj,"PUBLIC")),hp(new zd("messaging-internal",xj,"PRIVATE")),_p(Aj,"0.9.8"),_p(Aj,"0.9.8","esm2017");const Oj="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Dj="https://fcmregistrations.googleapis.com/v1",Mj="FCM_MSG",Lj="google.c.a.c_id",Fj=3,Uj=1;function qj(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(yt=Bq=Bq||{})[yt.DATA_MESSAGE=1]="DATA_MESSAGE",yt[yt.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(c=Kq=Kq||{}).PUSH_RECEIVED="push-received",c.NOTIFICATION_CLICKED="notification-clicked";const jj="fcm_token_details_db",Vj="fcm_token_object_Store";async function Bj(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(jj))return null}let o=null;const e=await jp(jj,5,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(Vj)){const i=e.transaction.objectStore(Vj);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:qj(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:qj(n.auth),p256dh:qj(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:qj(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:qj(r.auth),p256dh:qj(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:qj(r.vapidKey)}}))}});return e.close(),await Vp(jj),await Vp("fcm_vapid_details_db"),await Vp("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const Kj="firebase-messaging-database",$j=1,zj="firebase-messaging-store";let Wj=null;function Gj(){return Wj=Wj||jp(Kj,$j,e=>{0===e.oldVersion&&e.createObjectStore(zj)}),Wj}async function Hj(e){var t=Yj(e);const n=await Gj();t=await n.transaction(zj).objectStore(zj).get(t);if(t)return t;t=await Bj(e.appConfig.senderId);return t?(await Qj(e,t),t):void 0}async function Qj(e,t){var n=Yj(e);const r=await Gj(),i=r.transaction(zj,"readwrite");return await i.objectStore(zj).put(t,n),await i.complete,t}function Yj({appConfig:e}){return e.appId}const Jj=new md("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function Xj(e,t){var n={method:"DELETE",headers:await eV(e)};try{const s=await fetch(`${Zj(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw Jj.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw Jj.create("token-unsubscribe-failed",{errorInfo:e})}}function Zj({projectId:e}){return`${Dj}/projects/${e}/registrations`}async function eV({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function tV({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Oj&&(i.web.applicationPubKey=r),i}async function nV(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:qj(t.getKey("auth")),p256dh:qj(t.getKey("p256dh"))},c=await Hj(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=a.vapidKey===n.vapidKey,i=a.endpoint===n.endpoint,s=a.auth===n.auth,o=a.p256dh===n.p256dh,r&&i&&s&&o)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await eV(e),r=tV(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${Zj(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw Jj.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw Jj.create("token-update-failed",{errorInfo:r})}if(!i.token)throw Jj.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await Qj(t.firebaseDependencies,r),n}catch(e){throw await rV(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await Xj(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return iV(e.firebaseDependencies,a)}return iV(e.firebaseDependencies,a)}async function rV(e){var t=await Hj(e.firebaseDependencies);t&&(await Xj(e.firebaseDependencies,t.token),await async function(e){var t=Yj(e);const n=await Gj(),r=n.transaction(zj,"readwrite");await r.objectStore(zj).delete(t),await r.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function iV(e,t){var n={token:await async function(e,t){var n=await eV(e),r=tV(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(Zj(e.appConfig),r);i=await s.json()}catch(e){throw Jj.create("token-subscribe-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw Jj.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw Jj.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await Qj(e,n),n.token}async function sV(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=Bq.DISPLAY_NOTIFICATION.toString():r.message_type=Bq.DATA_MESSAGE.toString();r.sdk_platform=Fj.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=Uj.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function oV(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function aV(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await sV(t,n);var r,i,s=await lV();if(s.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=Kq.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(s,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[Mj]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(s={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},n=s,(e=r).notification&&(n.notification={},(i=e.notification.title)&&(n.notification.title=i),(i=e.notification.body)&&(n.notification.body=i),(i=e.notification.image)&&(n.notification.image=i)),e=s,(n=r).data&&(e.data=n.data),n=s,(r=r).fcmOptions&&(n.fcmOptions={},(i=r.fcmOptions.link)&&(n.fcmOptions.link=i),(i=r.fcmOptions.analytics_label)&&(n.fcmOptions.analyticsLabel=i)),s=s,"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(s):t.onBackgroundMessageHandler.next(s))}}async function cV(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[Mj];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&Lj in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await lV();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=Kq.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function lV(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function uV(e){return Jj.create("missing-app-config-values",{valueName:e})}oV("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),oV("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class hV{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw uV("App Configuration Object");if(!e.name)throw uV("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw uV(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const dV=e=>{const t=new hV(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(aV(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await Hj(t.firebaseDependencies),await rV(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:Oj,await nV(t)):await rV(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(cV(e))}),t};function pV(e,t){return function(e,t){if(void 0!==self.document)throw Jj.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=$d(e),t)}hp(new zd("messaging-sw",dV,"PUBLIC"));var fV,gV,mV;class vV{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return kj(e=$d(e),t)}(this._delegate,e)}async deleteToken(){return Rj(this._delegate)}onMessage(e){return Pj(this._delegate,e)}onBackgroundMessage(e){return pV(this._delegate,e)}}const yV=e=>self&&"ServiceWorkerGlobalScope"in self?new vV(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new vV(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),_V={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?dd()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&dd()&&fd()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};Cp.INTERNAL.registerComponent(new zd("messaging-compat",yV,"PUBLIC").setServiceProps(_V)),Cp.registerVersion("@firebase/messaging-compat","0.1.8");const wV="firebasestorage.googleapis.com",bV="storageBucket";class IV extends gd{constructor(e,t){super(TV(e),`Firebase Storage: ${t} (${TV(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,IV.prototype)}_codeEquals(e){return TV(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function TV(e){return"storage/"+e}function EV(){return new IV("unknown","An unknown error occurred, please check the error payload for server response.")}function kV(){return new IV("canceled","User canceled the upload/download.")}function SV(){return new IV("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function CV(e){return new IV("invalid-argument",e)}function AV(){return new IV("app-deleted","The Firebase app was deleted.")}function NV(e){return new IV("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function xV(e,t){return new IV("invalid-format","String does not match format '"+e+"': "+t)}function RV(e){throw new IV("internal-error","Internal error: "+e)}class PV{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=PV.makeFromUrl(t,e)}catch(e){return new PV(t,"")}if(""===n.path)return n;throw t=t,new IV("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=t.replace(/[.]/g,"\\."),a=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),o=t===wV?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${o}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new PV(u,e),d.postModify(n);break}}if(null==n)throw t=e,new IV("invalid-url","Invalid URL '"+t+"'.");return n}}class OV{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function DV(e){return"string"==typeof e||e instanceof String}function MV(e){return LV()&&e instanceof Blob}function LV(){return"undefined"!=typeof Blob}function FV(e,t,n,r){if(r<t)throw CV(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw CV(`Invalid value for '${e}'. Expected ${n} or less.`)}function UV(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function qV(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}(c=fV=fV||{})[c.NO_ERROR=0]="NO_ERROR",c[c.NETWORK_ERROR=1]="NETWORK_ERROR",c[c.ABORT=2]="ABORT";class jV{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(r,e)=>{if(e)r(!1,new VV(!1,null,!0));else{const i=this.connectionFactory_();this.pendingConnection_=i;const s=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===fV.NO_ERROR,n=i.getStatus();t&&!this.isRetryStatusCode_(n)?(e=-1!==this.successCodes_.indexOf(n),r(!0,new VV(e,i))):(e=i.getErrorCode()===fV.ABORT,r(!1,new VV(!1,null,e)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=EV();a.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,a)):r(a)}else{var o;t.canceled?(o=(this.appDelete_?AV:kV)(),r(o)):(o=new IV("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(o))}};this.canceled_?t(0,new VV(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||o)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===a?(a=2,0):1e3*(r+Math.random()),h(e)}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{g(o=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class VV{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function BV(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(LV())return new Blob(t);throw new IV("unsupported-environment","This browser doesn't seem to support creating Blobs")}const KV={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class $V{constructor(e,t){this.data=e,this.contentType=t||null}}function zV(e,t){switch(e){case KV.RAW:return new $V(WV(t));case KV.BASE64:case KV.BASE64URL:return new $V(GV(e,t));case KV.DATA_URL:return new $V((n=t,(r=new HV(n)).base64?GV(KV.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw xV(KV.DATA_URL,"Malformed data URL.")}return WV(t)}(r.rest)),(n=t,new HV(n).contentType))}var n,r;throw EV()}function WV(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function GV(t,e){switch(t){case KV.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw xV(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case KV.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw xV(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw xV(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return s}class HV{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw xV(KV.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class QV{constructor(e,t){let n=0,r="";MV(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(MV(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new QV(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new QV(n,!0)}static getBlob(...e){if(LV()){var t=e.map(e=>e instanceof QV?e.data_:e);return new QV(BV.apply(null,t))}{const r=e.map(e=>DV(e)?zV(KV.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new QV(i,!0)}}uploadData(){return this.data_}}function YV(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function JV(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function XV(e,t){return t}class ZV{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||XV}}let eB=null;function tB(){if(eB)return eB;const e=[];e.push(new ZV("bucket")),e.push(new ZV("generation")),e.push(new ZV("metageneration")),e.push(new ZV("name","fullPath",!0));const t=new ZV("name");t.xform=function(e,t){return!DV(t=t)||t.length<2?t:JV(t)},e.push(t);const n=new ZV("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ZV("timeCreated")),e.push(new ZV("updated")),e.push(new ZV("md5Hash",null,!0)),e.push(new ZV("cacheControl",null,!0)),e.push(new ZV("contentDisposition",null,!0)),e.push(new ZV("contentEncoding",null,!0)),e.push(new ZV("contentLanguage",null,!0)),e.push(new ZV("contentType",null,!0)),e.push(new ZV("metadata","customMetadata",!0)),eB=e,eB}function nB(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new PV(e,t);return r._makeStorageReference(t)}})}function rB(e,t,n){var r=YV(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,t[o.server])}return nB(r,e),r}(e,r,n)}function iB(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}function sB(e,t,n){var r=YV(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const o of n.prefixes){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new PV(t,i));r.prefixes.push(i)}if(n.items)for(const a of n.items){var s=e._makeStorageReference(new PV(t,a.name));r.items.push(s)}return r}(e,t,r)}class oB{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function aB(e){if(!e)throw EV()}function cB(r,i){return function(e,t){var n=rB(r,t,i);return aB(null!==n),n}}function lB(r,i){return function(e,t){var n=sB(r,i,t);return aB(null!==n),n}}function uB(r,i){return function(e,t){var n=rB(r,t,i);return aB(null!==n),function(r,e,i,s){var t=YV(e);if(null===t)return null;if(!DV(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const o=encodeURIComponent,a=n.split(",");return a.map(e=>{var t=r.bucket,n=r.fullPath;return UV("/b/"+o(t)+"/o/"+o(n),i,s)+qV({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function hB(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new IV("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new IV("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new IV("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new IV("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function dB(r){const i=hB(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new IV("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function pB(e,t,n){var r=UV(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new oB(r,"GET",cB(e,n),i);return s.errorHandler=dB(t),s}function fB(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function gB(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;var c=fB(t,r,i),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+iB(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const u=QV.getBlob(l,r,a);if(null===u)throw SV();a={name:c.fullPath},c=UV(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new oB(c,"POST",cB(e,n),s);return h.urlParams=a,h.headers=o,h.body=u.uploadData(),h.errorHandler=hB(t),h}class mB{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function vB(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){aB(!1)}const r=t||["active"];return aB(!!n&&-1!==r.indexOf(n)),n}function yB(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=fB(t,r,i),a={name:o.fullPath},c=UV(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},s=iB(o,n),o=e.maxUploadRetryTime;const u=new oB(c,"POST",function(e){vB(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){aB(!1)}return aB(DV(t)),t},o);return u.urlParams=a,u.headers=l,u.body=s,u.errorHandler=hB(t),u}function _B(e,t,n,i){var r=e.maxUploadRetryTime;const s=new oB(n,"POST",function(e){var t=vB(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){aB(!1)}n||aB(!1);var r=Number(n);return aB(!isNaN(r)),new mB(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=hB(t),s}function wB(e,o,t,a,n,c,r,i){const l=new mB(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new IV("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const p=a.slice(h,d);if(null===p)throw SV();d=o.maxUploadRetryTime;const f=new oB(t,"POST",function(e,t){var n=vB(e,["active","final"]),r=l.current+u,i=a.size();let s;return s="final"===n?cB(o,c)(e,t):null,new mB(r,i,"final"===n,s)},d);return f.headers=s,f.body=p.uploadData(),f.progressCallback=i||null,f.errorHandler=hB(e),f}const bB={STATE_CHANGED:"state_changed"},IB={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function TB(e){switch(e){case"running":case"pausing":case"canceling":return IB.RUNNING;case"paused":return IB.PAUSED;case"success":return IB.SUCCESS;case"canceled":return IB.CANCELED;default:return IB.ERROR}}class EB{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function kB(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class SB extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=fV.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=fV.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=fV.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw RV("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw RV("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw RV("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw RV("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw RV("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function CB(){return new SB}class AB{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=tB(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=yB(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,CB,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=_B(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,CB,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new mB(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=wB(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,CB,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=pB(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,CB,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=gB(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,CB,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=kV(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=TB(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new EB(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(TB(this._state)){case IB.SUCCESS:kB(this._resolve.bind(null,this.snapshot))();break;case IB.CANCELED:case IB.ERROR:const t=this._reject;kB(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(TB(this._state)){case IB.RUNNING:case IB.PAUSED:e.next&&kB(e.next.bind(e,this.snapshot))();break;case IB.SUCCESS:e.complete&&kB(e.complete.bind(e))();break;case IB.CANCELED:case IB.ERROR:default:e.error&&kB(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class NB{constructor(e,t){this._service=e,t instanceof PV?this._location=t:this._location=PV.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new NB(e,t)}get root(){var e=new PV(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return JV(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new PV(this._location.bucket,e);return new NB(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw NV(e)}}function xB(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await RB(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function RB(e,t){null!=t&&"number"==typeof t.maxResults&&FV("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var o=UV(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime;const c=new oB(o,"GET",lB(e,t.bucket),a);return c.urlParams=s,c.errorHandler=hB(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,CB)}function PB(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=UV(t.fullServerUrl(),e.host,e._protocol),s=iB(n,r),o=e.maxOperationRetryTime;const a=new oB(i,"PATCH",cB(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=dB(t),a}(e.storage,e._location,t,tB());return e.storage.makeRequestWithTokens(n,CB)}function OB(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=UV(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new oB(r,"GET",uB(e,n),i);return s.errorHandler=dB(t),s}(e.storage,e._location,tB());return e.storage.makeRequestWithTokens(t,CB).then(e=>{if(null===e)throw new IV("no-download-url","The given file does not have any download URLs.");return e})}function DB(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=UV(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new oB(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=dB(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,CB)}function MB(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new PV(e._location.bucket,r);return new NB(e.storage,r)}function LB(e,t){if(e instanceof qB){var n=e;if(null==n._bucket)throw new IV("no-default-bucket","No default bucket found. Did you set the '"+bV+"' property when initializing the app?");n=new NB(n,n._bucket);return null!=t?LB(n,t):n}return void 0!==t?MB(e,t):e}function FB(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof qB)return n=e,r=t,new NB(n,r);throw CV("To use ref(service, url), the first argument must be a Storage instance.")}return LB(e,t);var n,r}function UB(e,t){var n=null==t?void 0:t[bV];return null==n?null:PV.makeFromBucketSpec(n,e)}class qB{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=wV,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?PV.makeFromBucketSpec(r,this._host):UB(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=PV.makeFromBucketSpec(this._url,e):this._bucket=UB(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){FV("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){FV("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new NB(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new OV(AV());{const l=(i=e,s=this._appId,o=n,e=r,n=t,r=this._firebaseVersion,a=qV(i.urlParams),c=i.url+a,a=Object.assign({},i.headers),t=a,(s=s)&&(t["X-Firebase-GMPID"]=s),s=a,null!==(o=o)&&0<o.length&&(s.Authorization="Firebase "+o),r=r,a["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=a,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new jV(c,i.method,a,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,n));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var i,s,o,a,c}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const jB="@firebase/storage";function VB(e,t,n){return e=$d(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new AB(e,new QV(t),n)}function BB(e){return function(e){e._throwIfRoot("getMetadata");var t=pB(e.storage,e._location,tB());return e.storage.makeRequestWithTokens(t,CB)}(e=$d(e))}function KB(e,t){return FB(e=$d(e),t)}function $B(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:id(i,e.app.options.projectId))}(e,t,n,r)}function zB(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new qB(n,r,i,t,gp)}hp(new zd("storage",zB,"PUBLIC").setMultipleInstances(!0)),_p(jB,"0.9.2",""),_p(jB,"0.9.2","esm2017");class WB{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class GB{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new WB(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new WB(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new WB(e,this,this._ref)):{next:t.next?e=>t.next(new WB(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class HB{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new QB(e,this._service))}get items(){return this._delegate.items.map(e=>new QB(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class QB{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=MB(this._delegate,e);return new QB(t,this.storage)}get root(){return new QB(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new QB(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new GB(VB(this._delegate,e,t),this)}putString(e,t=KV.RAW,n){this._throwIfRoot("putString");var r=zV(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new GB(new AB(this._delegate,new QV(r.data,!0),i),this)}listAll(){return xB($d(this._delegate)).then(e=>new HB(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,RB(t=$d(t),e).then(e=>new HB(e,this.storage));var t}getMetadata(){return BB(this._delegate)}updateMetadata(e){return PB($d(this._delegate),e)}getDownloadURL(){return OB($d(this._delegate))}delete(){return this._throwIfRoot("delete"),DB($d(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw NV(e)}}class YB{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(JB(e))throw CV("ref() expected a child path but got a URL, use refFromURL instead.");return new QB(KB(this._delegate,e),this)}refFromURL(e){if(!JB(e))throw CV("refFromURL() expected a full URL but got a child path, use ref() instead.");try{PV.makeFromUrl(e,this._delegate.host)}catch(e){throw CV("refFromUrl() expected a valid full URL but got an invalid one.")}return new QB(KB(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){$B(this._delegate,e,t,n)}}function JB(e){return/^[A-Za-z]+:\/\//.test(e)}function XB(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new YB(n,r)}gV=Cp,mV={TaskState:IB,TaskEvent:bB,StringFormat:KV,Storage:YB,Reference:QB},gV.INTERNAL.registerComponent(new zd("storage-compat",XB,"PUBLIC").setServiceProps(mV).setMultipleInstances(!0)),gV.registerVersion("@firebase/storage-compat","0.1.10");const ZB="@firebase/performance",e2="0.5.5",t2="FB-PERF-TRACE-MEASURE",n2="@firebase/performance/config",r2="@firebase/performance/configexpire";var i2,s2,o2,a2="Performance";const c2=new md("performance",a2,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),l2=new ep(a2);l2.logLevel=$h.INFO;let u2,h2;class d2{constructor(e){if(!(this.window=e))throw c2.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&fd()?!!dd()||(l2.info("IndexedDB is not supported by current browswer"),!1):(l2.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===u2&&(u2=new d2(h2)),u2}}let p2;function f2(e,t){var n=e.length-t.length;if(n<0||1<n)throw c2.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let g2;class m2{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=f2("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=f2("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===g2&&(g2=new m2),g2}}(c=i2=i2||{})[c.UNKNOWN=0]="UNKNOWN",c[c.VISIBLE=1]="VISIBLE",c[c.HIDDEN=2]="HIDDEN";const v2=["firebase_","google_","ga_"],y2=new RegExp("^[a-zA-Z]\\w*$");function _2(){switch(d2.getInstance().document.visibilityState){case"visible":return i2.VISIBLE;case"hidden":return i2.HIDDEN;default:return i2.UNKNOWN}}function w2(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw c2.create("no app id");return t}const b2="0.0.1",I2={loggingEnabled:!0},T2="FIREBASE_INSTALLATIONS_AUTH";function E2(e,t){var r,i,n=function(){const e=d2.getInstance().localStorage;if(e){var t=e.getItem(r2);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(n2);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(S2(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw c2.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw c2.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${T2} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:w2(r.app),app_version:e2,sdk_version:b2})});return fetch(n).then(e=>{if(e.ok)return e.json();throw c2.create("RC response not ok")})}).catch(()=>{l2.info(k2)}).then(S2).then(e=>function(e){const t=d2.getInstance().localStorage;e&&t&&(t.setItem(n2,JSON.stringify(e)),t.setItem(r2,String(Date.now()+60*m2.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const k2="Could not fetch config, will use default configs";function S2(e){if(!e)return e;const t=m2.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=I2.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=C2(t.tracesSamplingRate),t.logNetworkAfterSampling=C2(t.networkRequestsSamplingRate),e}function C2(e){return Math.random()<=e}let A2=1,N2;function x2(e){var t;return A2=2,N2=N2||(t=e,function(){const n=d2.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{p2=e}),t}(t.installations)).then(e=>E2(t,e)).then(()=>R2(),()=>R2())),N2}function R2(){A2=3}const P2=1e4,O2=3,D2=1e3;let M2=O2,L2=[],F2=!1;function U2(e){setTimeout(()=>{if(0!==M2)return L2.length?void function(){const e=L2.splice(0,D2),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:m2.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=m2.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||l2.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=P2;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(L2=[...r,...L2],l2.info("Retry transport request later.")),M2=O2,U2(n)})}(n,e).catch(()=>{L2=[...e,...L2],M2--,l2.info(`Tries left: ${M2}.`),U2(P2)})}():U2(P2)},e)}function q2(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw c2.create("invalid cc log");L2=[...L2,e]}({message:t(...e),eventTime:Date.now()})}}let j2;function V2(e,t){j2=j2||q2($2),j2(e,t)}function B2(e){var t=m2.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&d2.getInstance().requiredApisAvailable()&&(e.isAuto&&_2()!==i2.VISIBLE||(3===A2?K2(e):x2(e.performanceController).then(()=>K2(e),()=>K2(e))))}function K2(e){var t;!p2||(t=m2.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>V2(e,1),0)}function $2(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:z2(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:z2(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function z2(e){return{google_app_id:w2(e),app_instance_id:p2,web_app_info:{sdk_version:e2,page_url:d2.getInstance().getUrl(),service_worker_status:"serviceWorker"in(t=d2.getInstance().navigator)?t.serviceWorker.controller?2:3:1,visibility_state:_2(),effective_connection_type:function(){var e=d2.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const W2=["_fp","_fcp","_fid"];class G2{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=d2.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${t2}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw c2.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw c2.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),B2(this)}record(e,t,n){if(e<=0)throw c2.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw c2.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));B2(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<W2.indexOf(r))&&r.startsWith("_"))throw c2.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&l2.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!v2.some(e=>n.startsWith(e))&&!!n.match(y2)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw c2.create("invalid attribute name",{attributeName:e});if(!s)throw c2.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=d2.getInstance().getUrl();if(i){const s=new G2(e,"_wt_"+i,!0);i=Math.floor(1e3*d2.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),B2(s)}}static createUserTimingTrace(e,t){B2(new G2(e,t,!1,t))}}function H2(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=d2.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=m2.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>V2(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const Q2=5e3;function Y2(e){p2&&(setTimeout(()=>function(n){const e=d2.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{G2.createOobTrace(n,r,i),t=void 0},Q2);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),G2.createOobTrace(n,r,i,e))})}else G2.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=d2.getInstance(),n=e.getEntriesByType("resource");for(const r of n)H2(t,r);e.setupObserver("resource",e=>H2(t,e))}(e),0),setTimeout(()=>function(t){const e=d2.getInstance(),n=e.getEntriesByType("measure");for(const r of n)J2(t,r);e.setupObserver("measure",e=>J2(t,e))}(e),0))}function J2(e,t){const n=t.name;n.substring(0,t2.length)!==t2&&G2.createUserTimingTrace(e,n)}class X2{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),d2.getInstance().requiredApisAvailable()?pd().then(e=>{e&&(F2||(U2(5500),F2=!0),x2(this).then(()=>Y2(this),()=>Y2(this)),this.initialized=!0)}).catch(e=>{l2.info(`Environment doesn't support IndexedDB: ${e}`)}):l2.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){m2.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return m2.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){m2.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return m2.getInstance().dataCollectionEnabled}}const Z2="[DEFAULT]";const eK=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==Z2)throw c2.create("FB not default");if("undefined"==typeof window)throw c2.create("no window");e=window,h2=e;const i=new X2(n,r);return i._init(t),i};hp(new zd("performance",eK,"PUBLIC")),_p(ZB,"0.5.5"),_p(ZB,"0.5.5","esm2017");class tK{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=$d(t),new G2(t,e);var t}}function nK(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new tK(t,n)}(s2=Cp).INTERNAL.registerComponent(new zd("performance-compat",nK,"PUBLIC")),s2.registerVersion("@firebase/performance-compat","0.1.5");const rK="@firebase/remote-config";class iK{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const sK=new md("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const oK=["1","true","t","yes","y","on"];class aK{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=oK.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function cK(e){const t=$d(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function lK(e){const t=$d(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function uK(t){const n=$d(t),e=new iK;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof gd&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function hK(n){const e=$d(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=dK(n,t),e),{});var t,r}function dK(e,t){const n=$d(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new aK("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new aK("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new aK("static"))}class pK{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class fK{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let o;try{await Promise.race([i,r]),o=await i}catch(e){let t="fetch-client-network";throw"AbortError"===e.name&&(t="fetch-timeout"),sK.create(t,{originalErrorMessage:e.message})}let a=o.status;i=o.headers.get("ETag")||void 0;let c,l;if(200===o.status){let e;try{e=await o.json()}catch(e){throw sK.create("fetch-client-parse",{originalErrorMessage:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?a=500:"NO_CHANGE"===l?a=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==a&&200!==a)throw sK.create("fetch-status",{httpStatus:a});return{status:a,eTag:i,config:c}}}class gK{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(sK.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof gd&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+Kd(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class mK{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function vK(e,t){var n=e.target.error||void 0;return sK.create(t,{originalErrorMessage:n&&n.message})}const yK="app_namespace_store";class _K{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(vK(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(yK,{keyPath:"compositeKey"})}}catch(e){n(sK.create("storage-open",{originalErrorMessage:e}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((n,t)=>{const e=a.transaction([yK],"readonly"),r=e.objectStore(yK);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{t(vK(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(sK.create("storage-get",{originalErrorMessage:e&&e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([yK],"readwrite"),r=n.objectStore(yK);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(vK(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(sK.create("storage-set",{originalErrorMessage:e&&e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([yK],"readwrite"),r=n.objectStore(yK);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(vK(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(sK.create("storage-delete",{originalErrorMessage:e&&e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class wK{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function bK(){if(!dd())return!1;try{return await pd()}catch(e){return!1}}hp(new zd("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw sK.create("registration-window");if(!dd())throw sK.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw sK.create("registration-project-id");if(!s)throw sK.create("registration-api-key");if(!o)throw sK.create("registration-app-id");t=t||"firebase";const a=new _K(o,n.name,t),c=new wK(a),l=new ep(rK);l.logLevel=$h.ERROR;o=new fK(r,gp,t,i,s,o),o=new gK(o,a),o=new pK(o,a,c,l),o=new mK(n,o,c,a,l);return lK(o),o},"PUBLIC").setMultipleInstances(!0)),_p(rK,"0.3.4"),_p(rK,"0.3.4","esm2017");class IK{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return cK(this._delegate)}ensureInitialized(){return lK(this._delegate)}fetch(){return uK(this._delegate)}fetchAndActivate(){return async function(e){return await uK(e=$d(e)),cK(e)}(this._delegate)}getAll(){return hK(this._delegate)}getBoolean(e){return dK($d(this._delegate),e).asBoolean()}getNumber(e){return dK($d(this._delegate),e).asNumber()}getString(e){return dK($d(this._delegate),e).asString()}getValue(e){return dK(this._delegate,e)}setLogLevel(e){!function(e,t){const n=$d(e);switch(t){case"debug":n._logger.logLevel=$h.DEBUG;break;case"silent":n._logger.logLevel=$h.SILENT;break;default:n._logger.logLevel=$h.ERROR}}(this._delegate,e)}}function TK(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new IK(n,r)}return(o2=Cp).INTERNAL.registerComponent(new zd("remoteConfig-compat",TK,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:bK})),o2.registerVersion("@firebase/remote-config-compat","0.1.5"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Cp.registerVersion("firebase","9.6.7","compat-cdn"),Cp});
//# sourceMappingURL=firebase-compat.js.map
